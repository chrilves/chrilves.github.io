<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.73.0" />
    <meta name="description" content="@chrilves&#39; Archives">
<meta name="author" content="@chrilves">

    <link rel="icon" href="https://chrilves.github.io/images/favicon.png" type="image/png">

    <title>Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives</title>

    
    <link href="https://chrilves.github.io/css/nucleus.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/fontawesome-all.min.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/hybrid.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/featherlight.min.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/perfect-scrollbar.min.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/auto-complete.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/atom-one-dark-reasonable.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/theme.css?1594651652" rel="stylesheet">
    <link href="https://chrilves.github.io/css/hugo-theme.css?1594651652" rel="stylesheet">
    
    

    <script src="https://chrilves.github.io/js/jquery-3.3.1.min.js?1594651652"></script>
    
    
    <link rel="stylesheet" href="https://chrilves.github.io/assets/katex/katex.min.css"/>
    <script defer src="https://chrilves.github.io/assets/katex/katex.min.js"></script>
    <script defer src="https://chrilves.github.io/assets/katex/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>
    
    
    
    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="https://chrilves.github.io/posts/les_gadts_par_l_exemple/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://chrilves.github.io/">
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="65mm"
   height="7mm"
   viewBox="0 0 96.990127 7.7258329"
   version="1.1"
   id="svg8"
   sodipodi:docname="logo.svg"
   inkscape:version="0.92.3 (2405546, 2018-03-11)">
  <defs
     id="defs2" />
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="2.8"
     inkscape:cx="193.2115"
     inkscape:cy="-34.320002"
     inkscape:document-units="mm"
     inkscape:current-layer="layer1"
     showgrid="false"
     fit-margin-top="0"
     fit-margin-left="0"
     fit-margin-right="0"
     fit-margin-bottom="0"
     inkscape:window-width="1920"
     inkscape:window-height="1026"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Calque 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-8.9716412,-5.0276302)">
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332"
       x="8.3895578"
       y="12.61588"
       id="text4543"><tspan
         sodipodi:role="line"
         id="tspan4541"
         x="8.3895578"
         y="12.61588"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'TeX Gyre Bonum';-inkscape-font-specification:'TeX Gyre Bonum';stroke-width:0.26458332;fill:#ffffff">@chrilves' Archives</tspan></text>
  </g>
</svg>
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://chrilves.github.io/js/lunr.min.js?1594651652"></script>
<script type="text/javascript" src="https://chrilves.github.io/js/auto-complete.js?1594651652"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/chrilves.github.io";
    
</script>
<script type="text/javascript" src="https://chrilves.github.io/js/search.js?1594651652"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          




 
  
    
    <li data-nav-id="/posts/" title="Posts" class="dd-item 
        parent
        
        
        ">
      <a href="https://chrilves.github.io/posts/">
          Posts
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/posts/probability_in_scala_3_all_sides/" title="Playing with Probability in Scala 3" class="dd-item ">
        <a href="https://chrilves.github.io/posts/probability_in_scala_3_all_sides/">
        Playing with Probability in Scala 3
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/les_gadts_par_l_exemple/" title="Les GADTs Par l&#39;Exemple" class="dd-item active">
        <a href="https://chrilves.github.io/posts/les_gadts_par_l_exemple/">
        Les GADTs Par l&#39;Exemple
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/gadts_by_use_cases/" title="GADTs By Use Cases" class="dd-item ">
        <a href="https://chrilves.github.io/posts/gadts_by_use_cases/">
        GADTs By Use Cases
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/prime/" title="Proving Primality with GADTs" class="dd-item ">
        <a href="https://chrilves.github.io/posts/prime/">
        Proving Primality with GADTs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/recursion_schemes_intro/" title="Recursion Schemes: the high-school introduction" class="dd-item ">
        <a href="https://chrilves.github.io/posts/recursion_schemes_intro/">
        Recursion Schemes: the high-school introduction
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/gadts_intro/" title="Demystifying GADTs" class="dd-item ">
        <a href="https://chrilves.github.io/posts/gadts_intro/">
        Demystifying GADTs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/folds/" title="Let&#39;s meet the charming fold family" class="dd-item ">
        <a href="https://chrilves.github.io/posts/folds/">
        Let&#39;s meet the charming fold family
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/slimetrail/" title="How to make game in the browser thanks to ScalaJS" class="dd-item ">
        <a href="https://chrilves.github.io/posts/slimetrail/">
        How to make game in the browser thanks to ScalaJS
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/json2xml/" title="JSON to XML: the probably a tiny bit over engineered way" class="dd-item ">
        <a href="https://chrilves.github.io/posts/json2xml/">
        JSON to XML: the probably a tiny bit over engineered way
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/posts/falgebra_scalaio_2017/" title="F-Algebra talk at ScalaIO 2017: Modéliser astucieusement vos données" class="dd-item ">
        <a href="https://chrilves.github.io/posts/falgebra_scalaio_2017/">
        F-Algebra talk at ScalaIO 2017: Modéliser astucieusement vos données
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          




 
  
    
    <li data-nav-id="/types/" title="Introduction to Types" class="dd-item 
        
        
        
        ">
      <a href="https://chrilves.github.io/types/">
          Introduction to Types
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            




 
  
    
      <li data-nav-id="/types/1-why/" title="Episode 1 - Why Types?" class="dd-item ">
        <a href="https://chrilves.github.io/types/1-why/">
        Episode 1 - Why Types?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/types/2-enums/" title="Episode 2 - Enumerations" class="dd-item ">
        <a href="https://chrilves.github.io/types/2-enums/">
        Episode 2 - Enumerations
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/types/3-products/" title="Episode 3 - Products" class="dd-item ">
        <a href="https://chrilves.github.io/types/3-products/">
        Episode 3 - Products
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/types/4-coproducts/" title="Episode 4 - CoProducts" class="dd-item ">
        <a href="https://chrilves.github.io/types/4-coproducts/">
        Episode 4 - CoProducts
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            




 
  
    
      <li data-nav-id="/types/5-rectypes/" title="Episode 5 - Recursive Data Types" class="dd-item ">
        <a href="https://chrilves.github.io/types/5-rectypes/">
        Episode 5 - Recursive Data Types
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/chrilves"><i class='fab fa-fw fa-github'></i> Github</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.linkedin.com/in/christophe-calv%C3%A8s-ab6325b0/"><i class='fab fa-fw fa-linkedin'></i> LinkedIn</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://twitter.com/chrilves"><i class='fab fa-fw fa-twitter'></i> Twitter</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>




        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/chrilves/chrilves.github.io/edit/master/hugo/posts/les_gadts_par_l_exemple.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   Les GADTs Par l&#39;Exemple
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
  <ul>
    <li><a href="#remerciements">Remerciements</a></li>
    <li><a href="#lisez-moi">LISEZ-MOI</a></li>
    <li><a href="#échauffements">Échauffements</a>
      <ul>
        <li><a href="#valeurs-et-types"><em>Valeurs</em> et <em>Types</em>?</a></li>
        <li><a href="#combien-de-types">Combien de types?</a></li>
        <li><a href="#combien-de-valeurs">Combien de valeurs?</a></li>
      </ul>
    </li>
    <li><a href="#premier-contact">Premier Contact</a>
      <ul>
        <li><a href="#cas-dutilisation-preuve-dune-propriété">Cas d&rsquo;Utilisation: Preuve d&rsquo;une propriété</a></li>
        <li><a href="#cas-dutilisation-la-seule-chose-que-je-sais-est-quil-existe">Cas d&rsquo;Utilisation: La seule chose que je sais, est qu&rsquo;il existe</a></li>
        <li><a href="#conclusion-intermédiaire">Conclusion Intermédiaire</a></li>
      </ul>
    </li>
    <li><a href="#cas-dutilisation-simples-et-utiles-relations-sur-les-types">Cas d&rsquo;utilisation simples et utiles: relations sur les types</a>
      <ul>
        <li><a href="#cas-dutilisation-témoin-dégalité-entre-types">Cas d&rsquo;Utilisation: Témoin d&rsquo;Égalité entre Types</a></li>
        <li><a href="#cas-dutilisation-témoin-de-sous-typage">Cas d&rsquo;Utilisation: Témoin de Sous-Typage</a></li>
        <li><a href="#cas-dutilisation-éviter-les-messages-derreur-de-scalac-à-propos-des-bornes-non-respectées">Cas d&rsquo;Utilisation: Éviter les messages d&rsquo;erreur de <em>scalac</em> à propos des bornes non respectées</a></li>
        <li><a href="#cas-dutilisation-fournir-les-bonnes-données-au-bon-diagramme">Cas d&rsquo;Utilisation: Fournir les bonnes données au bon diagramme</a></li>
      </ul>
    </li>
    <li><a href="#cas-dutilisation-plus-avancés">Cas d&rsquo;Utilisation Plus Avancés</a>
      <ul>
        <li><a href="#cas-dutilisation-les-effets">Cas d&rsquo;Utilisation: Les Effets!</a></li>
        <li><a href="#cas-dutilisation-sassurer-que-les-types-sont-pris-en-charge-par-la-base-de-données">Cas d&rsquo;Utilisation: S&rsquo;assurer que les types sont pris en charge par la Base De Données.</a></li>
        <li><a href="#cas-dutilisation-simplifier-les-implicites">Cas d&rsquo;Utilisation: Simplifier les Implicites</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              Les GADTs Par l&#39;Exemple
            </h1>
          

        


<p>Soyez les bienvenu·e·s! Cette session a le dessein de vous présenter
un outil de programmation très puissant. Alors que la plupart des
introductions sur le sujet commencent par une présentation de ses
fondements théoriques d&rsquo;une manière très formelle, nous avons choisi
de vous le présenter à travers de courts exemples et des cas
d&rsquo;utilisation concrets.</p>
<p>Cet atelier est composé de trois parties. La dernière présente trois
des cas d&rsquo;utilisation des plus utiles. Ils forment les usages majeurs
en pratique. Mais ne vous y aventurez pas sans préparation! Cette partie
est la dernière pour une bonne raison: elle s&rsquo;appuie massivement sur
les leçons des parties précédentes.
Commencez par <a href="#premier-contact">Premier Contact</a>, elle vous exposera,
via les plus simples exemples, les idées clefs. Son but est
d&rsquo;ouvrir votre esprit à des manières d&rsquo;utiliser les types et données
que vous n&rsquo;avez vraisemblablement jamais soupçonnées.
Arpentez ensuite
<a href="#cas-d-utilisation-simples-et-utiles-relations-sur-les-types">Cas d’utilisation simples et utiles: relations sur les types</a>,
pour un premier défi devant un usage pratique.
Après cela seulement vous serez prêt·e pour
<a href="#cas-d-utilisation-plus-avanc%C3%A9s">Cas d’Utilisation Plus Avancés</a>.</p>
<p>Assurez vous de <strong>lire <a href="#lisez-moi">LISEZ-MOI</a></strong>, cette section contient de précieuses
astuces pour faciliter votre parcours.</p>
<h2 id="remerciements">Remerciements</h2>
<p>Nous tenons à remercier <a href="http://www.laure-juglaret.fr/">Laure Juglaret</a> pour
ses nombreuses relectures, ses précieuses remarques et corrections.</p>
<h2 id="lisez-moi">LISEZ-MOI</h2>
<p>Durant toute cette présentation, nous considérerons que:</p>
<ul>
<li><code>null</code> <strong>n&rsquo;existe pas!</strong></li>
<li><strong>La réflexion au runtime n&rsquo;existe pas!</strong> (c.-à-d. <code>isInstanceOf</code>, <code>getClass</code>, etc)</li>
</ul>
<p>Cette présentation considère que <em>ces fonctionnalités n&rsquo;existent pas du tout!</em>.</p>
<p><strong>Leur utilisation n&rsquo;amènera jamais à une réponse correcte aux questions.</strong>.</p>
<p>Pour faire cet atelier vous devez disposez du nécessaire pour écrire, compiler et
exécuter rapidement du code <em>Scala</em>. Le meilleur moyen est d&rsquo;ouvrir une session
interactive (<em>R.E.P.L.</em>). Si vous avez <em>Scala</em> d&rsquo;installé sur votre système, vous
pouvez facilement en démarrer une via la ligne de commande en exécutant le programme
<code>scala</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">system<span style="color:#f92672">-</span>command<span style="color:#f92672">-</span>line<span style="color:#66d9ef">#</span> scala
<span style="color:#a6e22e">Welcome</span> to <span style="color:#a6e22e">Scala</span> <span style="color:#ae81ff">2.13</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">OpenJDK</span> <span style="color:#ae81ff">64</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Bit</span> <span style="color:#a6e22e">Server</span> <span style="color:#a6e22e">VM</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Java</span> <span style="color:#ae81ff">1.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>_222<span style="color:#f92672">).</span>
<span style="color:#a6e22e">Type</span> in expressions <span style="color:#66d9ef">for</span> evaluation<span style="color:#f92672">.</span> <span style="color:#a6e22e">Or</span> <span style="color:#66d9ef">try</span> <span style="color:#66d9ef">:</span><span style="color:#66d9ef">help.</span>

<span style="color:#66d9ef">scala&gt;</span>
</code></pre></div><p>Pour rappel, dans une session interactive (<em>R.E.P.L.</em>),
la commande <code>:paste</code> permet de copier du code dans la session
et la commande <code>:reset</code> de repartir d&rsquo;un environnement vierge.</p>
<p>Si vous n&rsquo;avez pas <em>Scala</em> d&rsquo;installé, <strong>vous pouvez utiliser</strong> le
site <a href="https://scastie.scala-lang.org/">https://scastie.scala-lang.org/</a> .</p>
<h2 id="échauffements">Échauffements</h2>
<p>Cette section est un bref rappel de quelques définitions et propriétés sur
les types et les valeurs.</p>
<h3 id="valeurs-et-types"><em>Valeurs</em> et <em>Types</em>?</h3>
<p>Les <strong>valeurs</strong> sont les <em>données concrètes que vos programmes manipulent</em>
comme l&rsquo;entier <code>5</code>, le booléen <code>true</code>, la chaîne <code>&quot;Hello World!&quot;</code>,
la fonction <code>(x: Double) =&gt; x / 7.5</code>, la liste <code>List(1,2,3)</code>, etc.
Il est souvent pratique de classer les valeurs en groupes. Ces groupes sont appelés
des <strong>types</strong>. Par exemple:</p>
<ul>
<li><code>Int</code> est le groupe des valeurs entières, c.-à-d. les valeurs telles que <code>1</code>, <code>-7</code>, <code>19</code>, etc.</li>
<li><code>Boolean</code> est le groupe contenant exactement les valeurs
<code>true</code> et <code>false</code> (ni plus, ni moins!).</li>
<li><code>String</code> est le groupe dont les valeurs sont <code>&quot;Hello World!&quot;</code>, <code>&quot;&quot;</code>, <code>&quot;J' ❤️ les GADTs&quot;</code>, etc.</li>
<li><code>Double =&gt; Double</code> est le groupe dont les valeurs sont les fonctions prenant en argument
n&rsquo;importe quel <code>Double</code> et renvoyant également un double <code>Double</code>.</li>
</ul>
<p>Pour indiquer que la valeur <code>v</code> appartient au type (c.-à-d. groupe de valeurs) <code>T</code>,
la notation est <code>v : T</code>. En <em>Scala</em>, tester si une valeur <code>v</code> appartient au type <code>T</code>
est très simple: il suffit de taper <code>v : T</code> dans la session interactive (<em>REPL</em>):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span>
res7<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</code></pre></div><p>Si <em>Scala</em> l&rsquo;accepte, alors <code>v</code> appartient bien au type <code>T</code>. Si <em>Scala</em> râle,
ce n&rsquo;est probablement pas le cas:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span>
       <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">mismatch</span><span style="color:#f92672">;</span>
        found   <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">required:</span> <span style="color:#66d9ef">String</span>
</code></pre></div><h3 id="combien-de-types">Combien de types?</h3>
<p>Créons maintenant quelques types et quelques unes de leurs valeurs (quand cela est possible!).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UnType</span>
</code></pre></div><ul>
<li>
<p><strong>Question 1:</strong> Combien de types la ligne <code>class UnType</code> définit-elle?</p>
<!-- raw HTML omitted -->
<p>Comme son nom le suggère, la ligne <code>class UnType</code> définit seulement un type, nommé <code>UnType</code>.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<p>Passons maintenant à:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UnTypePourChaque</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
</code></pre></div><ul>
<li>
<p><strong>Question 2:</strong> Combien de types la ligne <code>class UnTypePourChaque[A]</code> définit-elle?</p>
<!-- raw HTML omitted -->
<p>Comme son nom le suggère, chaque type concret <code>A</code> donne lieu à
un type distinct <code>UnTypePourChaque[A]</code>.</p>
<p>Par exemple, une liste d&rsquo;entiers n&rsquo;est ni une liste de booléens,
ni une liste de chaîne de caractères, ni une liste de fonctions, ni &hellip;
En effet les types <code>List[Int]</code>, <code>List[Boolean]</code>,
<code>List[Int =&gt; Int]</code>, etc sont tous des types distincts.</p>
<p>la ligne <code>class UnTypePourChaque[A]</code> définit
<strong>un type distinct pour chaque type concret</strong> <code>A</code>.
Il y a une infinité de types concrets <code>A</code>,
donc une infinité de de types distincts <code>UnTypePourChaque[A]</code>.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 3:</strong> Donnez une valeur qui appartient à la fois aux types
<code>UnTypePourChaque[Int]</code> et <code>UnTypePourChaque[Boolean]</code>.</p>
<p><strong>Pour rappel, <code>null</code> n&rsquo;existe pas!</strong></p>
<!-- raw HTML omitted -->
<p>C&rsquo;est en fait impossible. Chaque type concret <code>A</code> donne lieu
à un type distinct <code>UnTypePourChaque[A]</code> qui n&rsquo;a aucune valeur en commun
avec les autres types de la forme <code>UnTypePourChaque[B]</code> avec <code>B ≠ A</code>.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<h3 id="combien-de-valeurs">Combien de valeurs?</h3>
<p>En considérant le type suivant:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PasDeValeurPourCeType</span>
</code></pre></div><ul>
<li>
<p><strong>Question 1:</strong> Donnez une valeur appartenant au type <code>PasDeValeurPourCeType</code>?
Combien de valeurs appartiennent au type <code>PasDeValeurPourCeType</code>?</p>
<!-- raw HTML omitted -->
<ul>
<li>Qu&rsquo;est ce qu&rsquo;une classe <code>final</code>? En quoi est-ce qu&rsquo;elle diffère d&rsquo;une classe normale (non finale)?</li>
<li>Qu&rsquo;est ce qu&rsquo;une classe <code>abstract</code>? En quoi est-ce qu&rsquo;elle diffère d&rsquo;une classe concrète?</li>
</ul>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>La classe <code>PasDeValeurPourCeType</code> est déclarée comme <code>abstract</code>.
Cela signifie qu&rsquo;il est interdit de créer des instances directes de cette classe:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">PasDeValeurPourCeType</span>
       <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">PasDeValeurPourCeType</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">abstract</span><span style="color:#f92672">;</span> cannot be instantiated
</code></pre></div><p>La seule manière de créer une instance d&rsquo;une classe abstraite est de créer une
une sous-classe concrète. Mais le mot clef <code>final</code> interdit la création de
telles sous-classes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SousClasseConcrete</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">PasDeValeurPourCeType</span>
                                        <span style="color:#f92672">^</span>
        error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">illegal</span> <span style="color:#66d9ef">inheritance</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">PasDeValeurPourCeType</span>
</code></pre></div><p>Il n&rsquo;existe aucun moyen de créer une instance pour <code>PasDeValeurPourCeType</code>.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<p>Prenons un autre exemple:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ExactementUneValeur</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">LaSeuleValeur</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExactementUneValeur</span>
</code></pre></div><ul>
<li>
<p><strong>Question 2:</strong> Donnez une valeur appartenant au type <code>ExactementUneValeur</code>?</p>
<!-- raw HTML omitted -->
<p>Par définition, <code>LaSeuleValeur</code> est une valeur du type <code>ExactementUneValeur</code>.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 3:</strong> Combien de valeurs appartiennent à <code>ExactementUneValeur</code>?</p>
<!-- raw HTML omitted -->
<p>Comme ci-dessus, <code>ExactementUneValeur</code>, étant un <code>trait</code>, est <em>abstrait</em>. Étant <code>sealed</code>,
l&rsquo;étendre en dehors de son fichier source est interdit.
Donc <code>LaSeuleValeur</code> est la seule valeur du type <code>ExactementUneValeur</code>.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<h2 id="premier-contact">Premier Contact</h2>
<p>Cette partie présente les idées clefs. Il y a en fait seulement
deux idées! Vous trouverez ici des exemples épurés illustrant chacune
de ces deux idées.</p>
<h3 id="cas-dutilisation-preuve-dune-propriété">Cas d&rsquo;Utilisation: Preuve d&rsquo;une propriété</h3>
<p>Définissons un simple <em>sealed trait</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">AValue</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Char</span><span style="color:#f92672">]</span>
</code></pre></div><ul>
<li>
<p><strong>Question 1:</strong> Donnez une valeur du type <code>ATrait[Char]</code>.</p>
<!-- raw HTML omitted -->
<p>Par définition, <code>AValue</code> est une valeur du type <code>ATrait[Char]</code>.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 2:</strong> Donnez une valeur du type <code>ATrait[Double]</code>.</p>
<!-- raw HTML omitted -->
<p>Il n&rsquo;existe aucun moyen d&rsquo;obtenir une instance du type <code>ATrait[Double]</code>.
Il n&rsquo;existe en fait aucun moyen d&rsquo;obtenir une instance de <code>ATrait[B]</code> pour <code>B ≠ Char</code>
parce que la seule valeur possible est <code>AValue</code> qui est de type <code>ATrait[Char]</code>.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 3:</strong> Que pouvez vous conclure sur le type <code>A</code> si vous avez une valeur
<code>ev</code> de type <code>ATrait[A]</code> (c.-à-d. <code>ev: ATrait[A]</code>)?</p>
<!-- raw HTML omitted -->
<p>La seule valeur possible est <code>AValue</code>, donc <code>ev == AValue</code>.
De plus <code>AValue</code> est de type <code>ATrait[Char]</code> donc <code>A = Char</code>.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 4:</strong> Dans la session interactive (<em>REPL</em>), entrez le code suivant:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span>
  x
</code></pre></div></li>
<li>
<p><strong>Question 5:</strong> Essayez maintenant en utilisant un filtrage par motif
(pattern matching) sur <code>ev: ATrait[A]</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span>
  ev <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">AValue</span> <span style="color:#66d9ef">=&gt;</span> x
  <span style="color:#f92672">}</span>
</code></pre></div><p>Le filtrage par motif (pattern-matching) est il exhaustif?</p>
<!-- raw HTML omitted -->
<p>Le filtrage par motif est exhaustif parce la seule et unique valeur possible
pour <code>ev</code> est en fait <code>AValue</code>. De plus <code>AValue</code> est de type <code>ATrait[Char]</code> ce qui signifie
que <code>ev : ATrait[Char]</code> parce que <code>ev == AValue</code>. Donc <code>A = Char</code> et <code>x : Char</code>.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 6:</strong> Appelez <code>f</code> avec <code>x = 'w' : Char</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">Char</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#39;w&#39;</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">AValue</span><span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span> w
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 7:</strong> Appelez <code>f</code> avec <code>x =  5.2 : Double</code>.</p>
<!-- raw HTML omitted -->
<p>C&rsquo;est impossible parce que cela demenderait de fournir une valeur
<code>ev : ATrait[Double]</code>, ce qui n&rsquo;existe pas!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">](</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">AValue</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">^</span>
          error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">mismatch</span><span style="color:#f92672">;</span>
            found   <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AValue.type</span>
            required<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<!-- raw HTML omitted -->
<p>En utilisant toutes les chouettes fonctionnalités syntaxiques de <em>Scala</em>,
la version satisfaisante en production du code ci-dessus est:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">IsChar</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Evidence</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Char</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> evidence<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    evidence
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A:</span> <span style="color:#66d9ef">IsChar</span><span style="color:#f92672">](</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Evidence</span> <span style="color:#66d9ef">=&gt;</span> x
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<h3 id="cas-dutilisation-la-seule-chose-que-je-sais-est-quil-existe">Cas d&rsquo;Utilisation: La seule chose que je sais, est qu&rsquo;il existe</h3>
<p>Que feriez vous si vous vouliez que votre application tienne un journal d’évènements (c.-à-d. un <em>log</em>),
mais que vous vouliez être sur qu&rsquo;elle ne dépende d&rsquo;aucun détail d&rsquo;implémentation de la méthode
de journalisation (c.-à-d. du <em>logger</em>), de telle manière que vous puissiez changer son implémentation
sans risquer de casser votre application?</p>
<p>En considérant le type suivant, <code>UnknownLogger</code>, des méthodes de journalisation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">UnknownLogger</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> appendMessage<span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> X<span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">UnknownLogger</span>
</code></pre></div><p>La première méthode (c.-à-d. *<em>logger</em>) que nous créons stocke les messages dans une <code>String</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> loggerStr <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> logs <span style="color:#f92672">++</span> message<span style="color:#f92672">)</span>
</code></pre></div><p>La seconde méthode les stocke dans une <code>List[String]</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> loggerList <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]](</span><span style="color:#a6e22e">Nil</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">],</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> message <span style="color:#66d9ef">:</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">logs</span><span style="color:#f92672">)</span>
</code></pre></div><p>La troisième méthode de journalisation imprime directement les messages sur la sortie standard:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> loggerStdout <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]((),</span> <span style="color:#f92672">(</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>message<span style="color:#f92672">))</span>
</code></pre></div><p>Notez que ces trois méthodes de journalisation ont toutes le même type
(c.-à-d. <code>UnknownLogger</code>) mais qu&rsquo;elles stockent les messages en utilisant
différents types <code>X</code> (<code>String</code>, <code>List[String]</code> et <code>Unit</code>).</p>
<ul>
<li>
<p><strong>Question 1:</strong> Soit <code>v</code> une valeur de type <code>UnknownLogger</code>.
Clairement <code>v</code> doit être une instance de la classe <code>LogWith[X]</code> pour un certain <code>X</code>.
Que pouvez vous dire sur le type <code>X</code>? Pouvez-vous deviner quel type concret est <code>X</code>?</p>
<p><strong>Pour rappel, il est interdit d&rsquo;utiliser la réflexion au runtime!</strong> (c.-à-d. <code>isInstanceOf</code>, <code>getClass</code>, etc)</p>
<!-- raw HTML omitted -->
<p>Nous ne savons presque rien sur <code>X</code>. La seule chose que nous avons est qu&rsquo;il existe au
moins une valeur (<code>v.logs</code>) de type <code>X</code>. À part cela, <code>X</code> peut être n&rsquo;importe quel type.</p>
<p>Ne pas savoir quel type concret est <code>X</code> est très utile pour garantir que le code qui utilisera
<code>v : UnknownLogger</code> ne dépendra pas de la nature de <code>X</code>. Si ce code savait que <code>X</code> était
<code>String</code> par exemple, il pourrait exécuter des opérations que nous voulons interdir comme inverser
la liste, ne retenir que les <em>n</em> premiers caractères, etc. En cachant la nature de<code>X</code>, nous forçons
notre application à ne pas dépendre du type concret derrière<code>X</code> mais de n&rsquo;utiliser que la
fonnction fournie <code>v.appendMessage</code>.
Ainsi changer l&rsquo;implémentation réelle de la méthode de journalisation ne cassera aucun code.</p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 2:</strong> Écrivez la fonction <code>def log(message: String, v: UnknownLogger): UnknownLogger</code>
qui utilise <code>v.appendMessage</code> pour ajouter le <code>message</code> au journal <code>v.logs</code>
et retourne un nouvel <code>UnknownLogger</code> contenant le nouveau journal (c.-à-d. le nouveau <code>log</code>).</p>
<p>Pour rappel, en <em>Scala</em>, le motif (c.-à-d. pattern) <code>case ac : AClass[t] =&gt;</code>
est possible dans les expressions de type <code>match/case</code> comme alternative au motif
<code>case AClass(v) =&gt; </code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AClass</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span>

<span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>v<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AClass</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> ac <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AClass</span><span style="color:#f92672">[</span><span style="color:#66d9ef">t</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#75715e">// La variable `t` is une variable de type
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// Le type `t` est `A`
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">val</span> r <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">t</span> <span style="color:#f92672">=</span> ac<span style="color:#f92672">.</span>value
      r
  <span style="color:#f92672">}</span>
</code></pre></div><p>Son principal avantage est d&rsquo;introduire la variable de type <code>t</code>.
Les variables de type se comportent comme des variables de motif classiques
(c.-à-d. pattern variables) à l&rsquo;exception prés qu&rsquo;elles représentent des
types et non des valeurs.
Avoir <code>t</code> sous la main nous permet d&rsquo;aider le compilateur en donnant
explicitement certains types (comme ci-dessus, expliciter que <code>r</code> est de type <code>t</code>).</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> log<span style="color:#f92672">(</span>message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> v<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> vx <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">x</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">x</span><span style="color:#f92672">](</span>vx<span style="color:#f92672">.</span>appendMessage<span style="color:#f92672">(</span>vx<span style="color:#f92672">.</span>logs<span style="color:#f92672">,</span> message<span style="color:#f92672">),</span> vx<span style="color:#f92672">.</span>appendMessage<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 3:</strong> Exécutez <code>log(&quot;Hello World&quot;, loggerStr)</code> et <code>log(&quot;Hello World&quot;, loggerList)</code>
et <code>log(&quot;Hello World&quot;, loggerStdout)</code></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">,</span> loggerStr<span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Hello</span> <span style="color:#a6e22e">World</span><span style="color:#f92672">,</span><span style="color:#a6e22e">$$Lambda$988</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1455466014</span><span style="color:#66d9ef">@</span><span style="color:#ae81ff">421</span>ead7e<span style="color:#f92672">)</span>

scala<span style="color:#f92672">&gt;</span> log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">,</span> loggerList<span style="color:#f92672">)</span>
res1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Hello</span> <span style="color:#a6e22e">World</span><span style="color:#f92672">),</span><span style="color:#a6e22e">$$Lambda$989</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1705282731</span><span style="color:#66d9ef">@</span><span style="color:#ae81ff">655621</span>fd<span style="color:#f92672">)</span>

scala<span style="color:#f92672">&gt;</span> log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">,</span> loggerStdout<span style="color:#f92672">)</span>
<span style="color:#a6e22e">Hello</span> <span style="color:#a6e22e">World</span>
res2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">((),</span><span style="color:#a6e22e">$$Lambda$990</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1835105031</span><span style="color:#66d9ef">@</span><span style="color:#ae81ff">340</span>c57e0<span style="color:#f92672">)</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<!-- raw HTML omitted -->
<p>Une fois encore, en utilisant toutes les chouettes fonctionnalités syntaxiques de <em>Scala</em>,
la version satisfaisante en production du code ci-dessus est:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">UnknownLogger</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">LogsType</span>
  <span style="color:#66d9ef">val</span> logs <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span>
  <span style="color:#66d9ef">def</span> appendMessage<span style="color:#f92672">(</span>presentLogs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">UnknownLogger</span> <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> appendMessage_ <span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> X<span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">UnknownLogger</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">LogsType</span> <span style="color:#f92672">=</span> X
    <span style="color:#66d9ef">def</span> appendMessage<span style="color:#f92672">(</span>presentLogs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span> <span style="color:#f92672">=</span>
      appendMessage_<span style="color:#f92672">(</span>presentLogs<span style="color:#f92672">,</span> message<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> appendMessage<span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> X<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
    <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs<span style="color:#f92672">,</span> appendMessage<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<h3 id="conclusion-intermédiaire">Conclusion Intermédiaire</h3>
<p>Les <em>GADTs</em> ne sont en fait que ceci: de simples <em>sealed trait</em> avec quelques
<em>case object</em> (possiblement aucun) et quelques <em>final case class</em> (également possiblement aucune!).
Dans les parties suivantes, nous explorerons quelques un des cas d&rsquo;utilisation
majeurs des <em>GADTs</em>.</p>
<h2 id="cas-dutilisation-simples-et-utiles-relations-sur-les-types">Cas d&rsquo;utilisation simples et utiles: relations sur les types</h2>
<p>Une faculté simple mais très utile des <em>GADTs</em> est l&rsquo;expression de relations sur les types telles que:</p>
<ul>
<li>Le type <code>A</code> est-il égal au type <code>B</code>?</li>
<li>Le type <code>A</code> est-il un sous-type de <code>B</code>?</li>
</ul>
<p>Notez bien que, par définition, tout type <code>A</code> est sous-type de lui-même (c.-à-d. <code>A &lt;: A</code>),
tout comme tout entier <code>x</code> est également inférieur ou égal à lui-même <code>x ≤ x</code>.</p>
<h3 id="cas-dutilisation-témoin-dégalité-entre-types">Cas d&rsquo;Utilisation: Témoin d&rsquo;Égalité entre Types</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span>
</code></pre></div><ul>
<li>
<p><strong>Question 1:</strong> Donnez une valeur de type <code>EqT[Int, Int]</code></p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>,<span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">()</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 2:</strong> Donnez une valeur de type <code>EqT[String, Int]</code></p>
<!-- raw HTML omitted -->
<p>La classe <code>Evidence</code> est l&rsquo;unique sous-classe conctrète du trait <code>EqT</code> et il est
impossible d&rsquo;en créer une autre parce que <code>EqT</code> est <code>sealed</code>. Donc une valeur <code>v : EqT[A,B]</code>
ne peut être qu&rsquo;une instance de <code>Evidence[X]</code> pour un certain type <code>X</code>, qui elle-même est
de type <code>EqT[X,X]</code>.
Ainsi il n&rsquo;y a aucun moyen d&rsquo;obtenir une valeur de type <code>EqT[String, Int]</code></p>
<!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 3:</strong> Soient <code>A</code> et <code>B</code> deux types (inconnus).
Si je vous donne une valeur de type <code>EqT[A,B]</code>, que pouvez-vous en déduire sur <code>A</code> et <code>B</code>?</p>
<!-- raw HTML omitted -->
<p>Si je vous donne une valeur <code>v : EqT[A,B]</code>, alors vous savez que <code>v</code> est une instance
de <code>Evidence[X]</code> pour un certain type <code>X</code> (inconnu). En effet la classe <code>Evidence</code>  est la seule
et unique sous-classe concrète du <code>sealed trait</code> <code>EqT</code>. En fait, <code>Evidence[X]</code> est un sous-type de
<code>EqT[X,X]</code>. Donc <code>v : EqT[X,X]</code>. Les types <code>EqT[A,B]</code> et <code>EqT[X,X]</code> n&rsquo;ont aucune valeur en commun
si <code>A ≠ X</code> ou <code>B ≠ X</code>, donc <code>A = X</code> et <code>B = X</code>. Et donc <code>A = B</code>. CQFD.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<!-- raw HTML omitted -->
<p>En production, il est pratique de définir <code>EqT</code> de la manière suivante, qui est bien entendu équivalente:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">EqT</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> evidence<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]()</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<h4 id="passer-dun-type-égal-à-lautre">Passer d&rsquo;un type égal à l&rsquo;autre</h4>
<p>Si <code>A</code> et <code>B</code> sont en fait le même type, alors <code>List[A]</code> est également le même
type que <code>List[B]</code>, <code>Option[A]</code> est également le même type que <code>Option[B]</code>,
etc. De manière générale, pour n&rsquo;importe quel <code>F[_]</code>, <code>F[A]</code> est également le même type
que <code>F[B]</code>.</p>
<ul>
<li>
<p><strong>Question 4:</strong> Écrivez la fonction <code>def coerce[F[_],A,B](eqT: EqT[A,B])(fa: F[A]): F[B]</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> coerce<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span>,<span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])(</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  eqT <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">x</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span> fa
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>La bibliothèque standard de <em>Scala</em> définit déjà une classe, nommée <code>=:=[A,B]</code>
(son nom est bel et bien <code>=:=</code>), représentant l&rsquo;égalité entre types.
Je vous recommande vivement de jeter un œil
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html">à sa documentation (cliquez ici)</a>.
Fort heureusement, pour plus de lisibilité, <em>Scala</em> nous permet d&rsquo;écrire <code>A =:= B</code> le type <code>=:=[A,B]</code>.</p>
<p>Étant donné deux types <code>A</code> et <code>B</code>, avoir une instance (c.-à-d. objet)
de <code>A =:= B</code> prouve que <code>A</code> et <code>B</code> sont en réalité le même type,
tout comme pour <code>EqT[A,B]</code>.
Pour rappel, <code>A =:= B</code> n&rsquo;est que du sucre syntaxique pour désigner le type <code>=:=[A,B]</code>.</p>
<p>Des instances de <code>A =:= B</code> peuvent êtres crées en utilisant la fonction
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less$.html#refl%5BA%5D:A=:=A"><code>(&lt;:&lt;).refl[X]: X =:= X</code>
(cliquer pour voir la documentation)</a>.
Le &ldquo;symbole&rdquo; <code>&lt;:&lt;</code> est en effet un nom d&rsquo;objet valide.</p>
<ul>
<li>
<p><strong>Question 5:</strong> En utilisant la fonction <code>coerce</code> ci-dessus,
écrivez la fonction <code>def toScalaEq[A,B](eqT: EqT[A,B]): A =:= B</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> toScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">/* Trouver une définition pour:
</span><span style="color:#75715e">        - le constructeur de type `F`
</span><span style="color:#75715e">        - la valeur `fa : F[A]`
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
  <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>

  <span style="color:#75715e">/* Telles que cet appel: */</span>
  coerce<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>,<span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#f92672">)(</span>fa<span style="color:#f92672">)</span> <span style="color:#75715e">// soit de type `F[B]`
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> toScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> A <span style="color:#f92672">=:=</span> X
  <span style="color:#66d9ef">val</span> fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">(&lt;:&lt;).</span>refl<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
  coerce<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>,<span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#f92672">)(</span>fa<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 6:</strong> En utilisant la <em>méthode</em> <code>substituteCo[F[_]](ff: F[A]): F[B]</code> des
objets de la classe <code>A =:= B</code>, dont la
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html#substituteCo%5BF%5B_%5D%5D(ff:F%5BFrom%5D):F%5BTo%5D">documentation est ici</a>,
écrivez la fonction <code>def fromScalaEq[A,B](scala: A =:= B): EqT[A,B]</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> fromScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>scala<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">/* Trouver une définition pour:
</span><span style="color:#75715e">        - le constructeur de type `F`
</span><span style="color:#75715e">        - la valeur `fa : F[A]`
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
  <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>

  <span style="color:#75715e">/* Telles que cet appel: */</span>
  scala<span style="color:#f92672">.</span>substituteCo<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">](</span>fa<span style="color:#f92672">)</span> <span style="color:#75715e">// soit de type `F[B]`
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> fromScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>scala<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">val</span> fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]()</span>
  scala<span style="color:#f92672">.</span>substituteCo<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">](</span>fa<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<h3 id="cas-dutilisation-témoin-de-sous-typage">Cas d&rsquo;Utilisation: Témoin de Sous-Typage</h3>
<p>Dans cette section, nous voulons créer les types <code>SubTypeOf[A,B]</code> dont les valeurs
prouvent que le type <code>A</code> est un sous-type de <code>B</code> (c.-à-d. <code>A &lt;: B</code>).
Une classe similaire, <em>mais différente</em>, est déjà définie dans la
bibliothèque standard de <em>Scala</em>.
Il s&rsquo;agit de la classe <code>&lt;:&lt;[A,B]</code>, qui est le plus souvent écrite <code>A &lt;:&lt; B</code>. Sa
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less.html">documentation est ici</a>.
Cette section étant dédiée à l&rsquo;implémentation d&rsquo;une variante de cette classe,
veuillez <strong>ne pas utiliser</strong> <code>&lt;:&lt;[A,B]</code> pour implémenter <code>SubTypeOf</code>.</p>
<ul>
<li>
<p><strong>Question 1:</strong> En utilisant uniquement des <em>bornes supérieures</em> (c.-à-d. <code>A &lt;: B</code>)
ou <em>bornes inférieures</em> (c.-à-d. <code>A &gt;: B</code>) et <strong>aucune</strong> <em>annotation de variance</em>
(c.-à-d. <code>[+A]</code> et <code>[-A]</code>),
créez le trait <code>SubTypeOf[A,B]</code> (et tout ce qui est nécessaire) tel que:</p>
<blockquote>
<p>Il existe une valeur de type <code>SubType[A,B]</code> <strong>si et seulement si</strong>
<code>A</code> est un sous-type de <code>B</code> (c.-à-d. <code>A &lt;: B</code>).</p>
</blockquote>
<p>Pour rappel, par définition, un type <code>A</code> est un sous-type de lui-même (c.-à-d. <code>A &lt;: A</code>).</p>
<p>Pour rappel, n&rsquo;utilisez pas la classe <code>&lt;:&lt;[A,B]</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SubTypeEvidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">B</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
</code></pre></div><!-- raw HTML omitted -->
<p>En production, il est pratique de définir <code>SubTypeOf</code> de la manière équivalente suivante:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">SubTypeOf</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">B</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> evidence<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">B</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]()</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
</li>
</ul>
<h3 id="cas-dutilisation-éviter-les-messages-derreur-de-scalac-à-propos-des-bornes-non-respectées">Cas d&rsquo;Utilisation: Éviter les messages d&rsquo;erreur de <em>scalac</em> à propos des bornes non respectées</h3>
<p>Dans cet exemple, nous voulons modéliser le régime alimentaire de certains animaux.
Commençons par définir le type <code>Food</code> (c.-à-d. nourriture) et quelques-uns de ces sous-types:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Food</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Vegetable</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Food</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fruit</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Food</span>
</code></pre></div><p>et maintenant la classe représentant les animaux mangeant de la nourriture de type <code>A</code>
(c.-à-d. <code>Vegetable</code>, <code>Fruit</code>, etc):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Food</span><span style="color:#f92672">]</span>

<span style="color:#a6e22e">val</span> elephant <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">]</span>
</code></pre></div><p>Définissons une fonction comme il en existe tant en <em>Programmation Fonctionnelle</em>
et passons lui <code>elephant</code> comme argument:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ok!&#34;</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">](</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">))</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span>

scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span>, <span style="color:#66d9ef">Boolean</span><span style="color:#f92672">](</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">))</span>
res1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span>

scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">AnimalEating</span>, <span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span>elephant<span style="color:#f92672">)</span>
            <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">kinds</span> <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">the</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">arguments</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">AnimalEating</span><span style="color:#f92672">,</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">)</span>
       <span style="color:#66d9ef">do</span> not conform to the expected kinds of the <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">parameters</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">,</span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">).</span>

       <span style="color:#a6e22e">AnimalEating</span>&#39;s <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">parameters</span> <span style="color:#66d9ef">do</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">match</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">expected</span> <span style="color:#66d9ef">parameters:</span>
       <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">A</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">bounds</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Food</span> <span style="color:#66d9ef">are</span> <span style="color:#66d9ef">stricter</span> <span style="color:#66d9ef">than</span>
       <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">_</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">declared</span> <span style="color:#66d9ef">bounds</span> <span style="color:#66d9ef">&gt;:</span> <span style="color:#66d9ef">Nothing</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Any</span>
</code></pre></div><ul>
<li>
<p><strong>Question 1:</strong> Pourquoi <em>scalac</em> se plaint il?</p>
<!-- raw HTML omitted -->
<p>La fonction <code>dummy</code> requiert que son argument <code>F</code>, qui est un constructeur
de type comme le sont <code>List</code>, <code>Option</code>, <code>Future</code>, etc, accepte n&rsquo;importe quel type
en argument afin qu&rsquo;il soit toujours possible d&rsquo;écrire <code>F[A]</code> pour n&rsquo;importe quel type <code>A</code>.
Hors <code>AnimalEating</code> impose que son argument soit un sous-type de <code>Food</code>.
Donc <code>AnimalEating</code> ne peut être utilisé comme argument <code>F</code> de <code>dummy</code>.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<p>Le problème est que, en définissant <code>class AnimalEating[A &lt;: Food]</code>,
nous avons imposé à <code>A</code> d&rsquo;être un sous-type de <code>Food</code>. Donc <em>Scala</em>, tout comme <em>Java</em>,
nous interdit de donner à <code>AnimalEating</code>, en tant qu&rsquo;argument <code>A</code>, autre chose
qu&rsquo;un sous-type de <code>Food</code> (en incluant <code>Food</code> lui-même):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">T1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span>
                 <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">arguments</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">do</span> not conform
       to <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimalEating</span>&#39;s <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">bounds</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Food</span><span style="color:#f92672">]</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">T2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Food</span><span style="color:#f92672">]</span>
defined <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">T2</span>
</code></pre></div><p>Nous sommes face à un dilemme: afin d&rsquo;utiliser la fonction <code>dummy</code>, que nous tenons
beaucoup à utiliser parce c&rsquo;est une fonction très utile, il nous faut supprimer la
contrainte <code>A &lt;: Food</code> de la définition <code>class AnimalEating[A &lt;: Food]</code>.
Mais nous tenons également au fait que les animaux ne mangent que de la nourriture (<code>Food</code>)
et pas des entiers, ni des booléens et encore moins des chaînes de caractères!</p>
<ul>
<li>
<p><strong>Question 2:</strong> Comment pouvez vous adapter la définition de <code>AnimalEating</code> telle que:</p>
<ul>
<li>
<p>Il soit possible d&rsquo;appeler <code>dummy</code> avec comme argument <code>elephant</code>! Nous voulons:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">AnimalEating</span>, <span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span>elephant<span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span>
</code></pre></div></li>
<li>
<p><em>Si</em> <code>A</code> <strong>n&rsquo;est pas un sous-type</strong> de <code>Food</code> (<code>Food</code> lui-même inclus),
<em>alors</em> il doit être <strong>impossible</strong> de créer une instance de <code>AnimalEating[A]</code>.</p>
</li>
<li>
<p>La classe <code>AnimalEating</code> <strong>doit</strong> rester une classe ouverte
(c.-à-d. non <code>sealed</code> ou <code>final</code>)! Il doit toujours être possible pour n&rsquo;importe qui,
n&rsquo;importe quand, de créer librement des sous-classes de <code>AnimalEating</code>.
Bien évidemment, ces sous-classes doivent respecter les deux contraintes
ci-dessus.</p>
<!-- raw HTML omitted -->
<p>En <em>Scala</em>, <code>Nothing</code> est un type ne contenant aucune valeur.
Pouvez vous créer une valeur de type <code>(Nothing, Int)</code>? Pourquoi?</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p>Si, afin de créer une instance de <code>AnimalEating[A]</code>, nous forçons <strong>chaque</strong>
méthode créant des valeurs à prendre un paramètre supplémentaire de type <code>SubTypeOf[A, Food]</code>,
alors il sera uniquement possible de créer une instance de <code>AnimalEating[A]</code>
quand <code>A</code> sera un sous-type de <code>Food</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>ev <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">Food</span><span style="color:#f92672">])</span>

<span style="color:#66d9ef">val</span> elephant <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span><span style="color:#a6e22e">SubTypeEvidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span>, <span style="color:#66d9ef">Food</span><span style="color:#f92672">])</span>
</code></pre></div><p>Pour créer une valeur de type <code>AnimalEating[A]</code>, nous avons besoin d&rsquo;appeler
le constructeur d'<code>AnimalEating</code>. Pour appeler ce constructeur,
il nous faut fournir <code>ev : SubTypeOf[A, Food]</code>.</p>
<p>Il nous est désormais possible d&rsquo;appeler la fonction <code>dummy</code> sur <code>elephant</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">AnimalEating</span>, <span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span>elephant<span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span>
</code></pre></div><p>En pratique, en utilisant des implicites, le compilateur peut
fournir de lui-même le paramètre <code>ev : SubTypeOf[A, Food]</code>.</p>
<p>Notez qu&rsquo;il est désormais possible d&rsquo;écrire le type <code>AnimalEating[Int]</code>
mais vous ne pourrez jamais créer une valeur de ce type.</p>
<!-- raw HTML omitted -->
</li>
</ul>
</li>
</ul>
<h3 id="cas-dutilisation-fournir-les-bonnes-données-au-bon-diagramme">Cas d&rsquo;Utilisation: Fournir les bonnes données au bon diagramme</h3>
<p>Ce cas d&rsquo;utilisation traite des méthodes pour garantir, à la compilation,
que seulement les valeurs du bon type peuvent être données à une fonction donnée.
L&rsquo;exemple choisi est celui de la conception d&rsquo;une bibliothèque de graphiques.
Afin de simplifier l&rsquo;exemple, nous considèrerons que notre bibliothèque n&rsquo;implémente
que deux types de graphique:
des <a href="https://www.google.com/search?q=pie+chart&amp;tbm=isch">camemberts (c.-à-d. pie charts)</a>
et des <a href="https://www.google.com/search?q=xy+charts&amp;tbm=isch">graphiques dit XY (c.-à-d. XY charts)</a>.
Cela s&rsquo;écrit en <em>Scala</em> via l&rsquo;énumération:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ChartType</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span>
</code></pre></div><p>Bien évidemment les camemberts (<em>Pie</em>) et graphiques <em>XY</em> s&rsquo;appuient sur des jeux de données de
nature différente. Encore une fois, pour simplifier, nous considèrerons que les deux types
de données sont <code>PieData</code> pour les camemberts et <code>XYData</code> pour les graphiques <em>XY</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PieData</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">XYData</span>
</code></pre></div><p>Un camembert (<code>PieChart</code>) n&rsquo;affiche <strong>que</strong> des données <code>PieData</code>,
alors qu&rsquo;un graphique <em>XY</em> (<code>XYChart</code>) n&rsquo;affiche <strong>que</strong> des données <code>XYData</code>.
Voici, grandement simplifiée, la fonction d&rsquo;affichage <code>draw</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> draw<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>chartType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ChartType</span><span style="color:#f92672">)(</span>data<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
  chartType <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> pieData <span style="color:#66d9ef">=</span> data<span style="color:#f92672">.</span>asInstanceOf<span style="color:#f92672">[</span><span style="color:#66d9ef">PieData</span><span style="color:#f92672">]</span>
      <span style="color:#75715e">// Faire des trucs pour tracer les données pieData
</span><span style="color:#75715e"></span>      <span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> xyData <span style="color:#66d9ef">=</span> data<span style="color:#f92672">.</span>asInstanceOf<span style="color:#f92672">[</span><span style="color:#66d9ef">XYData</span><span style="color:#f92672">]</span>
      <span style="color:#75715e">// Faire des trucs pour tracer les données xyData
</span><span style="color:#75715e"></span>      <span style="color:#f92672">()</span>
  <span style="color:#f92672">}</span>
</code></pre></div><p>Cette fonction repose sur l&rsquo;hypothèse que l&rsquo;utilisateur·rice n&rsquo;appellera la
fonction <code>draw</code> que sur le bon type de données.
Quand <code>chartType</code> vaut <code>PieChart</code>, la fonction présuppose, via
<code>data.asInstanceOf[PieData]</code> que <code>data</code> est en fait du type <code>PieData</code>.
Et quand <code>chartType</code> vaut <code>XYChart</code>, elle présuppose que <code>data</code> est en fait
de type <code>XYData</code>.</p>
<p>Le problème est que ces suppositions reposent sur l&rsquo;idée que les utilisateurs·rices et/ou
développeurs·euses s&rsquo;assureront toujours que ces hypothèses soient bien respectées.
Mais <strong>rien</strong> n&rsquo;empêche quelqu&rsquo;un·e d&rsquo;appeler <code>draw</code> sur un camembert (<code>PieChart</code>)
avec des données de type <code>XYData</code> (ou le contraire),
faisant planter le système misérablement en production!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> draw<span style="color:#f92672">(</span><span style="color:#a6e22e">PieChart</span><span style="color:#f92672">)(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XYData</span><span style="color:#f92672">)</span>
java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCastException</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">XYData</span> <span style="color:#66d9ef">cannot</span> <span style="color:#66d9ef">be</span> <span style="color:#66d9ef">cast</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">PieData</span>
  at <span style="color:#f92672">.</span>draw<span style="color:#f92672">(&lt;</span>pastie<span style="color:#66d9ef">&gt;:</span><span style="color:#ae81ff">11</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">...</span> <span style="color:#ae81ff">28</span> elided
</code></pre></div><p>En tant que développeurs·euses, nous savons que les erreurs, ça arrive!
Nous voulons un moyen d&rsquo;empêcher ces bogues ennuyeux de survenir en production!
Nous voulons imposer, à la compilation, que seulement deux scenarii soit possibles:</p>
<ul>
<li>Quand <code>draw</code> est appelée avec <code>chartType == PieChart</code>:
l&rsquo;argument <code>data</code> doit être de type <code>PieData</code></li>
<li>Quand <code>draw</code> est appelée avec <code>chartType == XYChart</code>:
l&rsquo;argument <code>data</code> doit être de type <code>XYData</code>.</li>
</ul>
<p>Pour rappel, ces deux contraintes doivent être vérifiées à la compilation!</p>
<ul>
<li>
<p><strong>Question 1:</strong> Adaptez les définitions de <code>ChartType</code>, <code>PieChart</code>, <code>XYChart</code> et <code>draw</code> telles que:</p>
<ul>
<li>
<p>Tout scenario différent des deux ci-dessus fera échouer la compilation sur une erreur de type.</p>
</li>
<li>
<p><code>ChartType</code> doit toujours être un <code>sealed trait</code>. Mais il est autorisé à prendre des <em>paramètres de type</em> (c.-à-d. <em>generics</em>).</p>
</li>
<li>
<p><code>PieChart</code> et <code>XYChar</code> doivent toujours être des <code>case object</code>
et ils doivent toujours étendre <code>ChartType</code>.</p>
</li>
<li>
<p>Les déclarations de <code>ChartType</code>, <code>PieChart</code> et <code>XYChar</code>
ne doivent <strong>pas</strong> avoir <strong>de corps</strong> du tout
(c.-à-d. il ne doit pas y avoir d&rsquo;accolades <code>{ ... }</code> dans leurs déclarations);</p>
</li>
</ul>
<!-- raw HTML omitted -->
<p>Le code ressemble à ceci:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*METTRE</span> <span style="color:#66d9ef">LES</span> <span style="color:#66d9ef">GENERICS</span> <span style="color:#66d9ef">ICI*/</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*Il</span> <span style="color:#66d9ef">y</span> <span style="color:#66d9ef">a</span> <span style="color:#66d9ef">quelque</span> <span style="color:#66d9ef">chose</span> <span style="color:#66d9ef">à</span> <span style="color:#66d9ef">écrire</span> <span style="color:#66d9ef">ici*/</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*Il</span> <span style="color:#66d9ef">y</span> <span style="color:#66d9ef">a</span> <span style="color:#66d9ef">quelque</span> <span style="color:#66d9ef">chose</span> <span style="color:#66d9ef">à</span> <span style="color:#66d9ef">écrire</span> <span style="color:#66d9ef">ici</span> <span style="color:#66d9ef">aussi*/</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">def</span> draw<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>chartType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*Ecrire</span> <span style="color:#66d9ef">quelque</span> <span style="color:#66d9ef">chose</span> <span style="color:#66d9ef">ici*/</span><span style="color:#f92672">])(</span>data<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
 chartType <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> pieData <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">PieData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> xyData<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">XYData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">PieData</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">XYData</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">def</span> draw<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>chartType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>data<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
 chartType <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> pieData <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">PieData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> xyData<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">XYData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>Vous pouvez maintenant dormir sur vos deux oreilles avec l&rsquo;assurance que
votre code en production ne plantera pas à cause d&rsquo;une entrée non conforme
à cet endroit 😉</p>
<h2 id="cas-dutilisation-plus-avancés">Cas d&rsquo;Utilisation Plus Avancés</h2>
<p>Maintenant que vous avez vu ce que sont les <em>GADTs</em> et comment les utiliser dans
la vie de tous les jours, vous êtes prêt·e pour les cas d&rsquo;utilisations plus conséquents
ci-dessous.
Il y en a trois. Chacun illustre une manière différente d&rsquo;utiliser la puissance des <em>GADTs</em>.
Le <a href="#cas-d-utilisation-les-effets">premier</a> traite de l&rsquo;expression d&rsquo;effets,
ce qui est très largement utilisé dans chaque monade <em>IO</em> populaire ou effets algébriques.
Ne vous inquiétez pas de ne pas savoir ce que sont ces derniers, cette section l&rsquo;expliquera.
Le <a href="#cas-d-utilisation-s-assurer-que-les-types-sont-pris-en-charge-par-la-base-de-donn%C3%A9es">second</a>
s&rsquo;attache à montrer comment garantir des propriétés dans le système de types.
Ce point est illustré à travers l&rsquo;exemple de l’accommodation des techniques issues
de la programmation fonctionnelle aux contraintes issues des bases de données.
Le <a href="#cas-d-utilisation-simplifier-les-implicites">troisième</a> offre une manière plus simple
de travailler avec des implicites.</p>
<h3 id="cas-dutilisation-les-effets">Cas d&rsquo;Utilisation: Les Effets!</h3>
<p>Ce qui est appelé un effet est parfois juste une interface déclarant quelques
fonctions dépourvues d&rsquo;implémentation. Par exemple nous pouvons définir le
<code>trait</code> ci-dessous. Notez qu&rsquo;<em>aucune</em> de ces fonctions n&rsquo;a d&rsquo;implémentation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ExampleEffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> echo<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span>
  <span style="color:#66d9ef">def</span> randomInt <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span>
  <span style="color:#66d9ef">def</span> ignore<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Les implémentations de ces interfaces (traits) sont données ailleurs, et il peut en avoir beaucoup!
Cela est utile quand il est désirable de changer facilement d&rsquo;implémentation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">ExampleEffectImpl</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> echo<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span> value
  <span style="color:#66d9ef">def</span> randomInt <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> scala<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span><span style="color:#a6e22e">Random</span><span style="color:#f92672">.</span>nextInt<span style="color:#f92672">()</span>
  <span style="color:#66d9ef">def</span> ignore<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">()</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Une manière équivalente de définir <code>ExampleEffectSig</code> est via un <code>sealed trait</code>
muni de quelques <code>final case class</code> (peut-être aucune!) et/ou quelques <code>case object</code> (peut-être aucun!):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Echo</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">RandomInt</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Ignore</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
</code></pre></div><p>De nouveau, nous avons des déclarations ne fournissant aucune implémentation!
De nouveau, leurs implémentations peuvent être fournies ailleurs et il peut en avoir beaucoup:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> runExampleEffect<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Echo</span><span style="color:#f92672">(</span>value<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> value
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">RandomInt</span>   <span style="color:#66d9ef">=&gt;</span> scala<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span><span style="color:#a6e22e">Random</span><span style="color:#f92672">.</span>nextInt<span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Ignore</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>   <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">()</span>
  <span style="color:#f92672">}</span>
</code></pre></div><p>Prenons un effet plus réaliste ainsi qu&rsquo;une de ses implémentations possibles:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">EffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> currentTimeMillis<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span>
  <span style="color:#66d9ef">def</span> printLn<span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span>
  <span style="color:#66d9ef">def</span> mesure<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">EffectImpl</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">EffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> currentTimeMillis<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span> <span style="color:#f92672">=</span>
    <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

  <span style="color:#66d9ef">def</span> printLn<span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
    println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">def</span> mesure<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
    <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
    println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
    r
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<p><strong>Question 1:</strong> Tout comme <code>ExampleEffect</code> est l&rsquo;équivalent de <code>ExampleEffectSig</code>
via la définition d&rsquo;un <code>sealed trait</code> muni de quelques <code>final case class</code> et
<code>case object</code>, écrivez l&rsquo;équivalent de <code>EffectSig</code> de la même manière.
Appelez ce trait <code>Effect</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 2:</strong> Écrivez la fonction <code>def run[A](effect: Effect[A]): A</code> qui reproduit l&rsquo;implémentation de
<code>EffectImpl</code> tout comme <code>runExampleEffect</code> reproduit celle de <code>ExampleEffectImpl</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> run<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">(</span>fun<span style="color:#f92672">,</span> arg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
      r
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>Le type <code>Effect[A]</code> déclare des effets intéressants (<code>CurrentTimeMillis</code>,
<code>PrintLn</code> et <code>Mesure</code>) mais pour être réellement utile, il doit être possible
de chaîner ces effets! Pour ce faire, nous voulons pouvoir disposer des deux fonctions suivantes:</p>
<ul>
<li><code>def pure[A](value: A): Effect[A]</code></li>
<li><code>def flatMap[X,A](fx: Effect[X], f: X =&gt; Effect[A]): Effect[A]</code></li>
</ul>
<p>De nouveau, nous ne nous intéressons pas à leurs implémentations. Tout ce que nous
voulons, pour le moment, est déclarer ces deux opérations de la même manière que
nous avons déclaré <code>CurrentTimeMillis</code>, <code>PrintLn</code> et <code>Mesure</code>.</p>
<ul>
<li>
<p><strong>Question 3:</strong> Ajoutez deux <em>final case classes</em>, <code>Pure</code> et <code>FlatMap</code>,
à <code>Effect[A]</code> déclarant ces deux opérations.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Pure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fx<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">],</span> f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 4:</strong> Adaptez la fonction <code>run</code> pour gérer ces deux nouveaux cas.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> run<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">(</span>fun<span style="color:#f92672">,</span> arg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
      r

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      a

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span>fx<span style="color:#f92672">,</span> f<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> x  <span style="color:#66d9ef">=</span> run<span style="color:#f92672">(</span>fx<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> f<span style="color:#f92672">(</span>x<span style="color:#f92672">)</span>
      run<span style="color:#f92672">(</span>fa<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 5:</strong> Ajoutez les deux méthodes suivantes au trait <code>Effect[A]</code> pour obtenir:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> f<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]((</span>a<span style="color:#66d9ef">:</span><span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>f<span style="color:#f92672">(</span>a<span style="color:#f92672">)))</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Et exécutez le code suivant pour voir s&rsquo;il fonctionne:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> effect1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
    t0 <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">CurrentTimeMillis</span>
    <span style="color:#66d9ef">_</span>  <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;The current time is </span><span style="color:#e6db74">$t0</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span> <span style="color:#66d9ef">yield</span> <span style="color:#f92672">()</span>

run<span style="color:#f92672">(</span>effect1<span style="color:#f92672">)</span>
</code></pre></div><!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> f<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]((</span>a<span style="color:#66d9ef">:</span><span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>f<span style="color:#f92672">(</span>a<span style="color:#f92672">)))</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Pure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fx<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">],</span> f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">def</span> run<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">(</span>fun<span style="color:#f92672">,</span> arg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
      r

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      a

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span>fx<span style="color:#f92672">,</span> f<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> x  <span style="color:#66d9ef">=</span> run<span style="color:#f92672">(</span>fx<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> f<span style="color:#f92672">(</span>x<span style="color:#f92672">)</span>
      run<span style="color:#f92672">(</span>fa<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>

<span style="color:#66d9ef">val</span> effect1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
    t0 <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">CurrentTimeMillis</span>
    <span style="color:#66d9ef">_</span>  <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;The current time is </span><span style="color:#e6db74">$t0</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span> <span style="color:#66d9ef">yield</span> <span style="color:#f92672">()</span>
</code></pre></div><p>En exécutant <code>run(effect1)</code> on obtient:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> run<span style="color:#f92672">(</span>effect1<span style="color:#f92672">)</span>
<span style="color:#a6e22e">The</span> current time is <span style="color:#ae81ff">1569773175010</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>Félicitations! Vous venez d&rsquo;écrire votre première monade <em>IO</em>! Il y
a de nombreux noms scientifiques au <code>sealed trait Effect[A]</code>:
vous pouvez l&rsquo;appeler un <em>effet algébrique</em>, une <em>monade libre</em>, une <em>IO</em>, etc.
Mais au bout du compte, ce n&rsquo;est qu&rsquo;un simple et banal <code>sealed trait</code> pour lequel
nous avons défini quelques <code>final case class</code> et <code>case object</code> afin de
représenter les fonctions dont nous voulions disposer sans fournir
leurs implémentations (<code>CurrentTimeMillis</code>, <code>PrintLn</code>, <code>Mesure</code>,
<code>Pure</code> et <code>FlatMap</code>). Vous pouvez les appeler des <em>méthodes virtuelles</em> si vous voulez.
<strong>Ce qui importe réellement est d&rsquo;avoir isolé la définition de ces fonctions de leurs implémentations.</strong>
Rappelez vous qu&rsquo;un <code>trait</code> est juste une interface après tout.</p>
<h3 id="cas-dutilisation-sassurer-que-les-types-sont-pris-en-charge-par-la-base-de-données">Cas d&rsquo;Utilisation: S&rsquo;assurer que les types sont pris en charge par la Base De Données.</h3>
<p>Les bases de données sont formidables. Nous pouvons y stocker des tables, des documents,
des paires clef/valeur, des graphes, etc.
Mais, pour n&rsquo;importe quelle base de données, il y a malheureusement seulement un nombre limité
de types pris en charge.
Prenez la base de données que vous voulez, je suis sûr de pouvoir trouver des types qu&rsquo;elle
ne prend pas en charge.</p>
<p>Dans cette section, nous allons nous intéresser au cas des structures des données
et du code qui ne marche pas pour tout les types, mais seulement certains! Ce cas d&rsquo;usage
ne se limite pas aux bases de données mais concerne chaque <em>interface de programmation</em> qui ne
supporte qu&rsquo;un nombre limité de types (la vaste majorité des <em>interfaces de programmation</em>).
Comment s&rsquo;assurer du respect de ces contraintes? Comment adapter les techniques que nous aimons
afin qu&rsquo;elles travaillent sous ces contraintes? Voilà ce dont il s&rsquo;agit dans cette section.</p>
<p>Nous considérerons une base de données fictive qui ne prend en charge <strong>que</strong> les types suivants:</p>
<ol>
<li><code>String</code></li>
<li><code>Double</code></li>
<li><code>(A,B)</code> où <code>A</code> et <code>B</code> sont également des types pris en charge par la base de données.</li>
</ol>
<p>Cela signifie que les valeurs stockées dans la base de données (dans des tables, des paires clef/valeur,
etc) <strong>doivent</strong> respecter les règles ci-dessus. Elle peut stocker <code>&quot;Hello World&quot;</code> parce que c&rsquo;est une
<code>String</code>, qui est est un type pris en charge par la base de données en vertu de la règle <em>1</em>.
Pour les mêmes raisons, elle peut stocker <code>5.2</code> parce que c&rsquo;est un <code>Double</code>,
mais elle ne peut <strong>pas</strong> stocker l&rsquo;entier <code>5</code> parce que c&rsquo;est un<code>Int</code>.
Elle peut stocker <code>(&quot;Hello World&quot;, 5.2)</code> grâce à la règle <em>3</em> ainsi que
<code>((&quot;Hello World&quot;, 5.2) , 8.9)</code>, de nouveau grâce à la règle <em>3</em>.</p>
<ul>
<li>
<p><strong>Question 1:</strong> Définissez le type <code>DBType[A]</code> tel que:</p>
<blockquote>
<p>Il existe une valeur de type <code>DBType[A]</code> <strong>si et seulement si</strong> <code>A</code>
est un type pris en charge par la base de données.</p>
</blockquote>
<!-- raw HTML omitted -->
<p>La version simple est:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBString</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBDouble</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">DBPair</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> second<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">)]</span>
</code></pre></div><!-- raw HTML omitted -->
<p>En utilisant toutes les chouettes fonctionnalités syntaxiques de <em>Scala</em>,
la version satisfaisante en production du code ci-dessus est:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">DBType</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBString</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBDouble</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBPair</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> second<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">)]</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> dbString <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBString</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> dbDouble <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBDouble</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> dbPair<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> second<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">)]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBPair</span><span style="color:#f92672">(</span>first<span style="color:#f92672">,</span> second<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
<!-- raw HTML omitted -->
</li>
</ul>
<p>En utilisant <code>DBType</code>, nous pouvons coupler une valeur de type <code>A</code>
avec une valeur de type <code>DBType[A]</code>, fournissant ainsi la preuve que
le type <code>A</code> est pris en charge par la base de données:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> dbType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span>
</code></pre></div><p>Notez que le paramètre <code>dbType</code> n&rsquo;a nullement besoin d&rsquo;être implicite!
Ce qui compte est que pour créer une valeur de type <code>DBValue[A]</code>,
nous devons fournir une valeur de type <code>DBType[A]</code>
ce qui force <code>A</code> à être un type pris en charge par la base de données.</p>
<p>Un <em>foncteur</em> est, de manière informelle et approximative, un constructeur de type<code>F</code>,
comme <code>List</code>, <code>Option</code>, <code>DBValue</code>, etc,
pour lequel il est possible de fournir une instance du trait:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Functor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>où <code>map(fa)(f)</code> applique la fonction <code>f</code> à chaque valeur de type <code>A</code> contenue dans <code>fa</code>. Par exemple:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">OptionFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Functor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    fa <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>f<span style="color:#f92672">(</span>a<span style="color:#f92672">))</span>
      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">None</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">None</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<p><strong>Question 2:</strong> Écrivez une instance de <code>Functor[DBValue]</code>.</p>
<!-- raw HTML omitted -->
<p>C&rsquo;est en fait impossible! Si nous tentions de compiler le code suivant:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBValueFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Functor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">DBValue</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#f92672">(</span>fa<span style="color:#f92672">.</span>value<span style="color:#f92672">))</span>
<span style="color:#f92672">}</span>
</code></pre></div><p><em>Scala</em> râlerait: <code>could not find implicit value for parameter dbType: DBType[B]</code>. En effet, les booléens
ne sont pas un type pris en charge par la base de données:
ils ne sont ni des chaînes de caractères, ni des nombres flottants, ni des paires de types pris en charge.</p>
<p>Supposons que nous puissions définir une instance de <code>Funcor</code> pour <code>DBValue</code>
(c.-à-d. que nous puissions définir une fonction <code>map</code> pour <code>DBValue</code>), alors nous pourrions écrire:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dbValueString  <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span>  <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">)(</span><span style="color:#a6e22e">DBString</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dbValueBoolean <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dbValueString<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dbTypeBoooean  <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span><span style="color:#f92672">]</span>  <span style="color:#66d9ef">=</span> dbValueBoolean<span style="color:#f92672">.</span>dbType
</code></pre></div><p>Nous obtiendrions une valeur (<code>dbTypeBoooean</code>) de type <code>DBType[Boolean]</code>
ce qui signifirait que le type <code>Boolean</code> est pris en charge par la base de données.
Mais il ne l&rsquo;est pas! Hors par définition:</p>
<blockquote>
<p>Il existe une valeur de type <code>DBType[A]</code> <strong>si et seulement si</strong> <code>A</code>
est un type pris en charge par la base de donnée.</p>
</blockquote>
<p>Donc il est impossible d&rsquo;obtenir une valeur de type <code>DBType[Boolean]</code>
et donc il est impossible d&rsquo;écrire une fonction <code>map</code> pout <code>DBValue</code>.
Ainsi il n&rsquo;y a aucun moyen de définir une instance de <code>Functor</code> pour <code>DBValue</code>. CQDF.</p>
<!-- raw HTML omitted -->
</li>
</ul>
<p>Un <em>Foncteur Généralisé</em> est très similaire à un <code>Functor</code> classique, à la différence près
que la fonction <code>map</code> ne doit pas obligatoirement être applicable à n&rsquo;importe quels
types <code>A</code> et <code>B</code> mais peut n&rsquo;être applicable qu&rsquo;à certains types <code>A</code> et <code>B</code> particuliers:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">GenFunctor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">P</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span>,<span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> evA<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">P</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> evB<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">P</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>Par exemple, <code>Set</code> (plus précisément <code>TreeSet</code>) n&rsquo;est pas un foncteur!
En effet il n&rsquo;y a aucun moyen d&rsquo;écrire une fonction <code>map</code> qui fonctionne
pour n&rsquo;importe quel type <code>B</code> (parce qu&rsquo;il est nécessaire d&rsquo;avoir une relation d&rsquo;ordre sur <code>B</code>).
Mais si l&rsquo;on restreint <code>map</code> aux seuls types <code>B</code> disposant d&rsquo;une relation d&rsquo;ordre, alors il devient
possible d&rsquo;écrire:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> scala.collection.immutable._
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">TreeSetFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">GenFunctor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Ordering</span>, <span style="color:#66d9ef">TreeSet</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">TreeSet</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> evA<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Ordering</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> evB<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Ordering</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">TreeSet</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">TreeSet</span><span style="color:#f92672">.</span>empty<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>evB<span style="color:#f92672">)</span> <span style="color:#f92672">++</span> fa<span style="color:#f92672">.</span>toSeq<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>f<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>
<p><strong>Question 3:</strong> Écrivez une instance de <code>GenFunctor[DBType, DBValue]</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBValueGenFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">GenFunctor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">DBType</span>, <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> evA<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> evB<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#f92672">(</span>fa<span style="color:#f92672">.</span>value<span style="color:#f92672">))(</span>evB<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>Ce que nous avons fait ici avec <code>Functor</code> peut être fait avec de nombreuses structures de données et
techniques de programmation. Il est souvent possible de restreindre la plage des types sur lesquels
la structure de donnée ou la classe de types (<em>type class</em>) peut opérer en ajoutant un paramètre
supplémentaire comme <code>ev : DBType[A]</code> aux constructeurs et méthodes.</p>
<h3 id="cas-dutilisation-simplifier-les-implicites">Cas d&rsquo;Utilisation: Simplifier les Implicites</h3>
<p>Ce cas d&rsquo;utilisation est l&rsquo;un des plus intéressants, mais malheureusement, pas l&rsquo;un des plus simples.
Il montre comment il est possible d&rsquo;utiliser les <em>GADTs</em> pour simplifier la création de valeurs implicites.</p>
<p>Des listes de valeurs dont les éléments peuvent être de types différents sont appelées
<em>listes hétérogènes</em>. Elles sont généralement définies en <em>Scala</em> presque comme
les listes classiques:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HNil</span><span style="color:#f92672">()</span> <span style="color:#75715e">// La liste vide
</span><span style="color:#75715e"></span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span>head<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Head</span><span style="color:#f92672">,</span> tail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Tail</span><span style="color:#f92672">)</span> <span style="color:#75715e">// L&#39;operation: `head :: tail`
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">val</span> empty <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HNil</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">HNil</span><span style="color:#f92672">()</span>

<span style="color:#66d9ef">val</span> oneTrueToto <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">HNil</span><span style="color:#f92672">]]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;toto&#34;</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HNil</span><span style="color:#f92672">())))</span>

<span style="color:#66d9ef">val</span> falseTrueFive<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">HNil</span><span style="color:#f92672">]]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HNil</span><span style="color:#f92672">())))</span>
</code></pre></div><p>Comme vous pouvez le voir, il n&rsquo;y a rien de vraiment spécial à propos de ces listes.
Nous voulons définir des relations d&rsquo;ordre sur les listes hétérogènes.
Une relation d&rsquo;ordre est une façon de comparer deux valeurs (<strong>du même type!</strong>):
elles peuvent êtres égales ou l&rsquo;une peut être strictement plus petite que l&rsquo;autre.
Une relation d&rsquo;ordre sur le type <code>A</code> peut se définir en <em>Scala</em> comme une instance
de <code>Order[A]</code> défini comme suit:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// vrai si et seulement si a1 &lt; a2
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> lesserThan<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span>

  <span style="color:#75715e">/* a1 et a2 sont égales si et seulement si
</span><span style="color:#75715e">     aucune d&#39;entre elles n&#39;est strictement plus petite que l&#39;autre
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> areEqual<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a1<span style="color:#f92672">,</span> a2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a2<span style="color:#f92672">,</span> a1<span style="color:#f92672">)</span>

  <span style="color:#75715e">// a1 &gt; a2 si et seulement si a2 &lt; a1
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> greaterThan<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> lesserThan<span style="color:#f92672">(</span>a2<span style="color:#f92672">,</span> a1<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> lesserThanOrEqual<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a2<span style="color:#f92672">,</span> a1<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> greaterThanOrEqual<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a1<span style="color:#f92672">,</span> a2<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Order</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">def</span> make<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>lg_ <span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">A</span><span style="color:#f92672">,</span><span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Boolean</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">def</span> lesserThan<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> lg_<span style="color:#f92672">(</span>a1<span style="color:#f92672">,</span>a2<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> orderInt    <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> orderString <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
</code></pre></div><p>Pour rappel, nous ne comparerons que des listes de <em>même type</em>:</p>
<ul>
<li>Les listes de type <code>HNil</code> seront uniquement comparées à d&rsquo;autres listes de type <code>HNil</code>.</li>
<li>Les listes de type <code>HCons[H,T]</code> seront uniquement comparées à d&rsquo;autres listes de type <code>HCons[H,T]</code>.</li>
</ul>
<p>Comparer des listes de type <code>HNil</code> est trivial parce qu&rsquo;il n&rsquo;y a qu&rsquo;une seule et unique valeur
de type <code>HNil</code> (la liste vide <code>HNil()</code>). Mais il existe de nombreuses façon de comparer des listes
de type <code>HCons[H,T]</code>.
Voici deux relations d&rsquo;ordre possibles (il en existe de nombreuses autres!):</p>
<ul>
<li>
<p>L&rsquo;<em>ordre lexicographique</em> (c.-à-d. l&rsquo;ordre du dictionnaire: de la gauche vers la droite)</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>si et seulement si</strong>
<code>h1 &lt; h2</code> <em>ou</em> (<code>h1 == h2</code> <em>et</em> <code>t1 &lt; t2</code> <em>par l&rsquo;ordre lexicographique</em>).</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Lex</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> lexHNil<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> lexHCons<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      lexTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> lexTail<span style="color:#f92672">.</span>order

      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderHead<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
<li>
<p>L&rsquo;<em>ordre lexicographique inversé</em> qui est la version à l&rsquo;envers de l&rsquo;ordre lexicographique
(c.-à-d. de droite à gauche)</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>si et seulement si</strong>
(<code>t1 &lt; t2</code> <em>par ordre lexicographique inversé</em>) <em>ou</em> (<code>t1 == t2</code> <em>et</em> <code>h1 &lt; h2</code>).</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">RevLex</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> revLexHNil<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> revLexHCons<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      revLexTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> revLexTail<span style="color:#f92672">.</span>order

      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderTail<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div></li>
</ul>
<p>Comme dit plus haut, il est possible de définir davantage de relations d&rsquo;ordre:</p>
<ul>
<li>
<p><strong>Question 1:</strong> L&rsquo;ordre <code>Alternate</code> est défini par:</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>si et seulement si</strong>
<code>h1 &lt; h2</code> <em>ou</em> (<code>h1 == h2</code> <em>et</em> <code>t1 &gt; t2</code> <em>par ordre</em> <code>Alternate</code>).</p>
</blockquote>
<p>En suivant la méthoe employée pour <code>Lex</code> and <code>RevLex</code>,
implémentez l&rsquo;ordre <code>Alternate</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Alternate</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> alternateHNil<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> alternateHCons<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      alternateTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> alternateTail<span style="color:#f92672">.</span>order

      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderHead<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderTail<span style="color:#f92672">.</span>greaterThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>Il existe de nombreuses manières de définir une relation d&rsquo;ordre valide sur les listes hétérogènes!
Créer une classe de type (<em>type class</em>) comme <code>Lex</code>, <code>RevLex</code> et <code>Alternate</code> pour chaque relation
d&rsquo;ordre voulue est fatigant et propice aux erreurs. Nous pouvons faire bien mieux &hellip;
avec un <em>GADT</em> 😉</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">HListOrder</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">HNilOrder</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HConsOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      hlistOrderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span>

  <span style="color:#75715e">// Définitions des Implicites
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> hnilOrder <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">HNilOrder</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> hconsOrder<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      hlistOrderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">HConsOrder</span><span style="color:#f92672">(</span>orderHead<span style="color:#f92672">,</span> hlistOrderTail<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span>
</code></pre></div><p>Il est à noter que la définition de ces implicites est du pur boilerplate. Leur seule
raison d&rsquo;être est de passer leurs arguments au constructeur correspondant
(c.-à-d. <code>final case class</code> ou <code>case object</code>):
<code>hnilOrder</code> à <code>HListOrder</code> (O arguments) et <code>hconsOrder</code> à <code>HConsOrder</code> (2 arguments).</p>
<ul>
<li>
<p><strong>Question 2:</strong> Écrivez une fonction <code>def lex[A](implicit v : HListOrder[A]): Order[A]</code>
qui retourne l&rsquo;ordre lexicographique à partir d&rsquo;une valeur de type <code>HListOrder[A]</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> lex<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> v <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">.</span><span style="color:#a6e22e">HNilOrder</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> hc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder.HConsOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>,<span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> hc<span style="color:#f92672">.</span>orderHead
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> lex<span style="color:#f92672">(</span>hc<span style="color:#f92672">.</span>hlistOrderTail<span style="color:#f92672">)</span>

      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>, <span style="color:#66d9ef">tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderHead<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
<li>
<p><strong>Question 3:</strong> Écrivez une fonction <code>def revLex[A](implicit v : HListOrder[A]): Order[A]</code>
qui retourne l&rsquo;ordre lexicographique inversé à partir d&rsquo;une valeur de type <code>HListOrder[A]</code>.</p>
<!-- raw HTML omitted -->
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> revLex<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> v <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">.</span><span style="color:#a6e22e">HNilOrder</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> hc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder.HConsOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>,<span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> hc<span style="color:#f92672">.</span>orderHead
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> revLex<span style="color:#f92672">(</span>hc<span style="color:#f92672">.</span>hlistOrderTail<span style="color:#f92672">)</span>

      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>, <span style="color:#66d9ef">tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderTail<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span>
</code></pre></div><!-- raw HTML omitted -->
</li>
</ul>
<p>Cette approche a de nombreux avantages. Alors que l&rsquo;approche initiale devait effectuer
une recherche d&rsquo;implicites pour chaque relation d&rsquo;ordre, l&rsquo;approche par <em>GADT</em> n&rsquo;a besoin
de faire cette recherche qu&rsquo;une seule fois!
Sachant que la résolution d&rsquo;implicites est une opération gourmande, la réduire signifie des
temps de compilation plus courts.
Lire le code des fonctions <code>lex</code> et <code>revLex</code> est également plus simple que comprendre
comment la résolution d&rsquo;implicites fonctionne pour les traits <code>Lex</code> et <code>RevLex</code>.
De plus, ce ne sont que des fonctions, vous pouvez y utiliser tout ce que vous pouvez
programmer afin de construire les instances de <code>Order[A]</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Pas si trivial, n&rsquo;est-ce pas? 😉 En fait, une grande part de la complexité
à laquelle vous venez de faire face vient du triste fait que les techniques
de raisonnements sur les types et valeurs ne sont presque jamais enseignées dans
les cours de programmation.
Ce que vous trouvez simple maintenant (API Web, Streaming, Bases De Données, etc)
terrifierait probablement la/le jeune programmeuse·eur que vous étiez à votre
premier &ldquo;Hello World!&rdquo;.
Vous n&rsquo;avez probablement pas appris tout ce que vous savez en programmation en
trois heures, donc n&rsquo;attendez pas des techniques de raisonnement sur des programmes
d&rsquo;êtres magiquement plus simples.</p>
<p>Cet atelier avait pour but de vous inspirer, d&rsquo;ouvrir votre esprit à ce nouvel univers
de possibilités. Si vous trouvez ces cas d&rsquo;utilisation intéressants, alors prenez le temps
de comprendre les techniques.</p>
<p>Amusez vous bien et prenez bien soin de vous ❤️</p>


<footer class="footline">
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://chrilves.github.io/js/clipboard.min.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/perfect-scrollbar.min.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/perfect-scrollbar.jquery.min.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/jquery.sticky.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/featherlight.min.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/highlight.pack.js?1594651652"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://chrilves.github.io/js/modernizr.custom-3.6.0.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/learn.js?1594651652"></script>
    <script src="https://chrilves.github.io/js/hugo-learn.js?1594651652"></script>

    <link href="https://chrilves.github.io/mermaid/mermaid.css?1594651652" rel="stylesheet" />
    <script src="https://chrilves.github.io/mermaid/mermaid.js?1594651652"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
