<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="print">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.147.7">
    <meta name="generator" content="Relearn 7.6.1+4407b4364ab6f7477f7671fbd20c0494bade40ee">
    <meta name="description" content="D√©couvrez les ADT g√©n√©ralis√©s en vous amusant.">
    <meta name="author" content="chrilves">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives">
    <meta name="twitter:description" content="D√©couvrez les ADT g√©n√©ralis√©s en vous amusant.">
    <meta name="twitter:site" content="@chrilves"/>
    <meta property="og:url" content="https://chrilves.github.io/posts/les_gadts_par_l_exemple/index.html">
    <meta property="og:site_name" content="@chrilves&#39; Archives">
    <meta property="og:title" content="Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives">
    <meta property="og:description" content="D√©couvrez les ADT g√©n√©ralis√©s en vous amusant.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Posts">
    <meta property="article:published_time" content="2019-10-27T22:30:00+02:00">
    <meta property="article:modified_time" content="2019-10-27T22:30:00+02:00">
    <meta itemprop="name" content="Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives">
    <meta itemprop="description" content="D√©couvrez les ADT g√©n√©ralis√©s en vous amusant.">
    <meta itemprop="datePublished" content="2019-10-27T22:30:00+02:00">
    <meta itemprop="dateModified" content="2019-10-27T22:30:00+02:00">
    <meta itemprop="wordCount" content="7888">
    <meta itemprop="keywords" content="GADT,GADTs,Generalized Algebraic Data Types,ADT,Algebraic Data Types,Functional Programming,Interface,Free Monad">
    <title>Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives</title>
    <link href="https://chrilves.github.io/posts/les_gadts_par_l_exemple/index.html" rel="canonical" type="text/html" title="Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives">
    <link href="../../posts/les_gadts_par_l_exemple/index.xml" rel="alternate" type="application/rss+xml" title="Les GADTs Par l&#39;Exemple :: @chrilves&#39; Archives">
    <link href="../../fonts/fontawesome/css/fontawesome-all.min.css?1750073986" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../fonts/fontawesome/css/fontawesome-all.min.css?1750073986" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar/perfect-scrollbar.min.css?1750073986" rel="stylesheet">
    <link href="../../css/theme.min.css?1750073986" rel="stylesheet">
    <link href="../../css/format-print.min.css?1750073986" rel="stylesheet" id="R-format-style">
    <link href="../../css/auto-complete/auto-complete.min.css?1750073986" rel="stylesheet">
    <script src="../../js/auto-complete/auto-complete.min.js?1750073986" defer></script>
    <script src="../../js/lunr/lunr.min.js?1750073986" defer></script>
    <script src="../../js/lunr/lunr.stemmer.support.min.js?1750073986" defer></script>
    <script src="../../js/lunr/lunr.multi.min.js?1750073986" defer></script>
    <script src="../../js/lunr/lunr.en.min.js?1750073986" defer></script>
    <script src="../../js/search.min.js?1750073986" defer></script>
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = `.min`;
      window.relearn.path='\/posts\/les_gadts_par_l_exemple\/index.html';
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/chrilves.github.io';
      window.relearn.contentLangs=['en'];
      window.relearn.index_js_url="../../searchindex.en.js?1750073986";
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=true;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // variant stuff
      window.relearn.themevariants = [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support print" data-url="../../posts/les_gadts_par_l_exemple/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#remerciements">Remerciements</a></li>
    <li><a href="#lisez-moi">LISEZ-MOI</a></li>
    <li><a href="#√©chauffements">√âchauffements</a>
      <ul>
        <li><a href="#valeurs-et-types"><em>Valeurs</em> et <em>Types</em>?</a></li>
        <li><a href="#combien-de-types">Combien de types?</a></li>
        <li><a href="#combien-de-valeurs">Combien de valeurs?</a></li>
      </ul>
    </li>
    <li><a href="#premier-contact">Premier Contact</a>
      <ul>
        <li><a href="#cas-dutilisation-preuve-dune-propri√©t√©">Cas d&rsquo;Utilisation: Preuve d&rsquo;une propri√©t√©</a></li>
        <li><a href="#cas-dutilisation-la-seule-chose-que-je-sais-est-quil-existe">Cas d&rsquo;Utilisation: La seule chose que je sais, est qu&rsquo;il existe</a></li>
        <li><a href="#conclusion-interm√©diaire">Conclusion Interm√©diaire</a></li>
      </ul>
    </li>
    <li><a href="#cas-dutilisation-simples-et-utiles-relations-sur-les-types">Cas d&rsquo;utilisation simples et utiles: relations sur les types</a>
      <ul>
        <li><a href="#cas-dutilisation-t√©moin-d√©galit√©-entre-types">Cas d&rsquo;Utilisation: T√©moin d&rsquo;√âgalit√© entre Types</a></li>
        <li><a href="#cas-dutilisation-t√©moin-de-sous-typage">Cas d&rsquo;Utilisation: T√©moin de Sous-Typage</a></li>
        <li><a href="#cas-dutilisation-√©viter-les-messages-derreur-de-scalac-√†-propos-des-bornes-non-respect√©es">Cas d&rsquo;Utilisation: √âviter les messages d&rsquo;erreur de <em>scalac</em> √† propos des bornes non respect√©es</a></li>
        <li><a href="#cas-dutilisation-fournir-les-bonnes-donn√©es-au-bon-diagramme">Cas d&rsquo;Utilisation: Fournir les bonnes donn√©es au bon diagramme</a></li>
      </ul>
    </li>
    <li><a href="#cas-dutilisation-plus-avanc√©s">Cas d&rsquo;Utilisation Plus Avanc√©s</a>
      <ul>
        <li><a href="#cas-dutilisation-les-effets">Cas d&rsquo;Utilisation: Les Effets!</a></li>
        <li><a href="#cas-dutilisation-sassurer-que-les-types-sont-pris-en-charge-par-la-base-de-donn√©es">Cas d&rsquo;Utilisation: S&rsquo;assurer que les types sont pris en charge par la Base De Donn√©es.</a></li>
        <li><a href="#cas-dutilisation-simplifier-les-implicites">Cas d&rsquo;Utilisation: Simplifier les Implicites</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList">
            <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class="a11y-only"><a itemprop="item" href="../../index.html"><span itemprop="name">@chrilves&#39; Archives</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li>
            <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="../../posts/index.html"><span itemprop="name">Posts</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li>
            <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">Les GADTs Par l&#39;Exemple</span><meta itemprop="position" content="3"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/chrilves/chrilves.github.io/edit/master/hugo/content/posts/les_gadts_par_l_exemple.md" rel="external" target="_self" title="Edit (CTRL+ALT+w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/les_gadts_par_l_exemple/index.print.html" title="Print whole chapter (CTRL+ALT+p)"><i class="fa-fw fas fa-print"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/probability_in_scala_3_all_sides/index.html" title="Playing with Probability in Scala 3 (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/gadts_by_use_cases/index.html" title="GADTs By Use Cases (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable posts" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="les-gadts-par-lexemple">Les GADTs Par l&#39;Exemple</h1>
    <p class="article-meta default"><i class='fa-fw fas fa-calendar'></i><em>27 Oct 2019 - 7900 Words</em></p>

<p>Soyez les bienvenu¬∑e¬∑s! Cette session a le dessein de vous pr√©senter
un outil de programmation tr√®s puissant. Alors que la plupart des
introductions sur le sujet commencent par une pr√©sentation de ses
fondements th√©oriques d&rsquo;une mani√®re tr√®s formelle, nous avons choisi
de vous le pr√©senter √† travers de courts exemples et des cas
d&rsquo;utilisation concrets.</p>
<p>Cet atelier est compos√© de trois parties. La derni√®re pr√©sente trois
des cas d&rsquo;utilisation des plus utiles. Ils forment les usages majeurs
en pratique. Mais ne vous y aventurez pas sans pr√©paration! Cette partie
est la derni√®re pour une bonne raison: elle s&rsquo;appuie massivement sur
les le√ßons des parties pr√©c√©dentes.
Commencez par <a href="../../posts/les_gadts_par_l_exemple/index.html#premier-contact">Premier Contact</a>, elle vous exposera,
via les plus simples exemples, les id√©es clefs. Son but est
d&rsquo;ouvrir votre esprit √† des mani√®res d&rsquo;utiliser les types et donn√©es
que vous n&rsquo;avez vraisemblablement jamais soup√ßonn√©es.
Arpentez ensuite
<a href="../../posts/les_gadts_par_l_exemple/index.html#cas-d-utilisation-simples-et-utiles-relations-sur-les-types">Cas d‚Äôutilisation simples et utiles: relations sur les types</a>,
pour un premier d√©fi devant un usage pratique.
Apr√®s cela seulement vous serez pr√™t¬∑e pour
<a href="../../posts/les_gadts_par_l_exemple/index.html#cas-d-utilisation-plus-avanc√©s">Cas d‚ÄôUtilisation Plus Avanc√©s</a>.</p>
<p>Assurez vous de <strong>lire <a href="../../posts/les_gadts_par_l_exemple/index.html#lisez-moi">LISEZ-MOI</a></strong>, cette section contient de pr√©cieuses
astuces pour faciliter votre parcours.</p>
<h2 id="remerciements">Remerciements</h2>
<p>Nous tenons √† remercier <a href="http://www.laure-juglaret.fr/" rel="external" target="_self">Laure Juglaret</a> pour
ses nombreuses relectures, ses pr√©cieuses remarques et corrections.</p>
<h2 id="lisez-moi">LISEZ-MOI</h2>
<p>Durant toute cette pr√©sentation, nous consid√©rerons que:</p>
<ul>
<li><code>null</code> <strong>n&rsquo;existe pas!</strong></li>
<li><strong>La r√©flexion au runtime n&rsquo;existe pas!</strong> (c.-√†-d. <code>isInstanceOf</code>, <code>getClass</code>, etc)</li>
</ul>
<p>Cette pr√©sentation consid√®re que <em>ces fonctionnalit√©s n&rsquo;existent pas du tout!</em>.</p>
<p><strong>Leur utilisation n&rsquo;am√®nera jamais √† une r√©ponse correcte aux questions.</strong>.</p>
<p>Pour faire cet atelier vous devez disposez du n√©cessaire pour √©crire, compiler et
ex√©cuter rapidement du code <em>Scala</em>. Le meilleur moyen est d&rsquo;ouvrir une session
interactive (<em>R.E.P.L.</em>). Si vous avez <em>Scala</em> d&rsquo;install√© sur votre syst√®me, vous
pouvez facilement en d√©marrer une via la ligne de commande en ex√©cutant le programme
<code>scala</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">system</span><span class="o">-</span><span class="n">command</span><span class="o">-</span><span class="n">line</span><span class="k">#</span> <span class="n">scala</span>
</span></span><span class="line"><span class="cl"><span class="nc">Welcome</span> <span class="n">to</span> <span class="nc">Scala</span> <span class="mf">2.13</span><span class="o">.</span><span class="mi">1</span> <span class="o">(</span><span class="nc">OpenJDK</span> <span class="mi">64</span><span class="o">-</span><span class="nc">Bit</span> <span class="nc">Server</span> <span class="nc">VM</span><span class="o">,</span> <span class="nc">Java</span> <span class="mf">1.8</span><span class="o">.</span><span class="mi">0</span><span class="n">_222</span><span class="o">).</span>
</span></span><span class="line"><span class="cl"><span class="nc">Type</span> <span class="n">in</span> <span class="n">expressions</span> <span class="k">for</span> <span class="n">evaluation</span><span class="o">.</span> <span class="nc">Or</span> <span class="k">try</span> <span class="k">:</span><span class="kt">help.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">scala&gt;</span></span></span></code></pre></div>
<p>Pour rappel, dans une session interactive (<em>R.E.P.L.</em>),
la commande <code>:paste</code> permet de copier du code dans la session
et la commande <code>:reset</code> de repartir d&rsquo;un environnement vierge.</p>
<p>Si vous n&rsquo;avez pas <em>Scala</em> d&rsquo;install√©, <strong>vous pouvez utiliser</strong> le
site <a href="https://scastie.scala-lang.org/" rel="external" target="_self">https://scastie.scala-lang.org/</a> .</p>
<h2 id="√©chauffements">√âchauffements</h2>
<p>Cette section est un bref rappel de quelques d√©finitions et propri√©t√©s sur
les types et les valeurs.</p>
<h3 id="valeurs-et-types"><em>Valeurs</em> et <em>Types</em>?</h3>
<p>Les <strong>valeurs</strong> sont les <em>donn√©es concr√®tes que vos programmes manipulent</em>
comme l&rsquo;entier <code>5</code>, le bool√©en <code>true</code>, la cha√Æne <code>&quot;Hello World!&quot;</code>,
la fonction <code>(x: Double) =&gt; x / 7.5</code>, la liste <code>List(1,2,3)</code>, etc.
Il est souvent pratique de classer les valeurs en groupes. Ces groupes sont appel√©s
des <strong>types</strong>. Par exemple:</p>
<ul>
<li><code>Int</code> est le groupe des valeurs enti√®res, c.-√†-d. les valeurs telles que <code>1</code>, <code>-7</code>, <code>19</code>, etc.</li>
<li><code>Boolean</code> est le groupe contenant exactement les valeurs
<code>true</code> et <code>false</code> (ni plus, ni moins!).</li>
<li><code>String</code> est le groupe dont les valeurs sont <code>&quot;Hello World!&quot;</code>, <code>&quot;&quot;</code>, <code>&quot;J' ‚ù§Ô∏è les GADTs&quot;</code>, etc.</li>
<li><code>Double =&gt; Double</code> est le groupe dont les valeurs sont les fonctions prenant en argument
n&rsquo;importe quel <code>Double</code> et renvoyant √©galement un double <code>Double</code>.</li>
</ul>
<p>Pour indiquer que la valeur <code>v</code> appartient au type (c.-√†-d. groupe de valeurs) <code>T</code>,
la notation est <code>v : T</code>. En <em>Scala</em>, tester si une valeur <code>v</code> appartient au type <code>T</code>
est tr√®s simple: il suffit de taper <code>v : T</code> dans la session interactive (<em>REPL</em>):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="mi">5</span> <span class="k">:</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="n">res7</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">5</span></span></span></code></pre></div>
<p>Si <em>Scala</em> l&rsquo;accepte, alors <code>v</code> appartient bien au type <code>T</code>. Si <em>Scala</em> r√¢le,
ce n&rsquo;est probablement pas le cas:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="mi">5</span> <span class="k">:</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">       <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">found</span>   <span class="k">:</span> <span class="kt">Int</span><span class="o">(</span><span class="err">5</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kt">required:</span> <span class="kt">String</span></span></span></code></pre></div>
<h3 id="combien-de-types">Combien de types?</h3>
<p>Cr√©ons maintenant quelques types et quelques unes de leurs valeurs (quand cela est possible!).</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UnType</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Combien de types la ligne <code>class UnType</code> d√©finit-elle?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Comme son nom le sugg√®re, la ligne <code>class UnType</code> d√©finit seulement un type, nomm√© <code>UnType</code>.</p>
  </details>
</li>
</ul>
<p>Passons maintenant √†:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">UnTypePourChaque</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 2:</strong> Combien de types la ligne <code>class UnTypePourChaque[A]</code> d√©finit-elle?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Comme son nom le sugg√®re, chaque type concret <code>A</code> donne lieu √†
un type distinct <code>UnTypePourChaque[A]</code>.</p>
<p>Par exemple, une liste d&rsquo;entiers n&rsquo;est ni une liste de bool√©ens,
ni une liste de cha√Æne de caract√®res, ni une liste de fonctions, ni &hellip;
En effet les types <code>List[Int]</code>, <code>List[Boolean]</code>,
<code>List[Int =&gt; Int]</code>, etc sont tous des types distincts.</p>
<p>la ligne <code>class UnTypePourChaque[A]</code> d√©finit
<strong>un type distinct pour chaque type concret</strong> <code>A</code>.
Il y a une infinit√© de types concrets <code>A</code>,
donc une infinit√© de de types distincts <code>UnTypePourChaque[A]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Donnez une valeur qui appartient √† la fois aux types
<code>UnTypePourChaque[Int]</code> et <code>UnTypePourChaque[Boolean]</code>.</p>
<p><strong>Pour rappel, <code>null</code> n&rsquo;existe pas!</strong></p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>C&rsquo;est en fait impossible. Chaque type concret <code>A</code> donne lieu
√† un type distinct <code>UnTypePourChaque[A]</code> qui n&rsquo;a aucune valeur en commun
avec les autres types de la forme <code>UnTypePourChaque[B]</code> avec <code>B ‚â† A</code>.</p>
  </details>
</li>
</ul>
<h3 id="combien-de-valeurs">Combien de valeurs?</h3>
<p>En consid√©rant le type suivant:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">PasDeValeurPourCeType</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Donnez une valeur appartenant au type <code>PasDeValeurPourCeType</code>?
Combien de valeurs appartiennent au type <code>PasDeValeurPourCeType</code>?</p>
  <details>
    <summary><em>Astuce (cliquer pour d√©voiler)</em></summary>
<ul>
<li>Qu&rsquo;est ce qu&rsquo;une classe <code>final</code>? En quoi est-ce qu&rsquo;elle diff√®re d&rsquo;une classe normale (non finale)?</li>
<li>Qu&rsquo;est ce qu&rsquo;une classe <code>abstract</code>? En quoi est-ce qu&rsquo;elle diff√®re d&rsquo;une classe concr√®te?</li>
</ul>
  </details>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>La classe <code>PasDeValeurPourCeType</code> est d√©clar√©e comme <code>abstract</code>.
Cela signifie qu&rsquo;il est interdit de cr√©er des instances directes de cette classe:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nc">PasDeValeurPourCeType</span>
</span></span><span class="line"><span class="cl">       <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="kt">class</span> <span class="kt">PasDeValeurPourCeType</span> <span class="kt">is</span> <span class="kt">abstract</span><span class="o">;</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">instantiated</span></span></span></code></pre></div>
<p>La seule mani√®re de cr√©er une instance d&rsquo;une classe abstraite est de cr√©er une
une sous-classe concr√®te. Mais le mot clef <code>final</code> interdit la cr√©ation de
telles sous-classes:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">SousClasseConcrete</span> <span class="k">extends</span> <span class="nc">PasDeValeurPourCeType</span>
</span></span><span class="line"><span class="cl">                                        <span class="o">^</span>
</span></span><span class="line"><span class="cl">        <span class="n">error</span><span class="k">:</span> <span class="kt">illegal</span> <span class="kt">inheritance</span> <span class="kt">from</span> <span class="kt">final</span> <span class="kt">class</span> <span class="kt">PasDeValeurPourCeType</span></span></span></code></pre></div>
<p>Il n&rsquo;existe aucun moyen de cr√©er une instance pour <code>PasDeValeurPourCeType</code>.</p>
  </details>
</li>
</ul>
<p>Prenons un autre exemple:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ExactementUneValeur</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">LaSeuleValeur</span> <span class="k">extends</span> <span class="nc">ExactementUneValeur</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 2:</strong> Donnez une valeur appartenant au type <code>ExactementUneValeur</code>?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Par d√©finition, <code>LaSeuleValeur</code> est une valeur du type <code>ExactementUneValeur</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Combien de valeurs appartiennent √† <code>ExactementUneValeur</code>?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Comme ci-dessus, <code>ExactementUneValeur</code>, √©tant un <code>trait</code>, est <em>abstrait</em>. √âtant <code>sealed</code>,
l&rsquo;√©tendre en dehors de son fichier source est interdit.
Donc <code>LaSeuleValeur</code> est la seule valeur du type <code>ExactementUneValeur</code>.</p>
  </details>
</li>
</ul>
<h2 id="premier-contact">Premier Contact</h2>
<p>Cette partie pr√©sente les id√©es clefs. Il y a en fait seulement
deux id√©es! Vous trouverez ici des exemples √©pur√©s illustrant chacune
de ces deux id√©es.</p>
<h3 id="cas-dutilisation-preuve-dune-propri√©t√©">Cas d&rsquo;Utilisation: Preuve d&rsquo;une propri√©t√©</h3>
<p>D√©finissons un simple <em>sealed trait</em>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ATrait</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">case</span> <span class="k">object</span> <span class="nc">AValue</span> <span class="k">extends</span> <span class="nc">ATrait</span><span class="o">[</span><span class="kt">Char</span><span class="o">]</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Donnez une valeur du type <code>ATrait[Char]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Par d√©finition, <code>AValue</code> est une valeur du type <code>ATrait[Char]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> Donnez une valeur du type <code>ATrait[Double]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Il n&rsquo;existe aucun moyen d&rsquo;obtenir une instance du type <code>ATrait[Double]</code>.
Il n&rsquo;existe en fait aucun moyen d&rsquo;obtenir une instance de <code>ATrait[B]</code> pour <code>B ‚â† Char</code>
parce que la seule valeur possible est <code>AValue</code> qui est de type <code>ATrait[Char]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Que pouvez vous conclure sur le type <code>A</code> si vous avez une valeur
<code>ev</code> de type <code>ATrait[A]</code> (c.-√†-d. <code>ev: ATrait[A]</code>)?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>La seule valeur possible est <code>AValue</code>, donc <code>ev == AValue</code>.
De plus <code>AValue</code> est de type <code>ATrait[Char]</code> donc <code>A = Char</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 4:</strong> Dans la session interactive (<em>REPL</em>), entrez le code suivant:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">ATrait</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span></span></span></code></pre></div>
</li>
<li>
<p><strong>Question 5:</strong> Essayez maintenant en utilisant un filtrage par motif
(pattern matching) sur <code>ev: ATrait[A]</code></p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">ATrait</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">ev</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">AValue</span> <span class="k">=&gt;</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Le filtrage par motif (pattern-matching) est il exhaustif?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Le filtrage par motif est exhaustif parce la seule et unique valeur possible
pour <code>ev</code> est en fait <code>AValue</code>. De plus <code>AValue</code> est de type <code>ATrait[Char]</code> ce qui signifie
que <code>ev : ATrait[Char]</code> parce que <code>ev == AValue</code>. Donc <code>A = Char</code> et <code>x : Char</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 6:</strong> Appelez <code>f</code> avec <code>x = 'w' : Char</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">[</span><span class="kt">Char</span><span class="o">](</span><span class="sc">&#39;w&#39;</span><span class="o">,</span> <span class="nc">AValue</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span> <span class="n">w</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 7:</strong> Appelez <code>f</code> avec <code>x =  5.2 : Double</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>C&rsquo;est impossible parce que cela demenderait de fournir une valeur
<code>ev : ATrait[Double]</code>, ce qui n&rsquo;existe pas!</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">[</span><span class="kt">Double</span><span class="o">](</span><span class="mi">5</span><span class="o">,</span> <span class="nc">AValue</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">^</span>
</span></span><span class="line"><span class="cl">          <span class="n">error</span><span class="k">:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">found</span>   <span class="k">:</span> <span class="kt">AValue.type</span>
</span></span><span class="line"><span class="cl">            <span class="n">required</span><span class="k">:</span> <span class="kt">ATrait</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<details>
  <summary><strong>Remarque pour les personnes √† l'aise en <em>Scala</em></strong> <em>(cliquer pour d√©voiler)</em></summary>
<p>En utilisant toutes les chouettes fonctionnalit√©s syntaxiques de <em>Scala</em>,
la version satisfaisante en production du code ci-dessus est:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">IsChar</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">Evidence</span> <span class="k">extends</span> <span class="nc">IsChar</span><span class="o">[</span><span class="kt">Char</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">evidence</span><span class="k">:</span> <span class="kt">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">evidence</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A:</span> <span class="kt">IsChar</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">IsChar</span><span class="o">.</span><span class="nc">Evidence</span> <span class="k">=&gt;</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
</details>
<h3 id="cas-dutilisation-la-seule-chose-que-je-sais-est-quil-existe">Cas d&rsquo;Utilisation: La seule chose que je sais, est qu&rsquo;il existe</h3>
<p>Que feriez vous si vous vouliez que votre application tienne un journal d‚Äô√©v√®nements (c.-√†-d. un <em>log</em>),
mais que vous vouliez √™tre sur qu&rsquo;elle ne d√©pende d&rsquo;aucun d√©tail d&rsquo;impl√©mentation de la m√©thode
de journalisation (c.-√†-d. du <em>logger</em>), de telle mani√®re que vous puissiez changer son impl√©mentation
sans risquer de casser votre application?</p>
<p>En consid√©rant le type suivant, <code>UnknownLogger</code>, des m√©thodes de journalisation:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">UnknownLogger</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">LogWith</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span> <span class="k">:</span> <span class="kt">X</span><span class="o">,</span> <span class="n">appendMessage</span><span class="k">:</span> <span class="o">(</span><span class="kt">X</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UnknownLogger</span></span></span></code></pre></div>
<p>La premi√®re m√©thode (c.-√†-d. *<em>logger</em>) que nous cr√©ons stocke les messages dans une <code>String</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">loggerStr</span> <span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">LogWith</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&#34;&#34;</span><span class="o">,</span> <span class="o">(</span><span class="n">logs</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">logs</span> <span class="o">++</span> <span class="n">message</span><span class="o">)</span></span></span></code></pre></div>
<p>La seconde m√©thode les stocke dans une <code>List[String]</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">loggerList</span> <span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">LogWith</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]](</span><span class="nc">Nil</span><span class="o">,</span> <span class="o">(</span><span class="n">logs</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">message</span> <span class="k">:</span><span class="kt">:</span> <span class="kt">logs</span><span class="o">)</span></span></span></code></pre></div>
<p>La troisi√®me m√©thode de journalisation imprime directement les messages sur la sortie standard:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">loggerStdout</span> <span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">LogWith</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]((),</span> <span class="o">(</span><span class="n">logs</span><span class="k">:</span> <span class="kt">Unit</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">message</span><span class="o">))</span></span></span></code></pre></div>
<p>Notez que ces trois m√©thodes de journalisation ont toutes le m√™me type
(c.-√†-d. <code>UnknownLogger</code>) mais qu&rsquo;elles stockent les messages en utilisant
diff√©rents types <code>X</code> (<code>String</code>, <code>List[String]</code> et <code>Unit</code>).</p>
<ul>
<li>
<p><strong>Question 1:</strong> Soit <code>v</code> une valeur de type <code>UnknownLogger</code>.
Clairement <code>v</code> doit √™tre une instance de la classe <code>LogWith[X]</code> pour un certain <code>X</code>.
Que pouvez vous dire sur le type <code>X</code>? Pouvez-vous deviner quel type concret est <code>X</code>?</p>
<p><strong>Pour rappel, il est interdit d&rsquo;utiliser la r√©flexion au runtime!</strong> (c.-√†-d. <code>isInstanceOf</code>, <code>getClass</code>, etc)</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Nous ne savons presque rien sur <code>X</code>. La seule chose que nous avons est qu&rsquo;il existe au
moins une valeur (<code>v.logs</code>) de type <code>X</code>. √Ä part cela, <code>X</code> peut √™tre n&rsquo;importe quel type.</p>
<p>Ne pas savoir quel type concret est <code>X</code> est tr√®s utile pour garantir que le code qui utilisera
<code>v : UnknownLogger</code> ne d√©pendra pas de la nature de <code>X</code>. Si ce code savait que <code>X</code> √©tait
<code>String</code> par exemple, il pourrait ex√©cuter des op√©rations que nous voulons interdir comme inverser
la liste, ne retenir que les <em>n</em> premiers caract√®res, etc. En cachant la nature de<code>X</code>, nous for√ßons
notre application √† ne pas d√©pendre du type concret derri√®re<code>X</code> mais de n&rsquo;utiliser que la
fonnction fournie <code>v.appendMessage</code>.
Ainsi changer l&rsquo;impl√©mentation r√©elle de la m√©thode de journalisation ne cassera aucun code.</p>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> √âcrivez la fonction <code>def log(message: String, v: UnknownLogger): UnknownLogger</code>
qui utilise <code>v.appendMessage</code> pour ajouter le <code>message</code> au journal <code>v.logs</code>
et retourne un nouvel <code>UnknownLogger</code> contenant le nouveau journal (c.-√†-d. le nouveau <code>log</code>).</p>
<p>Pour rappel, en <em>Scala</em>, le motif (c.-√†-d. pattern) <code>case ac : AClass[t] =&gt;</code>
est possible dans les expressions de type <code>match/case</code> comme alternative au motif
<code>case AClass(v) =&gt; </code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">AClass</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span> <span class="k">:</span> <span class="kt">A</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">v</span><span class="k">:</span> <span class="kt">AClass</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">ac</span> <span class="k">:</span> <span class="kt">AClass</span><span class="o">[</span><span class="kt">t</span><span class="o">]</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// La variable `t` is une variable de type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// Le type `t` est `A`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">val</span> <span class="n">r</span> <span class="k">:</span> <span class="kt">t</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Son principal avantage est d&rsquo;introduire la variable de type <code>t</code>.
Les variables de type se comportent comme des variables de motif classiques
(c.-√†-d. pattern variables) √† l&rsquo;exception pr√©s qu&rsquo;elles repr√©sentent des
types et non des valeurs.
Avoir <code>t</code> sous la main nous permet d&rsquo;aider le compilateur en donnant
explicitement certains types (comme ci-dessus, expliciter que <code>r</code> est de type <code>t</code>).</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">v</span><span class="k">:</span> <span class="kt">UnknownLogger</span><span class="o">)</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">vx</span> <span class="k">:</span> <span class="kt">LogWith</span><span class="o">[</span><span class="kt">x</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">LogWith</span><span class="o">[</span><span class="kt">x</span><span class="o">](</span><span class="n">vx</span><span class="o">.</span><span class="n">appendMessage</span><span class="o">(</span><span class="n">vx</span><span class="o">.</span><span class="n">logs</span><span class="o">,</span> <span class="n">message</span><span class="o">),</span> <span class="n">vx</span><span class="o">.</span><span class="n">appendMessage</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Ex√©cutez <code>log(&quot;Hello World&quot;, loggerStr)</code> et <code>log(&quot;Hello World&quot;, loggerList)</code>
et <code>log(&quot;Hello World&quot;, loggerStdout)</code></p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">,</span> <span class="n">loggerStr</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span> <span class="nc">LogWith</span><span class="o">(</span><span class="nc">Hello</span> <span class="nc">World</span><span class="o">,</span><span class="nc">$$Lambda$988</span><span class="o">/</span><span class="mi">1455466014</span><span class="k">@</span><span class="mi">421</span><span class="n">ead7e</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">,</span> <span class="n">loggerList</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res1</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span> <span class="nc">LogWith</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">Hello</span> <span class="nc">World</span><span class="o">),</span><span class="nc">$$Lambda$989</span><span class="o">/</span><span class="mi">1705282731</span><span class="k">@</span><span class="mi">655621</span><span class="n">fd</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">,</span> <span class="n">loggerStdout</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nc">Hello</span> <span class="nc">World</span>
</span></span><span class="line"><span class="cl"><span class="n">res2</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span> <span class="nc">LogWith</span><span class="o">((),</span><span class="nc">$$Lambda$990</span><span class="o">/</span><span class="mi">1835105031</span><span class="k">@</span><span class="mi">340</span><span class="n">c57e0</span><span class="o">)</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<details>
  <summary><strong>Remarque pour les personnes √† l'aise en <em>Scala</em></strong> <em>(cliquer pour d√©voiler)</em></summary>
<p>Une fois encore, en utilisant toutes les chouettes fonctionnalit√©s syntaxiques de <em>Scala</em>,
la version satisfaisante en production du code ci-dessus est:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">UnknownLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">LogsType</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">logs</span> <span class="k">:</span> <span class="kt">LogsType</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">appendMessage</span><span class="o">(</span><span class="n">presentLogs</span><span class="k">:</span> <span class="kt">LogsType</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">LogsType</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">UnknownLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">LogWith</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span> <span class="k">:</span> <span class="kt">X</span><span class="o">,</span> <span class="n">appendMessage_</span> <span class="k">:</span> <span class="o">(</span><span class="kt">X</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UnknownLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">type</span> <span class="kt">LogsType</span> <span class="o">=</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="n">appendMessage</span><span class="o">(</span><span class="n">presentLogs</span><span class="k">:</span> <span class="kt">LogsType</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">LogsType</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="n">appendMessage_</span><span class="o">(</span><span class="n">presentLogs</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span><span class="k">:</span> <span class="kt">X</span><span class="o">,</span> <span class="n">appendMessage</span><span class="k">:</span> <span class="o">(</span><span class="kt">X</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">LogWith</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span><span class="o">,</span> <span class="n">appendMessage</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</details>
<h3 id="conclusion-interm√©diaire">Conclusion Interm√©diaire</h3>
<p>Les <em>GADTs</em> ne sont en fait que ceci: de simples <em>sealed trait</em> avec quelques
<em>case object</em> (possiblement aucun) et quelques <em>final case class</em> (√©galement possiblement aucune!).
Dans les parties suivantes, nous explorerons quelques un des cas d&rsquo;utilisation
majeurs des <em>GADTs</em>.</p>
<h2 id="cas-dutilisation-simples-et-utiles-relations-sur-les-types">Cas d&rsquo;utilisation simples et utiles: relations sur les types</h2>
<p>Une facult√© simple mais tr√®s utile des <em>GADTs</em> est l&rsquo;expression de relations sur les types telles que:</p>
<ul>
<li>Le type <code>A</code> est-il √©gal au type <code>B</code>?</li>
<li>Le type <code>A</code> est-il un sous-type de <code>B</code>?</li>
</ul>
<p>Notez bien que, par d√©finition, tout type <code>A</code> est sous-type de lui-m√™me (c.-√†-d. <code>A &lt;: A</code>),
tout comme tout entier <code>x</code> est √©galement inf√©rieur ou √©gal √† lui-m√™me <code>x ‚â§ x</code>.</p>
<h3 id="cas-dutilisation-t√©moin-d√©galit√©-entre-types">Cas d&rsquo;Utilisation: T√©moin d&rsquo;√âgalit√© entre Types</h3>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">X</span><span class="o">]</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Donnez une valeur de type <code>EqT[Int, Int]</code></p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">Int</span><span class="o">]()</span> <span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">()</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> Donnez une valeur de type <code>EqT[String, Int]</code></p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>La classe <code>Evidence</code> est l&rsquo;unique sous-classe conctr√®te du trait <code>EqT</code> et il est
impossible d&rsquo;en cr√©er une autre parce que <code>EqT</code> est <code>sealed</code>. Donc une valeur <code>v : EqT[A,B]</code>
ne peut √™tre qu&rsquo;une instance de <code>Evidence[X]</code> pour un certain type <code>X</code>, qui elle-m√™me est
de type <code>EqT[X,X]</code>.
Ainsi il n&rsquo;y a aucun moyen d&rsquo;obtenir une valeur de type <code>EqT[String, Int]</code></p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Soient <code>A</code> et <code>B</code> deux types (inconnus).
Si je vous donne une valeur de type <code>EqT[A,B]</code>, que pouvez-vous en d√©duire sur <code>A</code> et <code>B</code>?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Si je vous donne une valeur <code>v : EqT[A,B]</code>, alors vous savez que <code>v</code> est une instance
de <code>Evidence[X]</code> pour un certain type <code>X</code> (inconnu). En effet la classe <code>Evidence</code>  est la seule
et unique sous-classe concr√®te du <code>sealed trait</code> <code>EqT</code>. En fait, <code>Evidence[X]</code> est un sous-type de
<code>EqT[X,X]</code>. Donc <code>v : EqT[X,X]</code>. Les types <code>EqT[A,B]</code> et <code>EqT[X,X]</code> n&rsquo;ont aucune valeur en commun
si <code>A ‚â† X</code> ou <code>B ‚â† X</code>, donc <code>A = X</code> et <code>B = X</code>. Et donc <code>A = B</code>. CQFD.</p>
  </details>
</li>
</ul>
<details>
  <summary><strong>Remarque pour les personnes √† l'aise en <em>Scala</em></strong> <em>(cliquer pour d√©voiler)</em></summary>
<p>En production, il est pratique de d√©finir <code>EqT</code> de la mani√®re suivante, qui est bien entendu √©quivalente:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">EqT</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">X</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</details>
<h4 id="passer-dun-type-√©gal-√†-lautre">Passer d&rsquo;un type √©gal √† l&rsquo;autre</h4>
<p>Si <code>A</code> et <code>B</code> sont en fait le m√™me type, alors <code>List[A]</code> est √©galement le m√™me
type que <code>List[B]</code>, <code>Option[A]</code> est √©galement le m√™me type que <code>Option[B]</code>,
etc. De mani√®re g√©n√©rale, pour n&rsquo;importe quel <code>F[_]</code>, <code>F[A]</code> est √©galement le m√™me type
que <code>F[B]</code>.</p>
<ul>
<li>
<p><strong>Question 4:</strong> √âcrivez la fonction <code>def coerce[F[_],A,B](eqT: EqT[A,B])(fa: F[A]): F[B]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">coerce</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])(</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">eqT</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="k">_</span> <span class="k">:</span> <span class="kt">Evidence</span><span class="o">[</span><span class="kt">x</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">fa</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>La biblioth√®que standard de <em>Scala</em> d√©finit d√©j√† une classe, nomm√©e <code>=:=[A,B]</code>
(son nom est bel et bien <code>=:=</code>), repr√©sentant l&rsquo;√©galit√© entre types.
Je vous recommande vivement de jeter un ≈ìil
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html" rel="external" target="_self">√† sa documentation (cliquez ici)</a>.
Fort heureusement, pour plus de lisibilit√©, <em>Scala</em> nous permet d&rsquo;√©crire <code>A =:= B</code> le type <code>=:=[A,B]</code>.</p>
<p>√âtant donn√© deux types <code>A</code> et <code>B</code>, avoir une instance (c.-√†-d. objet)
de <code>A =:= B</code> prouve que <code>A</code> et <code>B</code> sont en r√©alit√© le m√™me type,
tout comme pour <code>EqT[A,B]</code>.
Pour rappel, <code>A =:= B</code> n&rsquo;est que du sucre syntaxique pour d√©signer le type <code>=:=[A,B]</code>.</p>
<p>Des instances de <code>A =:= B</code> peuvent √™tres cr√©es en utilisant la fonction
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less$.html#refl[A]:A=:=A" rel="external" target="_self"><code>(&lt;:&lt;).refl[X]: X =:= X</code>
(cliquer pour voir la documentation)</a>.
Le &ldquo;symbole&rdquo; <code>&lt;:&lt;</code> est en effet un nom d&rsquo;objet valide.</p>
<ul>
<li>
<p><strong>Question 5:</strong> En utilisant la fonction <code>coerce</code> ci-dessus,
√©crivez la fonction <code>def toScalaEq[A,B](eqT: EqT[A,B]): A =:= B</code>.</p>
  <details>
    <summary><em>Astuce (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">toScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* Trouver une d√©finition pour:
</span></span></span><span class="line"><span class="cl"><span class="cm">        - le constructeur de type `F`
</span></span></span><span class="line"><span class="cl"><span class="cm">        - la valeur `fa : F[A]`
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cm">/* Telles que cet appel: */</span>
</span></span><span class="line"><span class="cl">  <span class="n">coerce</span><span class="o">[</span><span class="kt">F</span>,<span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="o">)(</span><span class="n">fa</span><span class="o">)</span> <span class="c1">// soit de type `F[B]`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span></span></span></code></pre></div>
  </details>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">toScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="n">A</span> <span class="o">=:=</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">(&lt;:&lt;).</span><span class="n">refl</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">coerce</span><span class="o">[</span><span class="kt">F</span>,<span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="o">)(</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 6:</strong> En utilisant la <em>m√©thode</em> <code>substituteCo[F[_]](ff: F[A]): F[B]</code> des
objets de la classe <code>A =:= B</code>, dont la
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html#substituteCo[F[_]](ff:F[From]):F[To]" rel="external" target="_self">documentation est ici</a>,
√©crivez la fonction <code>def fromScalaEq[A,B](scala: A =:= B): EqT[A,B]</code>.</p>
  <details>
    <summary><em>Astuce (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">fromScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">scala</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* Trouver une d√©finition pour:
</span></span></span><span class="line"><span class="cl"><span class="cm">        - le constructeur de type `F`
</span></span></span><span class="line"><span class="cl"><span class="cm">        - la valeur `fa : F[A]`
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cm">/* Telles que cet appel: */</span>
</span></span><span class="line"><span class="cl">  <span class="n">scala</span><span class="o">.</span><span class="n">substituteCo</span><span class="o">[</span><span class="kt">F</span><span class="o">](</span><span class="n">fa</span><span class="o">)</span> <span class="c1">// soit de type `F[B]`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span></span></span></code></pre></div>
  </details>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">fromScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">scala</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">X</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span>
</span></span><span class="line"><span class="cl">  <span class="n">scala</span><span class="o">.</span><span class="n">substituteCo</span><span class="o">[</span><span class="kt">F</span><span class="o">](</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<h3 id="cas-dutilisation-t√©moin-de-sous-typage">Cas d&rsquo;Utilisation: T√©moin de Sous-Typage</h3>
<p>Dans cette section, nous voulons cr√©er les types <code>SubTypeOf[A,B]</code> dont les valeurs
prouvent que le type <code>A</code> est un sous-type de <code>B</code> (c.-√†-d. <code>A &lt;: B</code>).
Une classe similaire, <em>mais diff√©rente</em>, est d√©j√† d√©finie dans la
biblioth√®que standard de <em>Scala</em>.
Il s&rsquo;agit de la classe <code>&lt;:&lt;[A,B]</code>, qui est le plus souvent √©crite <code>A &lt;:&lt; B</code>. Sa
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less.html" rel="external" target="_self">documentation est ici</a>.
Cette section √©tant d√©di√©e √† l&rsquo;impl√©mentation d&rsquo;une variante de cette classe,
veuillez <strong>ne pas utiliser</strong> <code>&lt;:&lt;[A,B]</code> pour impl√©menter <code>SubTypeOf</code>.</p>
<ul>
<li>
<p><strong>Question 1:</strong> En utilisant uniquement des <em>bornes sup√©rieures</em> (c.-√†-d. <code>A &lt;: B</code>)
ou <em>bornes inf√©rieures</em> (c.-√†-d. <code>A &gt;: B</code>) et <strong>aucune</strong> <em>annotation de variance</em>
(c.-√†-d. <code>[+A]</code> et <code>[-A]</code>),
cr√©ez le trait <code>SubTypeOf[A,B]</code> (et tout ce qui est n√©cessaire) tel que:</p>
<blockquote>
<p>Il existe une valeur de type <code>SubType[A,B]</code> <strong>si et seulement si</strong>
<code>A</code> est un sous-type de <code>B</code> (c.-√†-d. <code>A &lt;: B</code>).</p></blockquote>
<p>Pour rappel, par d√©finition, un type <code>A</code> est un sous-type de lui-m√™me (c.-√†-d. <code>A &lt;: A</code>).</p>
<p>Pour rappel, n&rsquo;utilisez pas la classe <code>&lt;:&lt;[A,B]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SubTypeEvidence</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">B</span>, <span class="kt">B</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span></span></span></code></pre></div>
  <details>
    <summary><strong>Remarque pour les personnes √† l'aise en <em>Scala</em></strong> <em>(cliquer pour d√©voiler)</em></summary>
<p>En production, il est pratique de d√©finir <code>SubTypeOf</code> de la mani√®re √©quivalente suivante:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">SubTypeOf</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">B</span>, <span class="kt">B</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">evidence</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">B</span>, <span class="kt">B</span><span class="o">]</span><span class="k">:</span> <span class="kt">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
  </details>
</li>
</ul>
<h3 id="cas-dutilisation-√©viter-les-messages-derreur-de-scalac-√†-propos-des-bornes-non-respect√©es">Cas d&rsquo;Utilisation: √âviter les messages d&rsquo;erreur de <em>scalac</em> √† propos des bornes non respect√©es</h3>
<p>Dans cet exemple, nous voulons mod√©liser le r√©gime alimentaire de certains animaux.
Commen√ßons par d√©finir le type <code>Food</code> (c.-√†-d. nourriture) et quelques-uns de ces sous-types:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Food</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Vegetable</span> <span class="k">extends</span> <span class="nc">Food</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Fruit</span> <span class="k">extends</span> <span class="nc">Food</span></span></span></code></pre></div>
<p>et maintenant la classe repr√©sentant les animaux mangeant de la nourriture de type <code>A</code>
(c.-√†-d. <code>Vegetable</code>, <code>Fruit</code>, etc):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">Food</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nc">val</span> <span class="n">elephant</span> <span class="k">:</span> <span class="kt">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">]</span></span></span></code></pre></div>
<p>D√©finissons une fonction comme il en existe tant en <em>Programmation Fonctionnelle</em>
et passons lui <code>elephant</code> comme argument:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&#34;Ok!&#34;</span></span></span></code></pre></div>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">List</span>, <span class="kt">Int</span><span class="o">](</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">Option</span>, <span class="kt">Boolean</span><span class="o">](</span><span class="nc">Some</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="n">res1</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">AnimalEating</span>, <span class="kt">Vegetable</span><span class="o">](</span><span class="n">elephant</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="kt">kinds</span> <span class="kt">of</span> <span class="kt">the</span> <span class="k">type</span> <span class="kt">arguments</span> <span class="o">(</span><span class="kt">AnimalEating</span><span class="o">,</span><span class="kt">Vegetable</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">       <span class="k">do</span> <span class="n">not</span> <span class="n">conform</span> <span class="n">to</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">kinds</span> <span class="n">of</span> <span class="n">the</span> <span class="k">type</span> <span class="kt">parameters</span> <span class="o">(</span><span class="k">type</span> <span class="kt">F</span><span class="o">,</span><span class="k">type</span> <span class="kt">A</span><span class="o">).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nc">AnimalEating</span>&#39;s <span class="k">type</span> <span class="kt">parameters</span> <span class="kt">do</span> <span class="kt">not</span> <span class="kt">match</span> <span class="k">type</span> <span class="kt">F</span><span class="err">&#39;</span><span class="kt">s</span> <span class="kt">expected</span> <span class="kt">parameters:</span>
</span></span><span class="line"><span class="cl">       <span class="k">type</span> <span class="kt">A</span><span class="err">&#39;</span><span class="kt">s</span> <span class="kt">bounds</span> <span class="k">&lt;:</span> <span class="kt">Food</span> <span class="kt">are</span> <span class="kt">stricter</span> <span class="kt">than</span>
</span></span><span class="line"><span class="cl">       <span class="k">type</span> <span class="k">_</span><span class="err">&#39;</span><span class="kt">s</span> <span class="kt">declared</span> <span class="kt">bounds</span> <span class="k">&gt;:</span> <span class="kt">Nothing</span> <span class="k">&lt;:</span> <span class="kt">Any</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Pourquoi <em>scalac</em> se plaint il?</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>La fonction <code>dummy</code> requiert que son argument <code>F</code>, qui est un constructeur
de type comme le sont <code>List</code>, <code>Option</code>, <code>Future</code>, etc, accepte n&rsquo;importe quel type
en argument afin qu&rsquo;il soit toujours possible d&rsquo;√©crire <code>F[A]</code> pour n&rsquo;importe quel type <code>A</code>.
Hors <code>AnimalEating</code> impose que son argument soit un sous-type de <code>Food</code>.
Donc <code>AnimalEating</code> ne peut √™tre utilis√© comme argument <code>F</code> de <code>dummy</code>.</p>
  </details>
</li>
</ul>
<p>Le probl√®me est que, en d√©finissant <code>class AnimalEating[A &lt;: Food]</code>,
nous avons impos√© √† <code>A</code> d&rsquo;√™tre un sous-type de <code>Food</code>. Donc <em>Scala</em>, tout comme <em>Java</em>,
nous interdit de donner √† <code>AnimalEating</code>, en tant qu&rsquo;argument <code>A</code>, autre chose
qu&rsquo;un sous-type de <code>Food</code> (en incluant <code>Food</code> lui-m√™me):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">type</span> <span class="kt">T1</span> <span class="o">=</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">                 <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="k">type</span> <span class="kt">arguments</span> <span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">do</span> <span class="n">not</span> <span class="n">conform</span>
</span></span><span class="line"><span class="cl">       <span class="n">to</span> <span class="k">class</span> <span class="nc">AnimalEating</span>&#39;s <span class="k">type</span> <span class="kt">parameter</span> <span class="kt">bounds</span> <span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">Food</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">type</span> <span class="kt">T2</span> <span class="o">=</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Food</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">defined</span> <span class="k">type</span> <span class="kt">alias</span> <span class="kt">T2</span></span></span></code></pre></div>
<p>Nous sommes face √† un dilemme: afin d&rsquo;utiliser la fonction <code>dummy</code>, que nous tenons
beaucoup √† utiliser parce c&rsquo;est une fonction tr√®s utile, il nous faut supprimer la
contrainte <code>A &lt;: Food</code> de la d√©finition <code>class AnimalEating[A &lt;: Food]</code>.
Mais nous tenons √©galement au fait que les animaux ne mangent que de la nourriture (<code>Food</code>)
et pas des entiers, ni des bool√©ens et encore moins des cha√Ænes de caract√®res!</p>
<ul>
<li>
<p><strong>Question 2:</strong> Comment pouvez vous adapter la d√©finition de <code>AnimalEating</code> telle que:</p>
<ul>
<li>
<p>Il soit possible d&rsquo;appeler <code>dummy</code> avec comme argument <code>elephant</code>! Nous voulons:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">AnimalEating</span>, <span class="kt">Vegetable</span><span class="o">](</span><span class="n">elephant</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span></span></span></code></pre></div>
</li>
<li>
<p><em>Si</em> <code>A</code> <strong>n&rsquo;est pas un sous-type</strong> de <code>Food</code> (<code>Food</code> lui-m√™me inclus),
<em>alors</em> il doit √™tre <strong>impossible</strong> de cr√©er une instance de <code>AnimalEating[A]</code>.</p>
</li>
<li>
<p>La classe <code>AnimalEating</code> <strong>doit</strong> rester une classe ouverte
(c.-√†-d. non <code>sealed</code> ou <code>final</code>)! Il doit toujours √™tre possible pour n&rsquo;importe qui,
n&rsquo;importe quand, de cr√©er librement des sous-classes de <code>AnimalEating</code>.
Bien √©videmment, ces sous-classes doivent respecter les deux contraintes
ci-dessus.</p>
<details>
  <summary><em>Astuce (cliquer pour d√©voiler)</em></summary>
<p>En <em>Scala</em>, <code>Nothing</code> est un type ne contenant aucune valeur.
Pouvez vous cr√©er une valeur de type <code>(Nothing, Int)</code>? Pourquoi?</p>
</details>
<details>
  <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>Si, afin de cr√©er une instance de <code>AnimalEating[A]</code>, nous for√ßons <strong>chaque</strong>
m√©thode cr√©ant des valeurs √† prendre un param√®tre suppl√©mentaire de type <code>SubTypeOf[A, Food]</code>,
alors il sera uniquement possible de cr√©er une instance de <code>AnimalEating[A]</code>
quand <code>A</code> sera un sous-type de <code>Food</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">ev</span> <span class="k">:</span> <span class="kt">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">Food</span><span class="o">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">elephant</span> <span class="k">:</span> <span class="kt">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">](</span><span class="nc">SubTypeEvidence</span><span class="o">[</span><span class="kt">Vegetable</span>, <span class="kt">Food</span><span class="o">])</span></span></span></code></pre></div>
<p>Pour cr√©er une valeur de type <code>AnimalEating[A]</code>, nous avons besoin d&rsquo;appeler
le constructeur d&rsquo;<code>AnimalEating</code>. Pour appeler ce constructeur,
il nous faut fournir <code>ev : SubTypeOf[A, Food]</code>.</p>
<p>Il nous est d√©sormais possible d&rsquo;appeler la fonction <code>dummy</code> sur <code>elephant</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">AnimalEating</span>, <span class="kt">Vegetable</span><span class="o">](</span><span class="n">elephant</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span></span></span></code></pre></div>
<p>En pratique, en utilisant des implicites, le compilateur peut
fournir de lui-m√™me le param√®tre <code>ev : SubTypeOf[A, Food]</code>.</p>
<p>Notez qu&rsquo;il est d√©sormais possible d&rsquo;√©crire le type <code>AnimalEating[Int]</code>
mais vous ne pourrez jamais cr√©er une valeur de ce type.</p>
</details>
</li>
</ul>
</li>
</ul>
<h3 id="cas-dutilisation-fournir-les-bonnes-donn√©es-au-bon-diagramme">Cas d&rsquo;Utilisation: Fournir les bonnes donn√©es au bon diagramme</h3>
<p>Ce cas d&rsquo;utilisation traite des m√©thodes pour garantir, √† la compilation,
que seulement les valeurs du bon type peuvent √™tre donn√©es √† une fonction donn√©e.
L&rsquo;exemple choisi est celui de la conception d&rsquo;une biblioth√®que de graphiques.
Afin de simplifier l&rsquo;exemple, nous consid√®rerons que notre biblioth√®que n&rsquo;impl√©mente
que deux types de graphique:
des <a href="https://www.google.com/search?q=pie+chart&tbm=isch" rel="external" target="_self">camemberts (c.-√†-d. pie charts)</a>
et des <a href="https://www.google.com/search?q=xy+charts&tbm=isch" rel="external" target="_self">graphiques dit XY (c.-√†-d. XY charts)</a>.
Cela s&rsquo;√©crit en <em>Scala</em> via l&rsquo;√©num√©ration:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ChartType</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">PieChart</span> <span class="k">extends</span> <span class="nc">ChartType</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">XYChart</span> <span class="k">extends</span> <span class="nc">ChartType</span></span></span></code></pre></div>
<p>Bien √©videmment les camemberts (<em>Pie</em>) et graphiques <em>XY</em> s&rsquo;appuient sur des jeux de donn√©es de
nature diff√©rente. Encore une fois, pour simplifier, nous consid√®rerons que les deux types
de donn√©es sont <code>PieData</code> pour les camemberts et <code>XYData</code> pour les graphiques <em>XY</em>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PieData</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">XYData</span></span></span></code></pre></div>
<p>Un camembert (<code>PieChart</code>) n&rsquo;affiche <strong>que</strong> des donn√©es <code>PieData</code>,
alors qu&rsquo;un graphique <em>XY</em> (<code>XYChart</code>) n&rsquo;affiche <strong>que</strong> des donn√©es <code>XYData</code>.
Voici, grandement simplifi√©e, la fonction d&rsquo;affichage <code>draw</code>:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">draw</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">chartType</span><span class="k">:</span> <span class="kt">ChartType</span><span class="o">)(</span><span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">chartType</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PieChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">pieData</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">PieData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Faire des trucs pour tracer les donn√©es pieData
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">XYChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">xyData</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">XYData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Faire des trucs pour tracer les donn√©es xyData
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Cette fonction repose sur l&rsquo;hypoth√®se que l&rsquo;utilisateur¬∑rice n&rsquo;appellera la
fonction <code>draw</code> que sur le bon type de donn√©es.
Quand <code>chartType</code> vaut <code>PieChart</code>, la fonction pr√©suppose, via
<code>data.asInstanceOf[PieData]</code> que <code>data</code> est en fait du type <code>PieData</code>.
Et quand <code>chartType</code> vaut <code>XYChart</code>, elle pr√©suppose que <code>data</code> est en fait
de type <code>XYData</code>.</p>
<p>Le probl√®me est que ces suppositions reposent sur l&rsquo;id√©e que les utilisateurs¬∑rices et/ou
d√©veloppeurs¬∑euses s&rsquo;assureront toujours que ces hypoth√®ses soient bien respect√©es.
Mais <strong>rien</strong> n&rsquo;emp√™che quelqu&rsquo;un¬∑e d&rsquo;appeler <code>draw</code> sur un camembert (<code>PieChart</code>)
avec des donn√©es de type <code>XYData</code> (ou le contraire),
faisant planter le syst√®me mis√©rablement en production!</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">draw</span><span class="o">(</span><span class="nc">PieChart</span><span class="o">)(</span><span class="k">new</span> <span class="nc">XYData</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">ClassCastException</span><span class="k">:</span> <span class="kt">XYData</span> <span class="kt">cannot</span> <span class="kt">be</span> <span class="kt">cast</span> <span class="kt">to</span> <span class="kt">PieData</span>
</span></span><span class="line"><span class="cl">  <span class="n">at</span> <span class="o">.</span><span class="n">draw</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">11</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span> <span class="mi">28</span> <span class="n">elided</span></span></span></code></pre></div>
<p>En tant que d√©veloppeurs¬∑euses, nous savons que les erreurs, √ßa arrive!
Nous voulons un moyen d&rsquo;emp√™cher ces bogues ennuyeux de survenir en production!
Nous voulons imposer, √† la compilation, que seulement deux scenarii soit possibles:</p>
<ul>
<li>Quand <code>draw</code> est appel√©e avec <code>chartType == PieChart</code>:
l&rsquo;argument <code>data</code> doit √™tre de type <code>PieData</code></li>
<li>Quand <code>draw</code> est appel√©e avec <code>chartType == XYChart</code>:
l&rsquo;argument <code>data</code> doit √™tre de type <code>XYData</code>.</li>
</ul>
<p>Pour rappel, ces deux contraintes doivent √™tre v√©rifi√©es √† la compilation!</p>
<ul>
<li>
<p><strong>Question 1:</strong> Adaptez les d√©finitions de <code>ChartType</code>, <code>PieChart</code>, <code>XYChart</code> et <code>draw</code> telles que:</p>
<ul>
<li>
<p>Tout scenario diff√©rent des deux ci-dessus fera √©chouer la compilation sur une erreur de type.</p>
</li>
<li>
<p><code>ChartType</code> doit toujours √™tre un <code>sealed trait</code>. Mais il est autoris√© √† prendre des <em>param√®tres de type</em> (c.-√†-d. <em>generics</em>).</p>
</li>
<li>
<p><code>PieChart</code> et <code>XYChar</code> doivent toujours √™tre des <code>case object</code>
et ils doivent toujours √©tendre <code>ChartType</code>.</p>
</li>
<li>
<p>Les d√©clarations de <code>ChartType</code>, <code>PieChart</code> et <code>XYChar</code>
ne doivent <strong>pas</strong> avoir <strong>de corps</strong> du tout
(c.-√†-d. il ne doit pas y avoir d&rsquo;accolades <code>{ ... }</code> dans leurs d√©clarations);</p>
</li>
</ul>
  <details>
    <summary><em>Astuce (cliquer pour d√©voiler)</em></summary>
<p>Le code ressemble √† ceci:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">/*METTRE</span> <span class="kt">LES</span> <span class="kt">GENERICS</span> <span class="kt">ICI*/</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">case</span> <span class="k">object</span> <span class="nc">PieChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">/*Il</span> <span class="kt">y</span> <span class="kt">a</span> <span class="kt">quelque</span> <span class="kt">chose</span> <span class="kt">√†</span> <span class="kt">√©crire</span> <span class="kt">ici*/</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">XYChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">/*Il</span> <span class="kt">y</span> <span class="kt">a</span> <span class="kt">quelque</span> <span class="kt">chose</span> <span class="kt">√†</span> <span class="kt">√©crire</span> <span class="kt">ici</span> <span class="kt">aussi*/</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">draw</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">chartType</span><span class="k">:</span> <span class="kt">ChartType</span><span class="o">[</span><span class="kt">/*Ecrire</span> <span class="kt">quelque</span> <span class="kt">chose</span> <span class="kt">ici*/</span><span class="o">])(</span><span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">chartType</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PieChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">pieData</span> <span class="k">:</span> <span class="kt">PieData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">XYChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">xyData</span><span class="k">:</span> <span class="kt">XYData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div>
  </details>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">case</span> <span class="k">object</span> <span class="nc">PieChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">PieData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">XYChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">XYData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">draw</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">chartType</span><span class="k">:</span> <span class="kt">ChartType</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">chartType</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PieChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">pieData</span> <span class="k">:</span> <span class="kt">PieData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">XYChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">xyData</span><span class="k">:</span> <span class="kt">XYData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>Vous pouvez maintenant dormir sur vos deux oreilles avec l&rsquo;assurance que
votre code en production ne plantera pas √† cause d&rsquo;une entr√©e non conforme
√† cet endroit üòâ</p>
<h2 id="cas-dutilisation-plus-avanc√©s">Cas d&rsquo;Utilisation Plus Avanc√©s</h2>
<p>Maintenant que vous avez vu ce que sont les <em>GADTs</em> et comment les utiliser dans
la vie de tous les jours, vous √™tes pr√™t¬∑e pour les cas d&rsquo;utilisations plus cons√©quents
ci-dessous.
Il y en a trois. Chacun illustre une mani√®re diff√©rente d&rsquo;utiliser la puissance des <em>GADTs</em>.
Le <a href="../../posts/les_gadts_par_l_exemple/index.html#cas-d-utilisation-les-effets">premier</a> traite de l&rsquo;expression d&rsquo;effets,
ce qui est tr√®s largement utilis√© dans chaque monade <em>IO</em> populaire ou effets alg√©briques.
Ne vous inqui√©tez pas de ne pas savoir ce que sont ces derniers, cette section l&rsquo;expliquera.
Le <a href="../../posts/les_gadts_par_l_exemple/index.html#cas-d-utilisation-s-assurer-que-les-types-sont-pris-en-charge-par-la-base-de-donn√©es">second</a>
s&rsquo;attache √† montrer comment garantir des propri√©t√©s dans le syst√®me de types.
Ce point est illustr√© √† travers l&rsquo;exemple de l‚Äôaccommodation des techniques issues
de la programmation fonctionnelle aux contraintes issues des bases de donn√©es.
Le <a href="../../posts/les_gadts_par_l_exemple/index.html#cas-d-utilisation-simplifier-les-implicites">troisi√®me</a> offre une mani√®re plus simple
de travailler avec des implicites.</p>
<h3 id="cas-dutilisation-les-effets">Cas d&rsquo;Utilisation: Les Effets!</h3>
<p>Ce qui est appel√© un effet est parfois juste une interface d√©clarant quelques
fonctions d√©pourvues d&rsquo;impl√©mentation. Par exemple nous pouvons d√©finir le
<code>trait</code> ci-dessous. Notez qu&rsquo;<em>aucune</em> de ces fonctions n&rsquo;a d&rsquo;impl√©mentation.</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">ExampleEffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">randomInt</span> <span class="k">:</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">ignore</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Les impl√©mentations de ces interfaces (traits) sont donn√©es ailleurs, et il peut en avoir beaucoup!
Cela est utile quand il est d√©sirable de changer facilement d&rsquo;impl√©mentation:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">ExampleEffectImpl</span> <span class="k">extends</span> <span class="nc">ExampleEffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">randomInt</span> <span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">ignore</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Une mani√®re √©quivalente de d√©finir <code>ExampleEffectSig</code> est via un <code>sealed trait</code>
muni de quelques <code>final case class</code> (peut-√™tre aucune!) et/ou quelques <code>case object</code> (peut-√™tre aucun!):</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Echo</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">RandomInt</span> <span class="k">extends</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Ignore</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span></span></span></code></pre></div>
<p>De nouveau, nous avons des d√©clarations ne fournissant aucune impl√©mentation!
De nouveau, leurs impl√©mentations peuvent √™tre fournies ailleurs et il peut en avoir beaucoup:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">runExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">ExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Echo</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">RandomInt</span>   <span class="k">=&gt;</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Ignore</span><span class="o">(</span><span class="k">_</span><span class="o">)</span>   <span class="k">=&gt;</span> <span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Prenons un effet plus r√©aliste ainsi qu&rsquo;une de ses impl√©mentations possibles:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">EffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">currentTimeMillis</span><span class="k">:</span> <span class="kt">Long</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">printLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">EffectImpl</span> <span class="k">extends</span> <span class="nc">EffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">currentTimeMillis</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">printLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Tout comme <code>ExampleEffect</code> est l&rsquo;√©quivalent de <code>ExampleEffectSig</code>
via la d√©finition d&rsquo;un <code>sealed trait</code> muni de quelques <code>final case class</code> et
<code>case object</code>, √©crivez l&rsquo;√©quivalent de <code>EffectSig</code> de la m√™me mani√®re.
Appelez ce trait <code>Effect</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">CurrentTimeMillis</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> √âcrivez la fonction <code>def run[A](effect: Effect[A]): A</code> qui reproduit l&rsquo;impl√©mentation de
<code>EffectImpl</code> tout comme <code>runExampleEffect</code> reproduit celle de <code>ExampleEffectImpl</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">CurrentTimeMillis</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Mesure</span><span class="o">(</span><span class="n">fun</span><span class="o">,</span> <span class="n">arg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>Le type <code>Effect[A]</code> d√©clare des effets int√©ressants (<code>CurrentTimeMillis</code>,
<code>PrintLn</code> et <code>Mesure</code>) mais pour √™tre r√©ellement utile, il doit √™tre possible
de cha√Æner ces effets! Pour ce faire, nous voulons pouvoir disposer des deux fonctions suivantes:</p>
<ul>
<li><code>def pure[A](value: A): Effect[A]</code></li>
<li><code>def flatMap[X,A](fx: Effect[X], f: X =&gt; Effect[A]): Effect[A]</code></li>
</ul>
<p>De nouveau, nous ne nous int√©ressons pas √† leurs impl√©mentations. Tout ce que nous
voulons, pour le moment, est d√©clarer ces deux op√©rations de la m√™me mani√®re que
nous avons d√©clar√© <code>CurrentTimeMillis</code>, <code>PrintLn</code> et <code>Mesure</code>.</p>
<ul>
<li>
<p><strong>Question 3:</strong> Ajoutez deux <em>final case classes</em>, <code>Pure</code> et <code>FlatMap</code>,
√† <code>Effect[A]</code> d√©clarant ces deux op√©rations.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">CurrentTimeMillis</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">FlatMap</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fx</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">X</span><span class="o">],</span> <span class="n">f</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 4:</strong> Adaptez la fonction <code>run</code> pour g√©rer ces deux nouveaux cas.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">CurrentTimeMillis</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Mesure</span><span class="o">(</span><span class="n">fun</span><span class="o">,</span> <span class="n">arg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="n">fx</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">x</span>  <span class="k">=</span> <span class="n">run</span><span class="o">(</span><span class="n">fx</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">run</span><span class="o">(</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 5:</strong> Ajoutez les deux m√©thodes suivantes au trait <code>Effect[A]</code> pour obtenir:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">]((</span><span class="n">a</span><span class="k">:</span><span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Et ex√©cutez le code suivant pour voir s&rsquo;il fonctionne:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">effect1</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t0</span> <span class="k">&lt;-</span> <span class="nc">CurrentTimeMillis</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span>  <span class="k">&lt;-</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="s">s&#34;The current time is </span><span class="si">$t0</span><span class="s">&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">run</span><span class="o">(</span><span class="n">effect1</span><span class="o">)</span></span></span></code></pre></div>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">]((</span><span class="n">a</span><span class="k">:</span><span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">CurrentTimeMillis</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">FlatMap</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fx</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">X</span><span class="o">],</span> <span class="n">f</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">CurrentTimeMillis</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Mesure</span><span class="o">(</span><span class="n">fun</span><span class="o">,</span> <span class="n">arg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="n">fx</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">x</span>  <span class="k">=</span> <span class="n">run</span><span class="o">(</span><span class="n">fx</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">run</span><span class="o">(</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">effect1</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t0</span> <span class="k">&lt;-</span> <span class="nc">CurrentTimeMillis</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span>  <span class="k">&lt;-</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="s">s&#34;The current time is </span><span class="si">$t0</span><span class="s">&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span></span></span></code></pre></div>
<p>En ex√©cutant <code>run(effect1)</code> on obtient:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">run</span><span class="o">(</span><span class="n">effect1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nc">The</span> <span class="n">current</span> <span class="n">time</span> <span class="n">is</span> <span class="mi">1569773175010</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>F√©licitations! Vous venez d&rsquo;√©crire votre premi√®re monade <em>IO</em>! Il y
a de nombreux noms scientifiques au <code>sealed trait Effect[A]</code>:
vous pouvez l&rsquo;appeler un <em>effet alg√©brique</em>, une <em>monade libre</em>, une <em>IO</em>, etc.
Mais au bout du compte, ce n&rsquo;est qu&rsquo;un simple et banal <code>sealed trait</code> pour lequel
nous avons d√©fini quelques <code>final case class</code> et <code>case object</code> afin de
repr√©senter les fonctions dont nous voulions disposer sans fournir
leurs impl√©mentations (<code>CurrentTimeMillis</code>, <code>PrintLn</code>, <code>Mesure</code>,
<code>Pure</code> et <code>FlatMap</code>). Vous pouvez les appeler des <em>m√©thodes virtuelles</em> si vous voulez.
<strong>Ce qui importe r√©ellement est d&rsquo;avoir isol√© la d√©finition de ces fonctions de leurs impl√©mentations.</strong>
Rappelez vous qu&rsquo;un <code>trait</code> est juste une interface apr√®s tout.</p>
<h3 id="cas-dutilisation-sassurer-que-les-types-sont-pris-en-charge-par-la-base-de-donn√©es">Cas d&rsquo;Utilisation: S&rsquo;assurer que les types sont pris en charge par la Base De Donn√©es.</h3>
<p>Les bases de donn√©es sont formidables. Nous pouvons y stocker des tables, des documents,
des paires clef/valeur, des graphes, etc.
Mais, pour n&rsquo;importe quelle base de donn√©es, il y a malheureusement seulement un nombre limit√©
de types pris en charge.
Prenez la base de donn√©es que vous voulez, je suis s√ªr de pouvoir trouver des types qu&rsquo;elle
ne prend pas en charge.</p>
<p>Dans cette section, nous allons nous int√©resser au cas des structures des donn√©es
et du code qui ne marche pas pour tout les types, mais seulement certains! Ce cas d&rsquo;usage
ne se limite pas aux bases de donn√©es mais concerne chaque <em>interface de programmation</em> qui ne
supporte qu&rsquo;un nombre limit√© de types (la vaste majorit√© des <em>interfaces de programmation</em>).
Comment s&rsquo;assurer du respect de ces contraintes? Comment adapter les techniques que nous aimons
afin qu&rsquo;elles travaillent sous ces contraintes? Voil√† ce dont il s&rsquo;agit dans cette section.</p>
<p>Nous consid√©rerons une base de donn√©es fictive qui ne prend en charge <strong>que</strong> les types suivants:</p>
<ol>
<li><code>String</code></li>
<li><code>Double</code></li>
<li><code>(A,B)</code> o√π <code>A</code> et <code>B</code> sont √©galement des types pris en charge par la base de donn√©es.</li>
</ol>
<p>Cela signifie que les valeurs stock√©es dans la base de donn√©es (dans des tables, des paires clef/valeur,
etc) <strong>doivent</strong> respecter les r√®gles ci-dessus. Elle peut stocker <code>&quot;Hello World&quot;</code> parce que c&rsquo;est une
<code>String</code>, qui est est un type pris en charge par la base de donn√©es en vertu de la r√®gle <em>1</em>.
Pour les m√™mes raisons, elle peut stocker <code>5.2</code> parce que c&rsquo;est un <code>Double</code>,
mais elle ne peut <strong>pas</strong> stocker l&rsquo;entier <code>5</code> parce que c&rsquo;est un<code>Int</code>.
Elle peut stocker <code>(&quot;Hello World&quot;, 5.2)</code> gr√¢ce √† la r√®gle <em>3</em> ainsi que
<code>((&quot;Hello World&quot;, 5.2) , 8.9)</code>, de nouveau gr√¢ce √† la r√®gle <em>3</em>.</p>
<ul>
<li>
<p><strong>Question 1:</strong> D√©finissez le type <code>DBType[A]</code> tel que:</p>
<blockquote>
<p>Il existe une valeur de type <code>DBType[A]</code> <strong>si et seulement si</strong> <code>A</code>
est un type pris en charge par la base de donn√©es.</p></blockquote>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>La version simple est:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBString</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBDouble</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">DBPair</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">first</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">second</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span></span></span></code></pre></div>
  <details>
  <summary><strong>Remarque pour les personnes √† l'aise en <em>Scala</em></strong> <em>(cliquer pour d√©voiler)</em></summary>
<p>En utilisant toutes les chouettes fonctionnalit√©s syntaxiques de <em>Scala</em>,
la version satisfaisante en production du code ci-dessus est:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">DBType</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBString</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBDouble</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DBPair</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">first</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">second</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">dbString</span> <span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBString</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">dbDouble</span> <span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBDouble</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">dbPair</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="k">implicit</span> <span class="n">first</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">second</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBPair</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
  </details>
</li>
</ul>
<p>En utilisant <code>DBType</code>, nous pouvons coupler une valeur de type <code>A</code>
avec une valeur de type <code>DBType[A]</code>, fournissant ainsi la preuve que
le type <code>A</code> est pris en charge par la base de donn√©es:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DBValue</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="k">implicit</span> <span class="k">val</span> <span class="n">dbType</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span></span></span></code></pre></div>
<p>Notez que le param√®tre <code>dbType</code> n&rsquo;a nullement besoin d&rsquo;√™tre implicite!
Ce qui compte est que pour cr√©er une valeur de type <code>DBValue[A]</code>,
nous devons fournir une valeur de type <code>DBType[A]</code>
ce qui force <code>A</code> √† √™tre un type pris en charge par la base de donn√©es.</p>
<p>Un <em>foncteur</em> est, de mani√®re informelle et approximative, un constructeur de type<code>F</code>,
comme <code>List</code>, <code>Option</code>, <code>DBValue</code>, etc,
pour lequel il est possible de fournir une instance du trait:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>o√π <code>map(fa)(f)</code> applique la fonction <code>f</code> √† chaque valeur de type <code>A</code> contenue dans <code>fa</code>. Par exemple:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">object</span> <span class="nc">OptionFunctor</span> <span class="k">extends</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">Option</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">fa</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="nc">None</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 2:</strong> √âcrivez une instance de <code>Functor[DBValue]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<p>C&rsquo;est en fait impossible! Si nous tentions de compiler le code suivant:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">DBValueFunctor</span> <span class="k">extends</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">DBValue</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="o">(</span><span class="n">fa</span><span class="o">.</span><span class="n">value</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p><em>Scala</em> r√¢lerait: <code>could not find implicit value for parameter dbType: DBType[B]</code>. En effet, les bool√©ens
ne sont pas un type pris en charge par la base de donn√©es:
ils ne sont ni des cha√Ænes de caract√®res, ni des nombres flottants, ni des paires de types pris en charge.</p>
<p>Supposons que nous puissions d√©finir une instance de <code>Funcor</code> pour <code>DBValue</code>
(c.-√†-d. que nous puissions d√©finir une fonction <code>map</code> pour <code>DBValue</code>), alors nous pourrions √©crire:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">dbValueString</span>  <span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>  <span class="k">=</span> <span class="nc">DBValue</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">)(</span><span class="nc">DBString</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">dbValueBoolean</span> <span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="n">dbValueString</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">dbTypeBoooean</span>  <span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>  <span class="k">=</span> <span class="n">dbValueBoolean</span><span class="o">.</span><span class="n">dbType</span></span></span></code></pre></div>
<p>Nous obtiendrions une valeur (<code>dbTypeBoooean</code>) de type <code>DBType[Boolean]</code>
ce qui signifirait que le type <code>Boolean</code> est pris en charge par la base de donn√©es.
Mais il ne l&rsquo;est pas! Hors par d√©finition:</p>
<blockquote>
<p>Il existe une valeur de type <code>DBType[A]</code> <strong>si et seulement si</strong> <code>A</code>
est un type pris en charge par la base de donn√©e.</p></blockquote>
<p>Donc il est impossible d&rsquo;obtenir une valeur de type <code>DBType[Boolean]</code>
et donc il est impossible d&rsquo;√©crire une fonction <code>map</code> pout <code>DBValue</code>.
Ainsi il n&rsquo;y a aucun moyen de d√©finir une instance de <code>Functor</code> pour <code>DBValue</code>. CQDF.</p>
  </details>
</li>
</ul>
<p>Un <em>Foncteur G√©n√©ralis√©</em> est tr√®s similaire √† un <code>Functor</code> classique, √† la diff√©rence pr√®s
que la fonction <code>map</code> ne doit pas obligatoirement √™tre applicable √† n&rsquo;importe quels
types <code>A</code> et <code>B</code> mais peut n&rsquo;√™tre applicable qu&rsquo;√† certains types <code>A</code> et <code>B</code> particuliers:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">P</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">evA</span><span class="k">:</span> <span class="kt">P</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">evB</span><span class="k">:</span> <span class="kt">P</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Par exemple, <code>Set</code> (plus pr√©cis√©ment <code>TreeSet</code>) n&rsquo;est pas un foncteur!
En effet il n&rsquo;y a aucun moyen d&rsquo;√©crire une fonction <code>map</code> qui fonctionne
pour n&rsquo;importe quel type <code>B</code> (parce qu&rsquo;il est n√©cessaire d&rsquo;avoir une relation d&rsquo;ordre sur <code>B</code>).
Mais si l&rsquo;on restreint <code>map</code> aux seuls types <code>B</code> disposant d&rsquo;une relation d&rsquo;ordre, alors il devient
possible d&rsquo;√©crire:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">scala.collection.immutable._</span>
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">TreeSetFunctor</span> <span class="k">extends</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">Ordering</span>, <span class="kt">TreeSet</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">TreeSet</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">evA</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">evB</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">TreeSet</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">TreeSet</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">evB</span><span class="o">)</span> <span class="o">++</span> <span class="n">fa</span><span class="o">.</span><span class="n">toSeq</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 3:</strong> √âcrivez une instance de <code>GenFunctor[DBType, DBValue]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">DBValueGenFunctor</span> <span class="k">extends</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">DBType</span>, <span class="kt">DBValue</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">evA</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">evB</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="o">(</span><span class="n">fa</span><span class="o">.</span><span class="n">value</span><span class="o">))(</span><span class="n">evB</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>Ce que nous avons fait ici avec <code>Functor</code> peut √™tre fait avec de nombreuses structures de donn√©es et
techniques de programmation. Il est souvent possible de restreindre la plage des types sur lesquels
la structure de donn√©e ou la classe de types (<em>type class</em>) peut op√©rer en ajoutant un param√®tre
suppl√©mentaire comme <code>ev : DBType[A]</code> aux constructeurs et m√©thodes.</p>
<h3 id="cas-dutilisation-simplifier-les-implicites">Cas d&rsquo;Utilisation: Simplifier les Implicites</h3>
<p>Ce cas d&rsquo;utilisation est l&rsquo;un des plus int√©ressants, mais malheureusement, pas l&rsquo;un des plus simples.
Il montre comment il est possible d&rsquo;utiliser les <em>GADTs</em> pour simplifier la cr√©ation de valeurs implicites.</p>
<p>Des listes de valeurs dont les √©l√©ments peuvent √™tre de types diff√©rents sont appel√©es
<em>listes h√©t√©rog√®nes</em>. Elles sont g√©n√©ralement d√©finies en <em>Scala</em> presque comme
les listes classiques:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HNil</span><span class="o">()</span> <span class="c1">// La liste vide
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="n">head</span><span class="k">:</span> <span class="kt">Head</span><span class="o">,</span> <span class="n">tail</span><span class="k">:</span> <span class="kt">Tail</span><span class="o">)</span> <span class="c1">// L&#39;operation: `head :: tail`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">empty</span> <span class="k">:</span> <span class="kt">HNil</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">HNil</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">oneTrueToto</span> <span class="k">:</span> <span class="kt">HCons</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">Boolean</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">HNil</span><span class="o">]]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">HCons</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="s">&#34;toto&#34;</span><span class="o">,</span> <span class="nc">HNil</span><span class="o">())))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">falseTrueFive</span><span class="k">:</span> <span class="kt">HCons</span><span class="o">[</span><span class="kt">Boolean</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">Boolean</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">HNil</span><span class="o">]]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">HCons</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">HNil</span><span class="o">())))</span></span></span></code></pre></div>
<p>Comme vous pouvez le voir, il n&rsquo;y a rien de vraiment sp√©cial √† propos de ces listes.
Nous voulons d√©finir des relations d&rsquo;ordre sur les listes h√©t√©rog√®nes.
Une relation d&rsquo;ordre est une fa√ßon de comparer deux valeurs (<strong>du m√™me type!</strong>):
elles peuvent √™tres √©gales ou l&rsquo;une peut √™tre strictement plus petite que l&rsquo;autre.
Une relation d&rsquo;ordre sur le type <code>A</code> peut se d√©finir en <em>Scala</em> comme une instance
de <code>Order[A]</code> d√©fini comme suit:</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// vrai si et seulement si a1 &lt; a2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">def</span> <span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cm">/* a1 et a2 sont √©gales si et seulement si
</span></span></span><span class="line"><span class="cl"><span class="cm">     aucune d&#39;entre elles n&#39;est strictement plus petite que l&#39;autre
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">areEqual</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="n">a2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a2</span><span class="o">,</span> <span class="n">a1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// a1 &gt; a2 si et seulement si a2 &lt; a1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">final</span> <span class="k">def</span> <span class="n">greaterThan</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="n">lesserThan</span><span class="o">(</span><span class="n">a2</span><span class="o">,</span> <span class="n">a1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">lesserThanOrEqual</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a2</span><span class="o">,</span> <span class="n">a1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">greaterThanOrEqual</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="n">a2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">Order</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">make</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">lg_</span> <span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span><span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="n">lg_</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span><span class="n">a2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">val</span> <span class="n">orderInt</span>    <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="k">_</span> <span class="o">&lt;</span> <span class="k">_</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">val</span> <span class="n">orderString</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="k">_</span> <span class="o">&lt;</span> <span class="k">_</span><span class="o">)</span></span></span></code></pre></div>
<p>Pour rappel, nous ne comparerons que des listes de <em>m√™me type</em>:</p>
<ul>
<li>Les listes de type <code>HNil</code> seront uniquement compar√©es √† d&rsquo;autres listes de type <code>HNil</code>.</li>
<li>Les listes de type <code>HCons[H,T]</code> seront uniquement compar√©es √† d&rsquo;autres listes de type <code>HCons[H,T]</code>.</li>
</ul>
<p>Comparer des listes de type <code>HNil</code> est trivial parce qu&rsquo;il n&rsquo;y a qu&rsquo;une seule et unique valeur
de type <code>HNil</code> (la liste vide <code>HNil()</code>). Mais il existe de nombreuses fa√ßon de comparer des listes
de type <code>HCons[H,T]</code>.
Voici deux relations d&rsquo;ordre possibles (il en existe de nombreuses autres!):</p>
<ul>
<li>
<p>L&rsquo;<em>ordre lexicographique</em> (c.-√†-d. l&rsquo;ordre du dictionnaire: de la gauche vers la droite)</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>si et seulement si</strong>
<code>h1 &lt; h2</code> <em>ou</em> (<code>h1 == h2</code> <em>et</em> <code>t1 &lt; t2</code> <em>par l&rsquo;ordre lexicographique</em>).</p></blockquote>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Lex</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">order</span> <span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">Lex</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">lexHNil</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Lex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">lexHCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">lexTail</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Lex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">lexTail</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderHead</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</li>
<li>
<p>L&rsquo;<em>ordre lexicographique invers√©</em> qui est la version √† l&rsquo;envers de l&rsquo;ordre lexicographique
(c.-√†-d. de droite √† gauche)</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>si et seulement si</strong>
(<code>t1 &lt; t2</code> <em>par ordre lexicographique invers√©</em>) <em>ou</em> (<code>t1 == t2</code> <em>et</em> <code>h1 &lt; h2</code>).</p></blockquote>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">RevLex</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">order</span> <span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">RevLex</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">revLexHNil</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">RevLex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">revLexHCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">revLexTail</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">RevLex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">revLexTail</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderTail</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</li>
</ul>
<p>Comme dit plus haut, il est possible de d√©finir davantage de relations d&rsquo;ordre:</p>
<ul>
<li>
<p><strong>Question 1:</strong> L&rsquo;ordre <code>Alternate</code> est d√©fini par:</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>si et seulement si</strong>
<code>h1 &lt; h2</code> <em>ou</em> (<code>h1 == h2</code> <em>et</em> <code>t1 &gt; t2</code> <em>par ordre</em> <code>Alternate</code>).</p></blockquote>
<p>En suivant la m√©thoe employ√©e pour <code>Lex</code> and <code>RevLex</code>,
impl√©mentez l&rsquo;ordre <code>Alternate</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Alternate</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">order</span> <span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">Alternate</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">alternateHNil</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Alternate</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">alternateHCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">alternateTail</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Alternate</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">alternateTail</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderHead</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderTail</span><span class="o">.</span><span class="n">greaterThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>Il existe de nombreuses mani√®res de d√©finir une relation d&rsquo;ordre valide sur les listes h√©t√©rog√®nes!
Cr√©er une classe de type (<em>type class</em>) comme <code>Lex</code>, <code>RevLex</code> et <code>Alternate</code> pour chaque relation
d&rsquo;ordre voulue est fatigant et propice aux erreurs. Nous pouvons faire bien mieux &hellip;
avec un <em>GADT</em> üòâ</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">HListOrder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">HNilOrder</span> <span class="k">extends</span> <span class="nc">HListOrder</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HConsOrder</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">hlistOrderTail</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span> <span class="k">extends</span> <span class="nc">HListOrder</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// D√©finitions des Implicites
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">hnilOrder</span> <span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">HNilOrder</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">hconsOrder</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">hlistOrderTail</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">HConsOrder</span><span class="o">(</span><span class="n">orderHead</span><span class="o">,</span> <span class="n">hlistOrderTail</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Il est √† noter que la d√©finition de ces implicites est du pur boilerplate. Leur seule
raison d&rsquo;√™tre est de passer leurs arguments au constructeur correspondant
(c.-√†-d. <code>final case class</code> ou <code>case object</code>):
<code>hnilOrder</code> √† <code>HListOrder</code> (O arguments) et <code>hconsOrder</code> √† <code>HConsOrder</code> (2 arguments).</p>
<ul>
<li>
<p><strong>Question 2:</strong> √âcrivez une fonction <code>def lex[A](implicit v : HListOrder[A]): Order[A]</code>
qui retourne l&rsquo;ordre lexicographique √† partir d&rsquo;une valeur de type <code>HListOrder[A]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">lex</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">v</span> <span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">HListOrder</span><span class="o">.</span><span class="nc">HNilOrder</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">hc</span> <span class="k">:</span> <span class="kt">HListOrder.HConsOrder</span><span class="o">[</span><span class="kt">head</span>,<span class="kt">tail</span><span class="o">]</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">head</span><span class="o">]</span> <span class="k">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">orderHead</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">lex</span><span class="o">(</span><span class="n">hc</span><span class="o">.</span><span class="n">hlistOrderTail</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">head</span>, <span class="kt">tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderHead</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> √âcrivez une fonction <code>def revLex[A](implicit v : HListOrder[A]): Order[A]</code>
qui retourne l&rsquo;ordre lexicographique invers√© √† partir d&rsquo;une valeur de type <code>HListOrder[A]</code>.</p>
  <details>
    <summary><em>Solution (cliquer pour d√©voiler)</em></summary>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">revLex</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">v</span> <span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">HListOrder</span><span class="o">.</span><span class="nc">HNilOrder</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">hc</span> <span class="k">:</span> <span class="kt">HListOrder.HConsOrder</span><span class="o">[</span><span class="kt">head</span>,<span class="kt">tail</span><span class="o">]</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">head</span><span class="o">]</span> <span class="k">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">orderHead</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">revLex</span><span class="o">(</span><span class="n">hc</span><span class="o">.</span><span class="n">hlistOrderTail</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">head</span>, <span class="kt">tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderTail</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>Cette approche a de nombreux avantages. Alors que l&rsquo;approche initiale devait effectuer
une recherche d&rsquo;implicites pour chaque relation d&rsquo;ordre, l&rsquo;approche par <em>GADT</em> n&rsquo;a besoin
de faire cette recherche qu&rsquo;une seule fois!
Sachant que la r√©solution d&rsquo;implicites est une op√©ration gourmande, la r√©duire signifie des
temps de compilation plus courts.
Lire le code des fonctions <code>lex</code> et <code>revLex</code> est √©galement plus simple que comprendre
comment la r√©solution d&rsquo;implicites fonctionne pour les traits <code>Lex</code> et <code>RevLex</code>.
De plus, ce ne sont que des fonctions, vous pouvez y utiliser tout ce que vous pouvez
programmer afin de construire les instances de <code>Order[A]</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Pas si trivial, n&rsquo;est-ce pas? üòâ En fait, une grande part de la complexit√©
√† laquelle vous venez de faire face vient du triste fait que les techniques
de raisonnements sur les types et valeurs ne sont presque jamais enseign√©es dans
les cours de programmation.
Ce que vous trouvez simple maintenant (API Web, Streaming, Bases De Donn√©es, etc)
terrifierait probablement la/le jeune programmeuse¬∑eur que vous √©tiez √† votre
premier &ldquo;Hello World!&rdquo;.
Vous n&rsquo;avez probablement pas appris tout ce que vous savez en programmation en
trois heures, donc n&rsquo;attendez pas des techniques de raisonnement sur des programmes
d&rsquo;√™tres magiquement plus simples.</p>
<p>Cet atelier avait pour but de vous inspirer, d&rsquo;ouvrir votre esprit √† ce nouvel univers
de possibilit√©s. Si vous trouvez ces cas d&rsquo;utilisation int√©ressants, alors prenez le temps
de comprendre les techniques.</p>
<p>Amusez vous bien et prenez bien soin de vous ‚ù§Ô∏è</p>

  <footer class="footline">
    
  </footer>
</article>
        </div>
      </main>
    </div>
    <script src="../../js/clipboard/clipboard.min.js?1750073986" defer></script>
    <script src="../../js/perfect-scrollbar/perfect-scrollbar.min.js?1750073986" defer></script>
    <script>
      window.MathJax = Object.assign( window.MathJax || {}, {
        tex: {
          inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
          displayMath: [['\\[', '\\]'], ['$$', '$$']], 
        },
        options: {
          enableMenu: false 
        }
      }, JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="../../js/mathjax/tex-mml-chtml.js?1750073986"></script>
    <script src="../../js/theme.min.js?1750073986" defer></script>
  </body>
</html>
