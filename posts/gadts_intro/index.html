<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.136.3">
    <meta name="generator" content="Relearn 7.0.1+72a875f1db967152c77914cff4d53f8fcee0e619">
    <meta name="description" content="Introduction to catamorphisms on Algebraic Data Types">
    <meta name="author" content="chrilves">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Demystifying GADTs :: @chrilves&#39; Archives">
    <meta name="twitter:description" content="Introduction to catamorphisms on Algebraic Data Types">
  <meta name="twitter:site" content="@chrilves"/>
    <meta property="og:url" content="https://chrilves.github.io/posts/gadts_intro/index.html">
    <meta property="og:site_name" content="@chrilves&#39; Archives">
    <meta property="og:title" content="Demystifying GADTs :: @chrilves&#39; Archives">
    <meta property="og:description" content="Introduction to catamorphisms on Algebraic Data Types">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Posts">
    <meta property="article:published_time" content="2019-02-20T11:09:38+01:00">
    <meta property="article:modified_time" content="2019-02-20T11:09:38+01:00">
    <meta itemprop="name" content="Demystifying GADTs :: @chrilves&#39; Archives">
    <meta itemprop="description" content="Introduction to catamorphisms on Algebraic Data Types">
    <meta itemprop="datePublished" content="2019-02-20T11:09:38+01:00">
    <meta itemprop="dateModified" content="2019-02-20T11:09:38+01:00">
    <meta itemprop="wordCount" content="3196">
    <meta itemprop="keywords" content="GADT,Types,Object-Oriented Programming">
    <title>Demystifying GADTs :: @chrilves&#39; Archives</title>
    <link href="../../posts/gadts_intro/index.xml" rel="alternate" type="application/rss+xml" title="Demystifying GADTs :: @chrilves&#39; Archives">
    <link href="../../posts/gadts_intro/index.print.html" rel="alternate" type="text/html" title="Demystifying GADTs :: @chrilves&#39; Archives">
    <link href="../../css/fontawesome-all.min.css?1729693097" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css?1729693097" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css?1729693097" rel="stylesheet">
    <link href="../../css/auto-complete.css?1729693097" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css?1729693097" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css?1729693097" rel="stylesheet">
    <link href="../../css/fonts.css?1729693097" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css?1729693097" rel="stylesheet"></noscript>
    <link href="../../css/theme.css?1729693097" rel="stylesheet">
    <link href="../../css/theme-relearn-auto.css?1729693097" rel="stylesheet" id="R-variant-style">
    <link href="../../css/chroma-relearn-auto.css?1729693097" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../css/print.css?1729693097" rel="stylesheet" media="print">
    <script src="../../js/variant.js?1729693097"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/chrilves.github.io';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support html disableInlineCopyToClipboard" data-url="../../posts/gadts_intro/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#object-oriented-programming-101">Object-Oriented Programming 101</a></li>
        <li><a href="#functional-programming-101">Functional Programming 101</a></li>
        <li><a href="#summing-up">Summing up!</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../posts/index.html"><span itemprop="name">Posts</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Demystifying GADTs</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/chrilves/chrilves.github.io/edit/master/hugo/content/posts/gadts_intro.md" target="_self" title="Edit (CTRL&#43;ALT&#43;w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/gadts_intro/index.print.html" title="Print whole chapter (CTRL&#43;ALT&#43;p)"><i class="fa-fw fas fa-print"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/recursion_schemes_intro/index.html" title="Recursion Schemes: the high-school introduction (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/folds/index.html" title="Let&#39;s meet the charming fold family (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable posts" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="demystifying-gadts">Demystifying GADTs</h1>
    <p class="article-meta default"><em>Wed, Feb 20, 2019 - 3200 Words</em></p>

<p><strong>Generalized Algebraic Data Types (GADT)</strong> is certainly one of the most feared concept in programming nowadays. Very few mainstream languages support GADTs. The only ones i know which does are <a href="https://www.haskell.org/ghc" rel="external" target="_self">Haskell</a>, <a href="https://www.scala-lang.org" rel="external" target="_self">Scala</a>, <a href="https://ocaml.org/index.fr.html" rel="external" target="_self">OCaml</a> and <a href="https://haxe.org" rel="external" target="_self">Haxe</a>. The idea is actually very simple but often presented in complicated ways. In fact, if you&rsquo;re familiar to both basic <em>Object-Oriented-with-Generics</em> and basic <em>functional</em> programming, then you most probably are already familiar with GADTs without even knowing you are. But if GADTs are so simple, why so many people feel terrified by them? Well GADTs rely on two fundamental ideas, one of them is known by every <em>Object-Oriented-with-Generics</em> programmer while the other is known by every <em>functional</em> programmer. The problem is most people make the huge mistake of opposing them even though they are complementary. So before diving into GADTs, let me remind you of these elementary notions from <em>Object-Oriented</em> and <em>functional</em> programming.</p>
<h3 id="object-oriented-programming-101">Object-Oriented Programming 101</h3>
<p>Let&rsquo;s start by some plain old <a href="https://openjdk.java.net" rel="external" target="_self">Java</a> (the examples works in probably all Object-Oriented language which supports generics). We want to define an <em>abstract class</em> for sequences:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">class</span> <span class="nc">Sequence</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">length</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">abstract</span><span class="w"> </span><span class="kd">public</span><span class="w"> </span><span class="n">A</span><span class="w">   </span><span class="nf">getNthElement</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nth</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span></span></span></code></pre></div>
<p>In <em>Java</em> it would be better to define <code>Sequence&lt;A&gt;</code> as an interface but i want this example to be as simple as possible. Would you be surprised if told you a <code>String</code> is a sequence of characters ? ;) As i said, GADTs rely on very basic programming knowledge.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyString</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">String</span><span class="w"> </span><span class="n">str</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyString</span><span class="p">(</span><span class="n">String</span><span class="w"> </span><span class="n">s</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">str</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">s</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">length</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">str</span><span class="p">.</span><span class="na">length</span><span class="p">();</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Character</span><span class="w"> </span><span class="nf">getNthElement</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">str</span><span class="p">.</span><span class="na">charAt</span><span class="p">(</span><span class="n">nth</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span></span></span></code></pre></div>
<p>Likewise, <code>byte</code>s are sequences of 8 bits (we represent a bit by a <code>Boolean</code>):</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyByte</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="n">bte</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByte</span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">bte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">length</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">8</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Boolean</span><span class="w"> </span><span class="nf">getNthElement</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">nth</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">0</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">nth</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">7</span><span class="p">)</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">((</span><span class="n">bte</span><span class="w"> </span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">nth</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">1</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">1</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">java</span><span class="p">.</span><span class="na">lang</span><span class="p">.</span><span class="na">IndexOutOfBoundsException</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span></span></span></code></pre></div>
<p>Have you noticed how <code>MyByte</code> and <code>MyString</code> declares themselves being respectively a sequence of booleans (<code>Sequence&lt;Boolean&gt;</code>) and a sequence of characters (<code>Sequence&lt;Character&gt;</code>) but not sequences of <code>A</code> (<code>Sequence&lt;A&gt;</code>) for any type <code>A</code>? Let&rsquo;s try to make it work for any type <code>A</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyByte</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="kt">byte</span><span class="w"> </span><span class="n">bte</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyByte</span><span class="p">(</span><span class="kt">byte</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">bte</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">length</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">???</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">A</span><span class="w"> </span><span class="nf">getNthElement</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="o">???</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span></span></span></code></pre></div>
<p>How would you write the methods <code>length</code> and <code>getNthElement</code>? Do you really imagine what would be a <code>MyByte&lt;Graphics2D&gt;</code>? It just doesn&rsquo;t make any sense at all. You could argue that a string is also a sequence of <code>byte</code> and a byte a sequence of one byte. Indeed this relation is not unique, but it does not change the fact that it works for only a small selection of type <code>A</code> and not every one! We can go even deeper in <em>Object-Oriented Programming</em>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">final</span><span class="w"> </span><span class="kd">class</span> <span class="nc">MyArray</span><span class="o">&lt;</span><span class="n">A</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Number</span><span class="o">&gt;</span><span class="w"> </span><span class="kd">extends</span><span class="w"> </span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Number</span><span class="o">&gt;</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">private</span><span class="w"> </span><span class="n">A</span><span class="o">[]</span><span class="w"> </span><span class="n">array</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="nf">MyArray</span><span class="p">(</span><span class="n">A</span><span class="o">[]</span><span class="w"> </span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">this</span><span class="p">.</span><span class="na">array</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="nf">length</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">array</span><span class="p">.</span><span class="na">length</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="kd">public</span><span class="w"> </span><span class="n">Number</span><span class="w"> </span><span class="nf">getNthElement</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">nth</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">this</span><span class="p">.</span><span class="na">array</span><span class="o">[</span><span class="n">nth</span><span class="o">]</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span></span></span></code></pre></div>
<p>Note how the generics <code>A</code>, which is required to be a sub-class of <code>Number</code>, is present as argument of <code>MyArray</code> but not in <code>extends Sequence&lt;Number&gt;</code>. Now what do you think about this code? Do you think it can be wrong?</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-java" data-lang="java"><span class="line"><span class="cl"><span class="kd">public</span><span class="w"> </span><span class="kd">static</span><span class="w"> </span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">guess</span><span class="p">(</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">A</span><span class="o">&gt;</span><span class="w"> </span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">MyByte</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;I guess A is actually Boolean, let&#39;s check!&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(((</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Boolean</span><span class="o">&gt;</span><span class="p">)</span><span class="n">x</span><span class="p">).</span><span class="na">getNthElement</span><span class="p">(</span><span class="n">0</span><span class="p">).</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">MyString</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;I guess A is actually Character&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(((</span><span class="n">Sequence</span><span class="o">&lt;</span><span class="n">Character</span><span class="o">&gt;</span><span class="p">)</span><span class="n">x</span><span class="p">).</span><span class="na">getNthElement</span><span class="p">(</span><span class="n">0</span><span class="p">).</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="k">instanceof</span><span class="w"> </span><span class="n">MyArray</span><span class="o">&lt;?&gt;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;I guess A is a sub-class of Number but i can not guess which one&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(((</span><span class="n">Sequence</span><span class="o">&lt;?&gt;</span><span class="p">)</span><span class="w"> </span><span class="n">x</span><span class="p">).</span><span class="na">getNthElement</span><span class="p">(</span><span class="n">0</span><span class="p">).</span><span class="na">getClass</span><span class="p">().</span><span class="na">getName</span><span class="p">());</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="p">}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="k">else</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="s">&#34;I don&#39;t know what A is&#34;</span><span class="p">);</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="p">}</span></span></span></code></pre></div>
<ul>
<li>If <code>x</code> is an instance of <code>MyByte</code>, which is a sub-class of <code>Sequence&lt;Boolean&gt;</code>, then by trivial inheritance <code>x</code> is also an instance of <code>Sequence&lt;Boolean&gt;</code>. In this case <code>A</code> is forced to be <code>Boolean</code>.</li>
<li>If <code>x</code> is an instance of <code>MyString</code>, which is a sub-class of <code>Sequence&lt;Character&gt;</code>, then again by trivial inheritance <code>x</code> is also an instance of <code>Sequence&lt;Character&gt;</code> . In this case <code>A</code> has to be <code>Character</code>.</li>
<li>If <code>x</code> is an instance of <code>MyArray&lt;A&gt;</code> for some type <code>A</code>, which is a sub-class of <code>Sequence&lt;Number&gt;</code>, then once again by trivial inheritance <code>x</code> is an instance of <code>Sequence&lt;Number&gt;</code>. In this case we know <code>A</code> is a sub-class of <code>Number</code> but we don&rsquo;t know which one.</li>
</ul>
<p>This is the essence of <em>Generalized Algebraic Data Types</em>. It you understand the code above, then you understand how <em>GADTs</em> work. As you see this is very basic <em>Oriented-Object with Generics</em>. You can find lots of examples of this kind in almost every Java/C#/etc project (search for the <code>instanceof</code> keyword).</p>
<h3 id="functional-programming-101">Functional Programming 101</h3>
<p>Functional languages often support a feature called <strong>Algebraic Data Types (ADT)</strong> which is essentially enumerations on steroids. Like enumerations this is a disjoint union of a fixed number of cases but unlike enumerations, where each case is a constant, ADTs cases can have parameters. As an example, the type of lists whose elements are of type <code>a</code>, written <code>List a</code> in <em>Haskell</em>, is defined:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">=</span> <span class="kt">Nil</span> <span class="o">|</span> <span class="kt">Cons</span> <span class="n">a</span> <span class="p">(</span><span class="kt">List</span> <span class="n">a</span><span class="p">)</span></span></span></code></pre></div>
<p>It means any value of type <code>List a</code> belong to <strong>exactly</strong> one of the following cases:</p>
<ul>
<li>either the value is the constant <code>Nil</code> which represents the empty list.</li>
<li>or the value is <code>Cons hd tl</code> which represent the list whose first element is <code>hd</code> (of type <code>a</code>) and whose tail is <code>tl</code> (of type <code>List a</code>).</li>
</ul>
<p>The list <code>[1,2,3,4]</code> is encoded by <code>Cons 1 (Cons 2 (Cons 3 (Cons 4 Nil)))</code>. Where <em>ADTs</em> really shine is pattern-matching which is a very powerful and flexible <code>switch</code> (as i said above, <em>ADTs</em> are enumerations on steroids). <em>ADTs</em> being made of a fixed number of distinct cases, pattern-matching enable to inspect values and perform computations based on a case by case analysis of the form of the value. Here is how to implement the merge sort algorithm on this type:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="nf">split</span> <span class="ow">::</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">List</span> <span class="n">a</span><span class="p">,</span> <span class="kt">List</span> <span class="n">a</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="nf">split</span> <span class="n">l</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> <span class="n">l</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Cons</span> <span class="n">x</span> <span class="p">(</span><span class="kt">Cons</span> <span class="n">y</span> <span class="n">tl</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kr">case</span> <span class="n">split</span> <span class="n">tl</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">                              <span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Cons</span> <span class="n">x</span> <span class="n">l1</span><span class="p">,</span> <span class="kt">Cons</span> <span class="n">y</span> <span class="n">l2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                          <span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Cons</span> <span class="kr">_</span> <span class="kt">Nil</span>         <span class="ow">-&gt;</span> <span class="p">(</span><span class="n">l</span>  <span class="p">,</span> <span class="kt">Nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Nil</span>                <span class="ow">-&gt;</span> <span class="p">(</span><span class="kt">Nil</span><span class="p">,</span> <span class="kt">Nil</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">merge</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">merge</span> <span class="n">isLessThan</span> <span class="n">l1</span> <span class="n">l2</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> <span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kr">_</span>           <span class="p">,</span> <span class="kt">Nil</span>         <span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l1</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">Nil</span>         <span class="p">,</span> <span class="kr">_</span>           <span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">l2</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kt">Cons</span> <span class="n">hd1</span> <span class="n">tl1</span><span class="p">,</span> <span class="kt">Cons</span> <span class="n">hd2</span> <span class="kr">_</span>  <span class="p">)</span> <span class="o">|</span> <span class="n">hd1</span> <span class="p">`</span><span class="n">isLessThan</span><span class="p">`</span> <span class="n">hd2</span> <span class="ow">-&gt;</span>  <span class="kt">Cons</span> <span class="n">hd1</span> <span class="p">(</span><span class="n">merge</span> <span class="n">isLessThan</span> <span class="n">tl1</span> <span class="n">l2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">(</span><span class="kr">_</span>           <span class="p">,</span> <span class="kt">Cons</span> <span class="n">hd2</span> <span class="n">tl2</span><span class="p">)</span>                        <span class="ow">-&gt;</span>  <span class="kt">Cons</span> <span class="n">hd2</span> <span class="p">(</span><span class="n">merge</span> <span class="n">isLessThan</span> <span class="n">l1</span> <span class="n">tl2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nf">sort</span> <span class="ow">::</span> <span class="p">(</span><span class="n">a</span> <span class="ow">-&gt;</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Bool</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl"><span class="nf">sort</span> <span class="n">isLessThan</span> <span class="n">l</span> <span class="ow">=</span>
</span></span><span class="line"><span class="cl">  <span class="kr">case</span> <span class="n">l</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Nil</span>        <span class="ow">-&gt;</span> <span class="kt">Nil</span>
</span></span><span class="line"><span class="cl">    <span class="kt">Cons</span> <span class="kr">_</span> <span class="kt">Nil</span> <span class="ow">-&gt;</span> <span class="n">l</span>
</span></span><span class="line"><span class="cl">    <span class="kr">_</span>          <span class="ow">-&gt;</span> <span class="kr">case</span> <span class="n">split</span> <span class="n">l</span> <span class="kr">of</span>
</span></span><span class="line"><span class="cl">                    <span class="p">(</span><span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">)</span> <span class="ow">-&gt;</span> <span class="n">merge</span> <span class="n">isLessThan</span> <span class="p">(</span><span class="n">sort</span> <span class="n">isLessThan</span> <span class="n">l1</span><span class="p">)</span> <span class="p">(</span><span class="n">sort</span> <span class="n">isLessThan</span> <span class="n">l2</span><span class="p">)</span></span></span></code></pre></div>
<p>I know there are smarter ways to write it in <em>Haskell</em> but this article is not about it. The code above could be translated trivially in <code>OCaml</code> by replacing <code>case ... of</code> by <code>match ... with</code>, in <em>Scala</em> by <code>... match { ... }</code>, etc. This style is valid is probably all languages supporting pattern-matching so it fits our goal.</p>
<p>The <code>case l of</code> expressions are pattern-matching. They are a sequence of <code>pattern | condition -&gt; code</code>. The code being executed is the right-hand side of the first case for which the value <code>l</code> is of the form of its pattern and satisfy the condition. <code>l</code> is then said to match this case. For example, the case <code>Cons x (Cons y tl) -&gt; (case split tl of (l1, l2) -&gt; (Cons x l1, Cons y l2))</code> states that if <code>l</code> is of the form <code>Cons x (Cons y tl)</code>, which means that there are three values <code>x</code>, <code>y</code> and <code>tl</code> such that <code>l == Cons x (Cons y tl)</code>, then the code executed is <code>(case split tl of (l1, l2) -&gt; (Cons x l1, Cons y l2))</code>. One very important condition is that <strong>pattern-matching must be exhaustive</strong>! It means that the sequence of cases must cover all possible value of <code>l</code>.</p>
<p>If your understand the previous section, the type <code>List a</code> and how pattern-matching works in the example above, then i am very glad to inform you that you already understand GADTs! Well done :)</p>
<h3 id="summing-up">Summing up!</h3>
<p>In this section i assume previous sections are ok for you. If you do not understand previous examples, don&rsquo;t go further but go back to the basics of <em>generics</em> and <em>pattern-matching</em>. Likewise, if you find what follows complicated, go back to the basics <em>generics</em> and <em>pattern-matching</em>. There is no shame in doing so! Difficulties in understanding advanced notion is often the reflect of a lack of understanding in the ones they rely upon. As i said, there is no shame in it, if you think programming paradigms are &ldquo;simple&rdquo; then write a compiler ;)</p>
<p>It&rsquo;s about time to sum up everything. First, note that <code>List a</code> is not one single type. Each type <code>a</code> actually gives rise to a distinct type <code>List a</code>. For example <code>List Int</code>, <code>List String</code>, <code>List (List Bool)</code>, etc are all distinct types. Indeed the list <code>Cons 1 Nil</code> is neither a list of strings nor of booleans! For each type <code>a</code>, the type <code>List a</code> have two constructors: the constant <code>Nil</code> and the function <code>Cons :: a -&gt; List a -&gt; List a</code> which builds a <code>List a</code> from a value of type <code>a</code> and other <code>List a</code>.</p>
<p>There is another equivalent way to define <code>List a</code> in <em>Haskell</em> which makes the nature of the constructor more apparent:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">List</span> <span class="n">a</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="kt">Nil</span>  <span class="ow">::</span> <span class="kt">List</span> <span class="n">a</span>
</span></span><span class="line"><span class="cl">  <span class="kt">Cons</span> <span class="ow">::</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">List</span> <span class="n">a</span></span></span></code></pre></div>
<p>Indeed, for each type <code>a</code>, <code>Nil</code> is constant of type <code>List a</code> while <code>Cons</code> is a function of type <code>a -&gt; List a -&gt; List a</code>. Note that it is actually very close to the way to define it in <em>Scala</em>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Nil</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Cons</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">head</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">tail</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">List</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
<p>Do you remember the example of the first section <code>Sequence&lt;A&gt;</code>? There was three sub-classes of <code>Sequence&lt;A</code>: <code>MyString</code> which is actually a sub-class of <code>Sequence&lt;Character&gt;</code>, <code>MyByte</code> which is a sub-class of <code>Sequence&lt;Boolean&gt;</code> and <code>MyArray&lt;A extends Number&gt;</code> which is a sub-class of <code>Sequence&lt;Number&gt;</code>. What is the type of their constructors? Some admissible type for them is (in <em>Scala</em> notation):</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="nc">MyString</span>             <span class="k">:</span> <span class="kt">String</span>   <span class="o">=&gt;</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">Character</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nc">MyByte</span>               <span class="k">:</span> <span class="kt">Byte</span>     <span class="o">=&gt;</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nc">MyArray</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">Number</span><span class="o">]</span> <span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">Number</span><span class="o">]</span></span></span></code></pre></div>
<p>From this, this is trivial to write:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MyString</span><span class="o">(</span><span class="n">str</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span>                 <span class="k">extends</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">Character</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MyByte</span><span class="o">(</span><span class="n">bte</span><span class="k">:</span> <span class="kt">Byte</span><span class="o">)</span>                     <span class="k">extends</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MyArray</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">Number</span><span class="o">](</span><span class="n">array</span><span class="k">:</span> <span class="kt">Array</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Sequence</span><span class="o">[</span><span class="kt">Number</span><span class="o">]</span></span></span></code></pre></div>
<p>or in <em>Haskell</em>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-haskell" data-lang="haskell"><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Number</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="kt">MkNum</span> <span class="ow">::</span> <span class="n">forall</span> <span class="n">a</span><span class="o">.</span> <span class="kt">Num</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">Number</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kr">data</span> <span class="kt">Sequence</span> <span class="n">a</span> <span class="kr">where</span>
</span></span><span class="line"><span class="cl">  <span class="kt">MyString</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">Sequence</span> <span class="kt">Char</span>
</span></span><span class="line"><span class="cl">  <span class="kt">MyByte</span>   <span class="ow">::</span> <span class="kt">Word8</span>  <span class="ow">-&gt;</span> <span class="kt">Sequence</span> <span class="kt">Bool</span>
</span></span><span class="line"><span class="cl">  <span class="kt">MyArray</span>  <span class="ow">::</span> <span class="n">forall</span> <span class="n">a</span><span class="o">.</span> <span class="kt">Num</span> <span class="n">a</span> <span class="ow">=&gt;</span> <span class="kt">List</span> <span class="n">a</span> <span class="ow">-&gt;</span> <span class="kt">Sequence</span> <span class="kt">Number</span></span></span></code></pre></div>
<p><code>Sequence</code> is a <em>GADT</em>. What makes it different from <code>List</code> above? For <strong>any type <code>a</code></strong>, values of type <code>List a</code> are build using the two constructors <code>Nil</code> and <code>Cons</code>. Note that it does not depend on what <code>a</code> is. Values of type <code>List Int</code> are build using the exact same constructors than <code>List Bool</code>, <code>List String</code>, <code>List (List Char)</code>, etc. <code>Sequence</code> have three constructors <code>MyString</code>, <code>MyByte</code> and <code>MyArray</code>. But values of type <code>Sequence[Character]</code> can only be built by the constructor <code>MyString</code> while values of type <code>Sequence[Boolean]</code> can only be built by the constructor <code>MyByte</code> and values of type <code>Sequence[Number]</code> can only be built by the constructor <code>MyArray</code>. What about values of type <code>Sequence[Unit]</code> or <code>Sequence[String]</code>, etc? There is simply no constructor to build values of these types, so <em>there is no values of these types</em>!</p>
<p>We can rewrite the methods on <code>Sequence</code> and the <code>guess</code> function to use patten-matching:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">length</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">Sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyByte</span><span class="o">(</span><span class="k">_</span><span class="o">)</span>     <span class="k">=&gt;</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyString</span><span class="o">(</span><span class="n">str</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">str</span><span class="o">.</span><span class="n">length</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyArray</span><span class="o">(</span><span class="n">arr</span><span class="o">)</span>  <span class="k">=&gt;</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">getNthElement</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">Sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">nth</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyByte</span><span class="o">(</span><span class="n">bte</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// So A is actually Boolean
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">if</span> <span class="o">(</span><span class="n">nth</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">nth</span> <span class="o">&lt;=</span> <span class="mi">7</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="o">(</span><span class="n">bte</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">nth</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="o">)</span> <span class="o">==</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="k">else</span>
</span></span><span class="line"><span class="cl">        <span class="k">throw</span> <span class="k">new</span> <span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">IndexOutOfBoundsException</span><span class="o">(</span><span class="s">&#34;&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyString</span><span class="o">(</span><span class="n">str</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// So A is actually Character
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">str</span><span class="o">.</span><span class="n">charAt</span><span class="o">(</span><span class="n">nth</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyArray</span><span class="o">(</span><span class="n">array</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// So A is actually a sub-class of Number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">array</span><span class="o">(</span><span class="n">nth</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">guess</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span> <span class="k">:</span> <span class="kt">Sequence</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyByte</span><span class="o">(</span><span class="n">bte</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">&#34;I guess A is actually Boolean, let&#39;s check!&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">getNthElement</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="n">getClass</span><span class="o">.</span><span class="n">getName</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyString</span><span class="o">(</span><span class="n">str</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">&#34;I guess A is actually Character&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">getNthElement</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="n">getClass</span><span class="o">.</span><span class="n">getName</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">MyArray</span><span class="o">(</span><span class="n">array</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">&#34;I guess A is a sub-class of Number but i can not guess which one&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">getNthElement</span><span class="o">(</span><span class="n">x</span><span class="o">,</span> <span class="mi">0</span><span class="o">).</span><span class="n">getClass</span><span class="o">.</span><span class="n">getName</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>As you can see <code>getNthElement</code> must returns a value of type <code>A</code> but the case <code>MyByte</code> returns a <code>Boolean</code>. It means <em>Scala</em> is aware that in this case <code>A</code> is actually <em>Boolean</em>. Likewise in the case <code>MyString</code>, <em>Scala</em> knowns that the only possible concrete type for <code>A</code> is <code>Character</code> so it accepts we return one. <em>Scala</em> is (most of the time) able to guess, depending on the case, what are the constraints on <code>A</code>. This is all the magic behind GADTs: specialized constructors like in <em>object-oriented-with-generics</em> programming and closed types (i.e. with a fixed number of cases) on which we can pattern-match like in usual <em>functional</em> programming.</p>
<p>How are <em>GADTs</em> useful? First of all, there are handy when you have a specialized constructor like in every day life <em>object-oriented</em> programming. It makes sense for a byte (resp. string) to be sequence of booleans (resp. characters) but not a sequence of anything. A prolific use of this is writing implicits in Scala as <em>GADTs</em>. This way we can pattern-match on the structure of the implicits to derive instances (see <a href="https://gist.github.com/chrilves/c3db91813cfe693fa708a34f7a27795f" rel="external" target="_self">this gist</a> for more details). They are also very useful to encode properties on types. As i said above, not all types <code>Sequence[A]</code> have (non-null) values! There is no (non-null) value of type <code>Sequence[Unit]</code> or <code>Sequence[String]</code> etc but there are values of type <code>Sequence[Boolean]</code>, <code>Sequence[Character]</code> and <code>Sequence[Number]</code>. So if i give you a value of type <code>Sequence[A]</code>, then you know <code>A</code> is either <code>Boolean</code>, <code>Character</code> or <code>Number</code>. If you don&rsquo;t believe me, try to call the function <code>guess</code> on a type <code>A</code> which is neither <code>Boolean</code> nor <code>Character</code> nor <code>Number</code> (without using <code>null</code>)! Let me give you some useful examples.</p>
<p>The first one is restricting a generic type like in the code below. The <em>GADT</em> <code>IsIntOrString</code> forces <code>A</code> to be either <code>String</code> or <code>Int</code> in the function and the case class.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">IsIntOrString</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">implicit</span> <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">IsInt</span>    <span class="k">extends</span> <span class="nc">IsIntOrString</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">IsString</span> <span class="k">extends</span> <span class="nc">IsIntOrString</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">canOnlyBeCalledOnIntOrString</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">a</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">IsIntOrString</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">ev</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">IsInt</span> <span class="k">=&gt;</span> <span class="c1">// A is Int
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">a</span> <span class="o">+</span> <span class="mi">7</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">IsString</span> <span class="k">=&gt;</span> <span class="c1">// A is String
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="n">a</span><span class="o">.</span><span class="n">reverse</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">AStringOrAnIntButNothingElse</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="k">implicit</span> <span class="k">val</span> <span class="n">proof</span> <span class="k">:</span> <span class="kt">IsIntOrString</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span></span></span></code></pre></div>
<p>Another handy use is encoding effects:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">UserId</span>
</span></span><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">User</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">BusinessEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">GetUser</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">UserId</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">BusinessEffect</span><span class="o">[</span><span class="kt">User</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SetUser</span><span class="o">(</span><span class="n">user</span><span class="k">:</span> <span class="kt">User</span><span class="o">)</span>     <span class="k">extends</span> <span class="nc">BusinessEffect</span><span class="o">[</span><span class="kt">UserId</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DelUser</span><span class="o">(</span><span class="n">userId</span><span class="k">:</span> <span class="kt">UserId</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">BusinessEffect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span></span></span></code></pre></div>
<p>Have you ever heard that <code>Set</code> is not a functor? With the usual definition of a functor, indeed <code>Set</code> is not one.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>The reason is you can only have a <code>Set[A]</code> for types <code>A</code> such that you can compare values. As an example let <code>A</code> be <code>Int =&gt; Int</code>. The two following functions are arguably equal:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">doubleByMult</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">doubleByPlus</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=&gt;</span> <span class="nc">Int</span> <span class="k">=</span> <span class="o">(</span><span class="n">x</span><span class="k">:</span> <span class="kt">Int</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">x</span> <span class="o">+</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Set</span><span class="o">(</span><span class="n">doubleByMult</span><span class="o">).</span><span class="n">contains</span><span class="o">(</span><span class="n">doubleByPlus</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">false</span></span></span></code></pre></div>
<p>This is just impossible, in the general case, to know if two functions compute the same thing. I didn&rsquo;t just say we don&rsquo;t know how to do it. It is actually proven that this is impossible (like no one can, and no one could for ever!). Have a look at this <a href="https://en.wikipedia.org/wiki/List_of_undecidable_problems" rel="external" target="_self">List of undecidable problems</a> for more information on the subject. Using extensional equality (the one where <code>f == g</code> <em>if and only</em> <code>f(x) == g(x)</code> for all <code>x</code>), there is just no implementation of <code>Set[Int =&gt; Int]</code>. But if <code>Set</code> was a functor, it would be trivial using <code>map</code> to get a <code>Set[Int =&gt; Int]</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="nc">Set</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">](</span><span class="kc">true</span><span class="o">,</span> <span class="kc">false</span><span class="o">).</span><span class="n">map</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="kc">true</span>  <span class="k">=&gt;</span> <span class="n">doubleByMult</span>
</span></span><span class="line"><span class="cl">  <span class="k">case</span> <span class="kc">false</span> <span class="k">=&gt;</span> <span class="n">doubleByPlus</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">Int</span> <span class="k">=&gt;</span> <span class="kt">Int</span><span class="o">]</span></span></span></code></pre></div>
<p>The conclusion is that <code>Set</code> is not a functor &hellip; in the usual (i.e. <em>Scal</em>) category. But it is in for some categories. The problem with <code>Functor</code> is <code>map</code> can be applied on any <code>A</code> and <code>B</code> which is impossible for <code>Set</code>. But if we restrict <code>A</code> and <code>B</code> such that they have interesting properties (like having an <code>Ordering</code>), then it works. In the code below, the <em>GADT</em> <code>predicate</code> is used to restrict on which <code>A</code> and <code>B</code> <code>map</code> can be applied on:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">predicate</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">proofA</span><span class="k">:</span> <span class="kt">predicate</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">proofB</span><span class="k">:</span> <span class="kt">predicate</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Then <code>Set</code> is becomes a functor with <code>Ordering</code> as <code>predicate</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">SetInstance</span> <span class="k">extends</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">Ordering</span>, <span class="kt">Set</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">orderingA</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">orderingB</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Set</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>  <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">set</span> <span class="k">=</span> <span class="nc">TreeSet</span><span class="o">.</span><span class="n">newBuilder</span><span class="o">(</span><span class="n">orderingB</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="o">(</span><span class="n">a</span> <span class="k">&lt;-</span> <span class="n">fa</span><span class="o">)</span> <span class="n">set</span> <span class="o">+=</span> <span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">set</span><span class="o">.</span><span class="n">result</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Surprisingly even <code>String</code> can be a functor (with <code>A</code> and <code>B</code> being both <code>Char</code>)!!!</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">IsItChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">implicit</span> <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">YesItIsChar</span> <span class="k">extends</span> <span class="nc">IsItChar</span><span class="o">[</span><span class="kt">Char</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">type</span> <span class="kt">StringK</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">String</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">StringInstance</span> <span class="k">extends</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">IsItChar</span>, <span class="kt">StringK</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">String</span><span class="o">)(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">proofA</span><span class="k">:</span> <span class="kt">IsItChar</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">proofB</span><span class="k">:</span> <span class="kt">IsItChar</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="o">(</span><span class="n">proofA</span><span class="o">,</span> <span class="n">proofB</span><span class="o">)</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="o">(</span><span class="nc">YesItIsChar</span><span class="o">,</span> <span class="nc">YesItIsChar</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="c1">// A and B are both Char!
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">fa</span><span class="o">.</span><span class="n">toList</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">f</span><span class="o">).</span><span class="n">mkString</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p><em>GADTs</em> are an example of <em>Bushnell&rsquo;s law</em>. As you can see, they are easy to learn but can be used in very tricky situations which makes them hard to master. They are clearly very helpful in many situations but it seems they are still unfortunately very little used. <em>Haskell</em> supports them very well! <em>Scala</em>&rsquo;s support is actually very good but not as good as <em>Haskell</em>&rsquo;s. <em>Scala 3</em> will probably support them as well as <em>Haskell</em> since <em>Dotty</em>&rsquo;s support is excellent. The only two other mainstream languages i know supporting them are <em>OCaml</em> and <em>Haxe</em>. Even if those two have a very good support, their lack of <em>Higer-Kinded types</em> forbids the most interesting uses.</p>
<p>As you probably know, it is possible to define a <code>fold</code> functor for every <em>Algebraic Data Type</em>. It is also possible to define <code>fold</code> functions for every <em>GADT</em>. As an exercise, try to define fold functions for the following <em>GADTs</em>:</p>
<ul>
<li>
<p>This <em>GADT</em> encode the equality between two types <code>A</code> and <code>B</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Eq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Refl</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">Eq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
</li>
<li>
<p>This <em>GADT</em> represent an unknown type for which we have an instance of a type-class:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">Ex</span><span class="o">[</span><span class="kt">TypeClass</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MakeEx</span><span class="o">[</span><span class="kt">TypeClass</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span><span class="kt">A</span><span class="o">,</span> <span class="n">instance</span><span class="k">:</span> <span class="kt">TypeClass</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Ex</span><span class="o">[</span><span class="kt">TypeClass</span><span class="o">]</span></span></span></code></pre></div>
</li>
</ul>
<p>You&rsquo;ll find how to define such <code>fold</code> functions <a href="https://chrilves.github.io/posts/folds/" rel="external" target="_self">here</a>. Have fun and spread the love of <em>GADTs</em> everywhere :)</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation showVisitedLinks">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
<a id="logo" href="../../">
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="65mm"
   height="7mm"
   viewBox="0 0 96.990127 7.7258329"
   version="1.1"
   id="svg8"
   sodipodi:docname="logo.svg"
   inkscape:version="0.92.3 (2405546, 2018-03-11)">
  <defs
     id="defs2" />
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="2.8"
     inkscape:cx="193.2115"
     inkscape:cy="-34.320002"
     inkscape:document-units="mm"
     inkscape:current-layer="layer1"
     showgrid="false"
     fit-margin-top="0"
     fit-margin-left="0"
     fit-margin-right="0"
     fit-margin-bottom="0"
     inkscape:window-width="1920"
     inkscape:window-height="1026"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Calque 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-8.9716412,-5.0276302)">
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332"
       x="8.3895578"
       y="12.61588"
       id="text4543"><tspan
         sodipodi:role="line"
         id="tspan4541"
         x="8.3895578"
         y="12.61588"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'TeX Gyre Bonum';-inkscape-font-specification:'TeX Gyre Bonum';stroke-width:0.26458332;fill:#ffffff">@chrilves' Archives</tspan></text>
  </g>
</svg>
</a>
        </div>
        <script>
          window.index_js_url="../../searchindex.js?1729693097";
        </script>
        <search><form action="../../search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
        <script>
          var contentLangs=['en'];
        </script>
        <script src="../../js/auto-complete.js?1729693097" defer></script>
        <script src="../../js/lunr/lunr.min.js?1729693097" defer></script>
        <script src="../../js/lunr/lunr.stemmer.support.min.js?1729693097" defer></script>
        <script src="../../js/lunr/lunr.multi.min.js?1729693097" defer></script>
        <script src="../../js/lunr/lunr.en.min.js?1729693097" defer></script>
        <script src="../../js/search.js?1729693097" defer></script>
      </div>
      <div id="R-homelinks" class="default-animation">
        <hr class="padding">
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div id="R-topics">
          <ul class="enlarge morespace collapsible-menu">
            <li class="parent " data-nav-id="/posts/index.html"><input type="checkbox" id="R-section-6c8465a20210a85121ce7f08ddd74896" aria-controls="R-subsections-6c8465a20210a85121ce7f08ddd74896" checked><label for="R-section-6c8465a20210a85121ce7f08ddd74896"><i class="fa-fw fas fa-chevron-down"></i><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Posts</span></label><a class="padding" href="../../posts/index.html">Posts<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-6c8465a20210a85121ce7f08ddd74896" class="collapsible-menu">
            <li class="" data-nav-id="/posts/probability_in_scala_3_all_sides/index.html"><a class="padding" href="../../posts/probability_in_scala_3_all_sides/index.html">Playing with Probability in Scala 3<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/les_gadts_par_l_exemple/index.html"><a class="padding" href="../../posts/les_gadts_par_l_exemple/index.html">Les GADTs Par l&#39;Exemple<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/gadts_by_use_cases/index.html"><a class="padding" href="../../posts/gadts_by_use_cases/index.html">GADTs By Use Cases<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/prime/index.html"><a class="padding" href="../../posts/prime/index.html">Proving Primality with GADTs<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/recursion_schemes_intro/index.html"><a class="padding" href="../../posts/recursion_schemes_intro/index.html">Recursion Schemes: the high-school introduction<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="active " data-nav-id="/posts/gadts_intro/index.html"><a class="padding" href="../../posts/gadts_intro/index.html">Demystifying GADTs<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/folds/index.html"><a class="padding" href="../../posts/folds/index.html">Let&#39;s meet the charming fold family<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/slimetrail/index.html"><a class="padding" href="../../posts/slimetrail/index.html">How to make game in the browser thanks to ScalaJS<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/json2xml/index.html"><a class="padding" href="../../posts/json2xml/index.html">JSON to XML: the probably a tiny bit over engineered way<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/posts/falgebra_scalaio_2017/index.html"><a class="padding" href="../../posts/falgebra_scalaio_2017/index.html">F-Algebra talk at ScalaIO 2017: ModÃ©liser astucieusement vos donnÃ©es<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li>
            <li class="" data-nav-id="/types/index.html"><input type="checkbox" id="R-section-49e20b5298b1a94e847e064ae86775fe" aria-controls="R-subsections-49e20b5298b1a94e847e064ae86775fe"><label for="R-section-49e20b5298b1a94e847e064ae86775fe"><i class="fa-fw fas fa-chevron-down"></i><i class="fa-fw fas fa-chevron-right"></i><span class="a11y-only">Submenu Introduction to Types</span></label><a class="padding" href="../../types/index.html">Introduction to Types<i class="fa-fw fas fa-check read-icon"></i></a><ul id="R-subsections-49e20b5298b1a94e847e064ae86775fe" class="collapsible-menu">
            <li class="" data-nav-id="/types/1-why/index.html"><a class="padding" href="../../types/1-why/index.html">Episode 1 - Why Types?<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/types/2-enums/index.html"><a class="padding" href="../../types/2-enums/index.html">Episode 2 - Enumerations<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/types/3-products/index.html"><a class="padding" href="../../types/3-products/index.html">Episode 3 - Products<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/types/4-coproducts/index.html"><a class="padding" href="../../types/4-coproducts/index.html">Episode 4 - CoProducts<i class="fa-fw fas fa-check read-icon"></i></a></li>
            <li class="" data-nav-id="/types/5-rectypes/index.html"><a class="padding" href="../../types/5-rectypes/index.html">Episode 5 - Recursive Data Types<i class="fa-fw fas fa-check read-icon"></i></a></li></ul></li>
          </ul>
        </div>
        <div id="R-shortcuts">
          <div class="nav-title padding">More</div>
          <ul class="space">
            <li><a class="padding" href="https://github.com/chrilves"><i class="fa-fw fab fa-github"></i> GitHub Repo</a></li>
            <li><a class="padding" href="https://www.linkedin.com/in/christophe-calv%C3%A8s-ab6325b0/"><i class='fab fa-fw fa-linkedin'></i> LinkedIn</a></li>
            <li><a class="padding" href="https://twitter.com/chrilves"><i class='fab fa-fw fa-twitter'></i> Twitter</a></li>
          </ul>
        </div>
        <div class="padding footermargin footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVariantSwitch showVisitedLinks showFooter"></div>
        <div id="R-menu-footer">
          <hr class="padding default-animation footerLangSwitch footerVariantSwitch footerVisitedLinks footerFooter showLangSwitch showVariantSwitch showVisitedLinks showFooter">
          <div id="R-prefooter" class="footerLangSwitch footerVariantSwitch footerVisitedLinks showLangSwitch showVariantSwitch showVisitedLinks">
            <ul>
              <li id="R-select-language-container" class="footerLangSwitch showLangSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-language"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-language">Language</label>
                    <select id="R-select-language" onchange="location = this.querySelector( this.value ).dataset.url;">
                      <option id="R-select-language-en" value="#R-select-language-en" data-url="../../posts/gadts_intro/index.html" lang="en" selected>English</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
              <li id="R-select-variant-container" class="footerVariantSwitch showVariantSwitch">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-paint-brush"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <label class="a11y-only" for="R-select-variant">Theme</label>
                    <select id="R-select-variant" onchange="window.variants && variants.changeVariant( this.value );">
                      <option id="R-select-variant-relearn-auto" value="relearn-auto" selected>Relearn Light/Dark</option>
                      <option id="R-select-variant-relearn-light" value="relearn-light">Relearn Light</option>
                      <option id="R-select-variant-relearn-dark" value="relearn-dark">Relearn Dark</option>
                      <option id="R-select-variant-relearn-bright" value="relearn-bright">Relearn Bright</option>
                      <option id="R-select-variant-zen-auto" value="zen-auto">Zen Light/Dark</option>
                      <option id="R-select-variant-zen-light" value="zen-light">Zen Light</option>
                      <option id="R-select-variant-zen-dark" value="zen-dark">Zen Dark</option>
                      <option id="R-select-variant-retro-auto" value="retro-auto">Retro Learn/Neon</option>
                      <option id="R-select-variant-neon" value="neon">Neon</option>
                      <option id="R-select-variant-learn" value="learn">Learn</option>
                      <option id="R-select-variant-blue" value="blue">Blue</option>
                      <option id="R-select-variant-green" value="green">Green</option>
                      <option id="R-select-variant-red" value="red">Red</option>
                    </select>
                  </div>
                  <div class="clear"></div>
                </div>
                <script>window.variants && variants.markSelectedVariant();</script>
              </li>
              <li class="footerVisitedLinks showVisitedLinks">
                <div class="padding menu-control">
                  <i class="fa-fw fas fa-history"></i>
                  <span>&nbsp;</span>
                  <div class="control-style">
                    <button onclick="clearHistory();">Clear History</button>
                  </div>
                  <div class="clear"></div>
                </div>
              </li>
            </ul>
          </div>
          <div id="R-footer" class="footerFooter showFooter">
        <p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p>
          </div>
        </div>
      </div>
    </aside>
    <script src="../../js/clipboard.min.js?1729693097" defer></script>
    <script src="../../js/perfect-scrollbar.min.js?1729693097" defer></script>
    <script>
      function useMathJax( config ){
        window.MathJax = Object.assign( window.MathJax || {}, {
          tex: {
            inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
            displayMath: [['\\[', '\\]'], ['$$', '$$']], 
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="../../js/mathjax/tex-mml-chtml.js?1729693097"></script>
    <script src="../../js/theme.js?1729693097" defer></script>
  </body>
</html>
