<!DOCTYPE html>
<html lang="en" dir="ltr" itemscope itemtype="http://schema.org/Article">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.136.3">
    <meta name="generator" content="Relearn 7.1.1">
    <meta name="description" content="Discover Generalized ADT through lots of practical examples.">
    <meta name="author" content="chrilves">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="GADTs By Use Cases :: @chrilves&#39; Archives">
    <meta name="twitter:description" content="Discover Generalized ADT through lots of practical examples.">
  <meta name="twitter:site" content="@chrilves"/>
    <meta property="og:url" content="https://chrilves.github.io/posts/gadts_by_use_cases/index.html">
    <meta property="og:site_name" content="@chrilves&#39; Archives">
    <meta property="og:title" content="GADTs By Use Cases :: @chrilves&#39; Archives">
    <meta property="og:description" content="Discover Generalized ADT through lots of practical examples.">
    <meta property="og:locale" content="en">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Posts">
    <meta property="article:published_time" content="2019-10-26T05:00:00+02:00">
    <meta property="article:modified_time" content="2019-10-26T05:00:00+02:00">
    <meta itemprop="name" content="GADTs By Use Cases :: @chrilves&#39; Archives">
    <meta itemprop="description" content="Discover Generalized ADT through lots of practical examples.">
    <meta itemprop="datePublished" content="2019-10-26T05:00:00+02:00">
    <meta itemprop="dateModified" content="2019-10-26T05:00:00+02:00">
    <meta itemprop="wordCount" content="7313">
    <meta itemprop="keywords" content="GADT,GADTs,Generalized Algebraic Data Types,ADT,Algebraic Data Types,Functional Programming,Interface,Free Monad,ScalaIO">
    <title>GADTs By Use Cases :: @chrilves&#39; Archives</title>
    <link href="https://chrilves.github.io/posts/gadts_by_use_cases/index.html" rel="canonical" type="text/html" title="GADTs By Use Cases :: @chrilves&#39; Archives">
    <link href="../../posts/gadts_by_use_cases/index.xml" rel="alternate" type="application/rss+xml" title="GADTs By Use Cases :: @chrilves&#39; Archives">
    <link href="../../css/fontawesome-all.min.css?1731043964" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css?1731043964" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css?1731043964" rel="stylesheet">
    <link href="../../css/auto-complete.css?1731043964" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css?1731043964" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css?1731043964" rel="stylesheet">
    <link href="../../css/fonts.css?1731043964" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css?1731043964" rel="stylesheet"></noscript>
    <link href="../../css/theme.css?1731043964" rel="stylesheet">
    <link href="../../css/theme-relearn-auto.css?1731043964" rel="stylesheet" id="R-variant-style">
    <link href="../../css/chroma-relearn-auto.css?1731043964" rel="stylesheet" id="R-variant-chroma-style">
    <link href="../../css/print.css?1731043964" rel="stylesheet" media="print">
    <link href="../../css/format-print.css?1731043964" rel="stylesheet">
    <script src="../../js/variant.js?1731043964"></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.relBasePath='..\/..';
      window.relearn.relBaseUri='..\/..';
      window.relearn.absBaseUri='https:\/\/chrilves.github.io';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      // variant stuff
      window.variants && variants.init( [ 'relearn-auto', 'relearn-light', 'relearn-dark', 'relearn-bright', 'zen-auto', 'zen-light', 'zen-dark', 'retro-auto', 'neon', 'learn', 'blue', 'green', 'red' ] );
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
    </script>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../posts/gadts_by_use_cases/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li><a href="#acknowledgements">Acknowledgements</a></li>
    <li><a href="#readme">README</a></li>
    <li><a href="#stretching">Stretching</a>
      <ul>
        <li><a href="#values-and-types"><em>Values</em> and <em>Types</em>?</a></li>
        <li><a href="#how-many-types">How many types?</a></li>
        <li><a href="#how-many-values">How many values?</a></li>
      </ul>
    </li>
    <li><a href="#first-contact">First Contact</a>
      <ul>
        <li><a href="#use-case-evidence-of-some-property">Use Case: Evidence of some property</a></li>
        <li><a href="#use-case-the-only-thing-i-know-is-it-exists">Use Case: The only thing I know is it exists</a></li>
        <li><a href="#intermediary-conclusion">Intermediary Conclusion</a></li>
      </ul>
    </li>
    <li><a href="#easy-useful-use-cases-relations-on-types">Easy Useful Use Cases: Relations on Types</a>
      <ul>
        <li><a href="#use-case-witnessing-type-equality">Use Case: Witnessing Type Equality</a></li>
        <li><a href="#use-case-witnessing-sub-typing">Use Case: Witnessing Sub Typing</a></li>
        <li><a href="#use-case-avoiding-annoying-scalac-error-messages-about-bounds-not-respected">Use Case: Avoiding annoying <em>scalac</em> error messages about bounds not respected</a></li>
        <li><a href="#use-case-give-the-right-data-to-the-right-chart">Use Case: Give the right data to the right chart</a></li>
      </ul>
    </li>
    <li><a href="#more-advanced-use-cases">More Advanced Use Cases</a>
      <ul>
        <li><a href="#use-case-effects">Use Case: Effects!</a></li>
        <li><a href="#use-case-ensuring-types-are-supported-by-the-database">Use Case: Ensuring types are supported by the Database</a></li>
        <li><a href="#use-case-simplifying-implicits">Use Case: Simplifying Implicits</a></li>
      </ul>
    </li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../posts/index.html"><span itemprop="name">Posts</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li
            itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">GADTs By Use Cases</span><meta itemprop="position" content="2"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-edit" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="https://github.com/chrilves/chrilves.github.io/edit/master/hugo/content/posts/gadts_by_use_cases.md" target="_self" title="Edit (CTRL&#43;ALT&#43;w)"><i class="fa-fw fas fa-pen"></i></a>
            </div>
            <div class="topbar-button topbar-button-print" data-content-empty="disable" data-width-s="area-more" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/gadts_by_use_cases/index.print.html" title="Print whole chapter (CTRL&#43;ALT&#43;p)"><i class="fa-fw fas fa-print"></i></a>
            </div>
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/les_gadts_par_l_exemple/index.html" title="Les GADTs Par l&#39;Exemple (ü°ê)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="../../posts/prime/index.html" title="Proving Primality with GADTs (ü°í)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable posts" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="gadts-by-use-cases">GADTs By Use Cases</h1>
    <p class="article-meta default"><em>26 Oct 2019 - 7400 Words</em></p>

<p><strong>This workshop will be presented at <a href="https://scala.io/" rel="external" target="_self">ScalaIO 2019</a>,
in <em>Lyon</em> (<em>France</em>), on <a href="https://schedule.scala.io/#/day/1" rel="external" target="_self"><em>Tuesday the 29th of October</em> at 9am</a>.</strong></p>
<p>Welcome. This session will introduce you to a very powerful tool in
programming. Whereas most introduction start by presenting its
theoretical foundations in a very formal way, we chose to present
it via short examples and practical use cases.</p>
<p>This workshop is made of three parts. The last one presents three
of the most valuable use cases. They are the real big powerful use cases.
But do not go there unprepared! This is the last part for a reason:
they rely massively on lessons you will learn in the previous parts.
Start by <a href="../../posts/gadts_by_use_cases/index.html#first-contact">First Contact</a>, it will show
you, via the simplest examples, the core ideas. Its goal is to open your
mind to ways of using types and data you may have never imagined possible.
Then go to
<a href="../../posts/gadts_by_use_cases/index.html#easy-useful-use-cases-relations-on-types">Easy Useful Use Cases: Relations on Types</a>,
for the first real-life challenge.
Then, you are ready for <a href="../../posts/gadts_by_use_cases/index.html#more-advanced-use-cases">More Advanced Use Cases</a>.</p>
<p>Be sure to <strong>read <a href="../../posts/gadts_by_use_cases/index.html#readme">README</a></strong>, it contains precious tips to ease your
journey.</p>
<h2 id="acknowledgements">Acknowledgements</h2>
<p>We would like to thank <a href="http://www.laure-juglaret.fr/" rel="external" target="_self">Laure Juglaret</a> for
having reviewed this presentation many times, for her precious remarks and
corrections.</p>
<h2 id="readme">README</h2>
<p>In this presentation we will assume that:</p>
<ul>
<li><code>null</code> <strong>does not exists!</strong></li>
<li><strong>runtime-reflection does not exist!</strong> (i.e. <code>isInstanceOf</code>, <code>getClass</code>, etc)</li>
</ul>
<p>This presentation considers that <em>these features do not exists at all</em>.</p>
<p><strong>Using these features will never lead to a valid answer</strong>.</p>
<p>This presentation expects you to have access to something where
you can easily write, compile and run <em>Scala</em> code. The best way to do so
is opening a <em>R.E.P.L.</em> session. If you have <em>Scala</em> installed on your system,
you can easily start one from the command-line by executing <code>scala</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">system</span><span class="o">-</span><span class="n">command</span><span class="o">-</span><span class="n">line</span><span class="k">#</span> <span class="n">scala</span>
</span></span><span class="line"><span class="cl"><span class="nc">Welcome</span> <span class="n">to</span> <span class="nc">Scala</span> <span class="mf">2.13</span><span class="o">.</span><span class="mi">1</span> <span class="o">(</span><span class="nc">OpenJDK</span> <span class="mi">64</span><span class="o">-</span><span class="nc">Bit</span> <span class="nc">Server</span> <span class="nc">VM</span><span class="o">,</span> <span class="nc">Java</span> <span class="mf">1.8</span><span class="o">.</span><span class="mi">0</span><span class="n">_222</span><span class="o">).</span>
</span></span><span class="line"><span class="cl"><span class="nc">Type</span> <span class="n">in</span> <span class="n">expressions</span> <span class="k">for</span> <span class="n">evaluation</span><span class="o">.</span> <span class="nc">Or</span> <span class="k">try</span> <span class="k">:</span><span class="kt">help.</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">scala&gt;</span></span></span></code></pre></div>
<p>Remember that the <em>R.E.P.L</em> command <code>:paste</code> allows to paste code
and <code>:reset</code> cleans the environment.</p>
<p>If you don&rsquo;t have <em>Scala</em> installed, <strong>you can use</strong> the <em>online-REPL</em>
<a href="https://scastie.scala-lang.org/" rel="external" target="_self">https://scastie.scala-lang.org/</a> .</p>
<h2 id="stretching">Stretching</h2>
<p>This section is a brief reminder of some definitions and properties
about values and types.</p>
<h3 id="values-and-types"><em>Values</em> and <em>Types</em>?</h3>
<p><strong>Values</strong> are <em>actual piece of data your program manipulates</em>
like the integer <code>5</code>, the boolean <code>true</code>, the string <code>&quot;Hello World!&quot;</code>,
the function <code>(x: Double) =&gt; x / 7.5</code>, the list <code>List(1,2,3)</code>, etc.
It is convenient to classify values into groups. These groups are called
<strong>types</strong>. For example:</p>
<ul>
<li><code>Int</code> is the group of integer values, i.e. values like <code>1</code>, <code>-7</code>, <code>19</code>, etc.</li>
<li><code>Boolean</code> is the group containing exactly the values
<code>true</code> and <code>false</code> (no more, no less!).</li>
<li><code>String</code> is the group whose values are <code>&quot;Hello World!&quot;</code>, <code>&quot;&quot;</code>, <code>&quot;I ‚ù§Ô∏è GADTs&quot;</code>, etc.</li>
<li><code>Double =&gt; Double</code> is the group whose values are functions taking
any <code>Double</code> as argument and returning some <code>Double</code>.</li>
</ul>
<p>To indicate that the value <code>v</code> belongs to the type (i.e. group of values) <code>T</code>,
we write <code>v : T</code>. In <em>Scala</em>, testing if a value <code>v</code> belongs to a type <code>T</code>
is very simple: just type <code>v : T</code> in the <em>REPL</em>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="mi">5</span> <span class="k">:</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl"><span class="n">res7</span><span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">5</span></span></span></code></pre></div>
<p>If <em>Scala</em> accepts it, then <code>v</code> belongs to <code>T</code>. If <em>Scala</em> complains,
it most probably does not :</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="mi">5</span> <span class="k">:</span> <span class="kt">String</span>
</span></span><span class="line"><span class="cl">       <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">found</span>   <span class="k">:</span> <span class="kt">Int</span><span class="o">(</span><span class="err">5</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">        <span class="kt">required:</span> <span class="kt">String</span></span></span></code></pre></div>
<h3 id="how-many-types">How many types?</h3>
<p>Let&rsquo;s now create some types and some of their values (when possible!).</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OneType</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> How many types does the line <code>class OneType</code> defines?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>As the name suggests, <code>class OneType</code> defines only one type which is named <code>OneType</code>.</p>
  </details>
</li>
</ul>
<p>Let&rsquo;s now consider:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">OneTypeForEvery</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 2:</strong> How many types does the line <code>class OneTypeForEvery[A]</code> defines?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>As the name suggests, every concrete type <code>A</code> gives
rise to a distinct type <code>OneTypeForEvery[A]</code>.</p>
<p>For example, a list of integers is neither a list of booleans,
nor a list of strings, nor a list of functions, nor &hellip;
It means the types <code>List[Int]</code>, <code>List[Boolean]</code>,
<code>List[Int =&gt; Int]</code>, etc are all distinct types.</p>
<p>The line <code>class OneTypeForEvery[A]</code> defines a
<strong>distinct type for every concrete type</strong> <code>A</code>. There
is an infnity of concrete types <code>A</code>, so an infinity of distinct types
<code>OneTypeForEvery[A]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Give a value that belongs to both <code>OneTypeForEvery[Int]</code>
and <code>OneTypeForEvery[Boolean]</code>.</p>
<p><strong>Remember that <code>null</code> does not exist!</strong></p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>This is actually impossible. Every concrete type <code>A</code> give rise a distinct type <code>OneTypeForEvery[A]</code>
that have no values in common with others types <code>OneTypeForEvery[B]</code> for <code>B ‚â† A</code>.</p>
  </details>
</li>
</ul>
<h3 id="how-many-values">How many values?</h3>
<p>Considering the following type:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">abstract</span> <span class="k">class</span> <span class="nc">NoValueForThisType</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Give a value belonging to the type <code>NoValueForThisType</code>?
How many values belong to <code>NoValueForThisType</code>?</p>
  <details>
  <summary><em>Hint (click to expand)</em></summary>
<ul>
<li>What is a <code>final</code> class? How does it differ from a normal non-final class?</li>
<li>What is an <code>abstract</code> class? How does it differ from a concrete class?</li>
</ul>
  </details>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>The class <code>NoValueForThisType</code> is declared <code>abstract</code>. It is then forbidden to create
a direct instance of this class:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">new</span> <span class="nc">NoValueForThisType</span>
</span></span><span class="line"><span class="cl">        <span class="o">^</span>
</span></span><span class="line"><span class="cl">        <span class="n">error</span><span class="k">:</span> <span class="kt">class</span> <span class="kt">NoValueForThisType</span> <span class="kt">is</span> <span class="kt">abstract</span><span class="o">;</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">instantiated</span></span></span></code></pre></div>
<p>The only way to create an instance of an abstract class is creating a concrete sub-class.
But the keyword <code>final</code> forbids creating such sub-classes:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">class</span> <span class="nc">ConcreteSubClass</span> <span class="k">extends</span> <span class="nc">NoValueForThisType</span>
</span></span><span class="line"><span class="cl">                                        <span class="o">^</span>
</span></span><span class="line"><span class="cl">        <span class="n">error</span><span class="k">:</span> <span class="kt">illegal</span> <span class="kt">inheritance</span> <span class="kt">from</span> <span class="kt">final</span> <span class="kt">class</span> <span class="kt">NoValueForThisType</span></span></span></code></pre></div>
<p>There is no way to create an instance of <code>NoValueForThisType</code>.</p>
  </details>
</li>
</ul>
<p>Let&rsquo;s take another example:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ExactlyOneValue</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">TheOnlyValue</span> <span class="k">extends</span> <span class="nc">ExactlyOneValue</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 2:</strong> Give a value belonging to the type <code>ExactlyOneValue</code>?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>By definition, <code>TheOnlyValue</code> is a value of type <code>ExactlyOneValue</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> How many values belong to <code>ExactlyOneValue</code>?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>Just like above, <code>ExactlyOneValue</code>, being a <code>trait</code>, is <em>abstract</em>. Being <code>sealed</code>,
extending it outside of its defining file is forbidden.
So <code>TheOnlyValue</code> is the only value of type <code>ExactlyOneValue</code>.</p>
  </details>
</li>
</ul>
<h2 id="first-contact">First Contact</h2>
<p>This part presents the core ideas. There are actually
only two ideas! What you will find here are stripped down
examples to illustrate each of these ideas.</p>
<h3 id="use-case-evidence-of-some-property">Use Case: Evidence of some property</h3>
<p>Let&rsquo;s define a simple <em>sealed trait</em>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ATrait</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">case</span> <span class="k">object</span> <span class="nc">AValue</span> <span class="k">extends</span> <span class="nc">ATrait</span><span class="o">[</span><span class="kt">Char</span><span class="o">]</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Give a value of type <code>ATrait[Char]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>By definition, <code>AValue</code> is a value of type <code>ATrait[Char]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> Give a value of type <code>ATrait[Double]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>There is no way to have an instance of type <code>ATrait[Double]</code>.
There is actually no way to have an instance of type <code>ATrait[B]</code> for <code>B ‚â† Char</code>,
because the only possible value is <code>AValue</code> which is of type <code>ATrait[Char]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> What can you conclude about a type <code>A</code> if you have a value
<code>ev</code> of type <code>ATrait[A]</code> (i.e. <code>ev: ATrait[A]</code>)?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>The only possible value is <code>AValue</code>, so <code>ev == AValue</code>.
Furthermore <code>AValue</code> is of type <code>ATrait[Char]</code> so <code>A = Char</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 4:</strong> In the <em>REPL</em>, enter the following code:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">ATrait</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">x</span></span></span></code></pre></div>
</li>
<li>
<p><strong>Question 5:</strong> Now try pattern matching on <code>ev: ATrait[A]</code></p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">ATrait</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">ev</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">AValue</span> <span class="k">=&gt;</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Is the pattern matching exhaustive?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>The pattern matching is exhaustive because the only possible actual
value for <code>ev</code> is <code>AValue</code>. Furthermore <code>AValue</code> is of type <code>ATrait[Char]</code>
which means <code>ev : ATrait[Char]</code> because <code>ev == AValue</code>. So <code>A = Char</code> and <code>x : Char</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 6:</strong> Call <code>f</code> with <code>x = 'w' : Char</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">[</span><span class="kt">Char</span><span class="o">](</span><span class="sc">&#39;w&#39;</span><span class="o">,</span> <span class="nc">AValue</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span> <span class="n">w</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 7:</strong> Call <code>f</code> with <code>x =  5.2 : Double</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>This is impossible because it would require to give a value
<code>ev : ATrait[Double]</code>, which does not exist!</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">f</span><span class="o">[</span><span class="kt">Double</span><span class="o">](</span><span class="mi">5</span><span class="o">,</span> <span class="nc">AValue</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">                    <span class="o">^</span>
</span></span><span class="line"><span class="cl">          <span class="n">error</span><span class="k">:</span> <span class="k">type</span> <span class="kt">mismatch</span><span class="o">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">found</span>   <span class="k">:</span> <span class="kt">AValue.type</span>
</span></span><span class="line"><span class="cl">            <span class="n">required</span><span class="k">:</span> <span class="kt">ATrait</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em></summary>
<p>Using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">IsChar</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">Evidence</span> <span class="k">extends</span> <span class="nc">IsChar</span><span class="o">[</span><span class="kt">Char</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">evidence</span><span class="k">:</span> <span class="kt">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">evidence</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A:</span> <span class="kt">IsChar</span><span class="o">](</span><span class="n">x</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Char</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">IsChar</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">IsChar</span><span class="o">.</span><span class="nc">Evidence</span> <span class="k">=&gt;</span> <span class="n">x</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
</details>
<h3 id="use-case-the-only-thing-i-know-is-it-exists">Use Case: The only thing I know is it exists</h3>
<p>What would you do if you wanted your codebase to log messages, but you want to be sure your
codebase do not rely on any implementation details of the logger, so that you can change its
implementation without risking breaking the codebase?</p>
<p>Take the following logger type <code>UnknownLogger</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">UnknownLogger</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">LogWith</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span> <span class="k">:</span> <span class="kt">X</span><span class="o">,</span> <span class="n">appendMessage</span><span class="k">:</span> <span class="o">(</span><span class="kt">X</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UnknownLogger</span></span></span></code></pre></div>
<p>The first logger we will create stores the logs in a <code>String</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">loggerStr</span> <span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">LogWith</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="s">&#34;&#34;</span><span class="o">,</span> <span class="o">(</span><span class="n">logs</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">logs</span> <span class="o">++</span> <span class="n">message</span><span class="o">)</span></span></span></code></pre></div>
<p>The second logger stores them in a <code>List[String]</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">loggerList</span> <span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">LogWith</span><span class="o">[</span><span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">]](</span><span class="nc">Nil</span><span class="o">,</span> <span class="o">(</span><span class="n">logs</span><span class="k">:</span> <span class="kt">List</span><span class="o">[</span><span class="kt">String</span><span class="o">],</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">message</span> <span class="k">:</span><span class="kt">:</span> <span class="kt">logs</span><span class="o">)</span></span></span></code></pre></div>
<p>The third logger directly prints the messages to the standard output:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">loggerStdout</span> <span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">LogWith</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]((),</span> <span class="o">(</span><span class="n">logs</span><span class="k">:</span> <span class="kt">Unit</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">println</span><span class="o">(</span><span class="n">message</span><span class="o">))</span></span></span></code></pre></div>
<p>Note that these three loggers all have the same type (i.e. <code>UnknownLogger</code>) but they store
the logs using different types <code>X</code> (<code>String</code>, <code>List[String]</code> and <code>Unit</code>).</p>
<ul>
<li>
<p><strong>Question 1:</strong> Let <code>v</code> be a value of type <code>UnknownLogger</code>.
Clearly <code>v</code> has to be an instance of the class <code>LogWith[X]</code> for some type <code>X</code>.
What can you say about the type <code>X</code>? Can you figure out which type <code>X</code> actually is?</p>
<p><strong>Remember that we refuse to use runtime-reflection!</strong> (i.e. <code>isInstanceOf</code>, <code>getClass</code>, etc)</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>We know almost nothing about <code>X</code>. The only thing we know is there exists at least
one value (<code>v.logs</code>) of type <code>X</code>. Appart from that, <code>X</code> can be any type.</p>
<p>Not knowing which type is actually <code>X</code> is very useful to guarantee that the code that will
use <code>v : UnknownLogger</code> will never rely on the nature of <code>X</code>. If the code knew <code>X</code> was
<code>String</code> for example, it could perform some operations we want to forbid like reversing
the list, taking only the <em>nth</em> first characters, etc. By hiding the real type <code>X</code>, we force
our codebase to not depend on what <code>X</code> is but to use the provided <code>v.appendMessage</code>.
So changing the real implementation of the logger won&rsquo;t break any code.</p>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> Write the function <code>def log(message: String, v: UnknownLogger): UnknownLogger</code>
that uses <code>v.appendMessage</code> to append <code>message</code> to <code>v.logs</code>
and returns a new <code>UnknownLogger</code> containing the new logs.</p>
<p>Remember that in <em>Scala</em>, the pattern <code>case ac : AClass[t] =&gt;</code> (see below)
is allowed in <code>match/case</code> in replacement of the pattern <code>case AClass(v) =&gt;</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">AClass</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span> <span class="k">:</span> <span class="kt">A</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">f</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">v</span><span class="k">:</span> <span class="kt">AClass</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">ac</span> <span class="k">:</span> <span class="kt">AClass</span><span class="o">[</span><span class="kt">t</span><span class="o">]</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// The variable `t` is a type variable
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="c1">// The type `t` is equal to `A`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">val</span> <span class="n">r</span> <span class="k">:</span> <span class="kt">t</span> <span class="o">=</span> <span class="n">ac</span><span class="o">.</span><span class="n">value</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Its main benefit is introducing the type variable <code>t</code>.
Type variables work like normal pattern variables except that they represent types
instead of values. Having <code>t</code> enable us to help the compiler by giving explicit types
(like just above, saying <code>r</code> is of type <code>t</code>).</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">log</span><span class="o">(</span><span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">,</span> <span class="n">v</span><span class="k">:</span> <span class="kt">UnknownLogger</span><span class="o">)</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">vx</span> <span class="k">:</span> <span class="kt">LogWith</span><span class="o">[</span><span class="kt">x</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="nc">LogWith</span><span class="o">[</span><span class="kt">x</span><span class="o">](</span><span class="n">vx</span><span class="o">.</span><span class="n">appendMessage</span><span class="o">(</span><span class="n">vx</span><span class="o">.</span><span class="n">logs</span><span class="o">,</span> <span class="n">message</span><span class="o">),</span> <span class="n">vx</span><span class="o">.</span><span class="n">appendMessage</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Execute <code>log(&quot;Hello World&quot;, loggerStr)</code> and <code>log(&quot;Hello World&quot;, loggerList)</code>
and <code>log(&quot;Hello World&quot;, loggerStdout)</code></p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">,</span> <span class="n">loggerStr</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span> <span class="nc">LogWith</span><span class="o">(</span><span class="nc">Hello</span> <span class="nc">World</span><span class="o">,</span><span class="nc">$$Lambda$988</span><span class="o">/</span><span class="mi">1455466014</span><span class="k">@</span><span class="mi">421</span><span class="n">ead7e</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">,</span> <span class="n">loggerList</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res1</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span> <span class="nc">LogWith</span><span class="o">(</span><span class="nc">List</span><span class="o">(</span><span class="nc">Hello</span> <span class="nc">World</span><span class="o">),</span><span class="nc">$$Lambda$989</span><span class="o">/</span><span class="mi">1705282731</span><span class="k">@</span><span class="mi">655621</span><span class="n">fd</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">log</span><span class="o">(</span><span class="s">&#34;Hello World&#34;</span><span class="o">,</span> <span class="n">loggerStdout</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nc">Hello</span> <span class="nc">World</span>
</span></span><span class="line"><span class="cl"><span class="n">res2</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span> <span class="nc">LogWith</span><span class="o">((),</span><span class="nc">$$Lambda$990</span><span class="o">/</span><span class="mi">1835105031</span><span class="k">@</span><span class="mi">340</span><span class="n">c57e0</span><span class="o">)</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em></summary>
<p>Once again, using all the nice features of <em>Scala</em>,
the production-ready version of the code above is:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">UnknownLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">LogsType</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">logs</span> <span class="k">:</span> <span class="kt">LogsType</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">appendMessage</span><span class="o">(</span><span class="n">presentLogs</span><span class="k">:</span> <span class="kt">LogsType</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">LogsType</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">UnknownLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">LogWith</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span> <span class="k">:</span> <span class="kt">X</span><span class="o">,</span> <span class="n">appendMessage_</span> <span class="k">:</span> <span class="o">(</span><span class="kt">X</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">UnknownLogger</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">type</span> <span class="kt">LogsType</span> <span class="o">=</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">    <span class="k">def</span> <span class="n">appendMessage</span><span class="o">(</span><span class="n">presentLogs</span><span class="k">:</span> <span class="kt">LogsType</span><span class="o">,</span> <span class="n">message</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">LogsType</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">      <span class="n">appendMessage_</span><span class="o">(</span><span class="n">presentLogs</span><span class="o">,</span> <span class="n">message</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span><span class="k">:</span> <span class="kt">X</span><span class="o">,</span> <span class="n">appendMessage</span><span class="k">:</span> <span class="o">(</span><span class="kt">X</span><span class="o">,</span> <span class="kt">String</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">UnknownLogger</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">LogWith</span><span class="o">[</span><span class="kt">X</span><span class="o">](</span><span class="n">logs</span><span class="o">,</span> <span class="n">appendMessage</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</details>
<h3 id="intermediary-conclusion">Intermediary Conclusion</h3>
<p><em>GADTs</em> are actually only this: simple <em>sealed trait</em> with some
<em>case object</em> (possibly none) and some <em>final case class</em> (possible none too!).
In the following parts we will explore some major use cases of <em>GADTs</em></p>
<h2 id="easy-useful-use-cases-relations-on-types">Easy Useful Use Cases: Relations on Types</h2>
<p>One easy, but very useful, benefit of <em>GADTs</em> is expressing relations about types such that:</p>
<ul>
<li>Is type <code>A</code> equal to type <code>B</code>?</li>
<li>Is type <code>A</code> a sub-type of <code>B</code>?</li>
</ul>
<p>Note that, by definition, a type <code>A</code> is a sub-type of itself (i.e. <code>A &lt;: A</code>),
very much like an integer <code>x</code> is also lesser-than-or-equal to itself <code>x ‚â§ x</code>.</p>
<h3 id="use-case-witnessing-type-equality">Use Case: Witnessing Type Equality</h3>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">X</span><span class="o">]</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Give a value of type <code>EqT[Int, Int]</code></p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">Int</span><span class="o">]()</span> <span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">Int</span>,<span class="kt">Int</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">()</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> Give a value of type <code>EqT[String, Int]</code></p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>The class <code>Evidence</code> is the only concrete sub-class of trait <code>EqT</code> and we cannot
create another one because <code>EqT</code> is <code>sealed</code>. So any value <code>v : EqT[A,B]</code> has to be
an instance of <code>Evidence[X]</code> for some type <code>X</code>, which is of type <code>EqT[X,X]</code>.
Thus there is no way to get a value of type <code>EqT[String, Int]</code>.</p>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Given two (unknown) types <code>A</code> and <code>B</code>.
What can you conclude if I give you a value of type <code>EqT[A,B]</code>?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>If I give you a value <code>v : EqT[A,B]</code>, then you know that <code>v</code> is an instance of
<code>Evidence[X]</code> for some (unknown) type <code>X</code> because the class <code>Evidence</code> is the only concrete
sub-class of the sealed trait <code>EqT</code>. Actually <code>Evidence[X]</code> is a sub-type of
<code>EqT[X,X]</code>. Thus <code>v : EqT[X,X]</code>. Types <code>EqT[A,B]</code> and <code>EqT[X,X]</code> have no value in
common if <code>A ‚â† X</code> or <code>B ‚â† X</code>, so <code>A = X</code> and <code>B = X</code>. Thus <code>A = B</code>.</p>
  </details>
</li>
</ul>
<details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em></summary>
<p>In production, it is convenient to write the following equivalent code:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">EqT</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">X</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">X</span><span class="o">]()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</details>
<h4 id="switching-between-equal-types">Switching between equal types</h4>
<p>If <code>A</code> and <code>B</code> are actually the same type, then <code>List[A]</code> is also the
same type as <code>List[B]</code>, <code>Option[A]</code> is also the same type as <code>Option[B]</code>,
etc. More generally, for any <code>F[_]</code>, <code>F[A]</code> is also the same type as <code>F[B]</code>.</p>
<ul>
<li>
<p><strong>Question 4:</strong> Write the function <code>def coerce[F[_],A,B](eqT: EqT[A,B])(fa: F[A]): F[B]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">coerce</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])(</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">eqT</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="k">_</span> <span class="k">:</span> <span class="kt">Evidence</span><span class="o">[</span><span class="kt">x</span><span class="o">]</span> <span class="k">=&gt;</span> <span class="n">fa</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>The <em>Scala</em> standard library already defines a class, named <code>=:=[A,B]</code>
(yes, its name is really <code>=:=</code>), representing type equality.
You&rsquo;re strongly encouraged to have a quick look
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html" rel="external" target="_self">at its documentation (click here)</a>.
Thankfully, <em>Scala</em> enables to write <code>A =:= B</code> instead of <code>=:=[A,B]</code>.</p>
<p>Given two types <code>A</code> and <code>B</code>, having an instance (i.e. object)
of <code>A =:= B</code> means that <code>A</code> and <code>B</code> are actually the same type,
just like with <code>EqT[A,B]</code>.
Remember that <code>A =:= B</code> is just syntactic sugar for <code>=:=[A,B]</code>.</p>
<p>Instances of <code>A =:= B</code> can be created by the function
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less$.html#refl[A]:A=:=A" rel="external" target="_self"><code>(&lt;:&lt;).refl[X]: X =:= X</code>
(click for docs)</a>.
The &ldquo;symbol&rdquo; <code>&lt;:&lt;</code> is indeed a valid name for an object.</p>
<ul>
<li>
<p><strong>Question 5:</strong> Using the function <code>coerce</code> above,
write the function <code>def toScalaEq[A,B](eqT: EqT[A,B]): A =:= B</code>.</p>
  <details>
    <summary><em>Hint (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">toScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* Find a definition for:
</span></span></span><span class="line"><span class="cl"><span class="cm">        - the type constructor `F`
</span></span></span><span class="line"><span class="cl"><span class="cm">        - the value `fa : F[A]`
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cm">/* Such that this call: */</span>
</span></span><span class="line"><span class="cl">  <span class="n">coerce</span><span class="o">[</span><span class="kt">F</span>,<span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="o">)(</span><span class="n">fa</span><span class="o">)</span> <span class="c1">// is of type `F[B]`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span></span></span></code></pre></div>
  </details>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">toScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="n">A</span> <span class="o">=:=</span> <span class="n">X</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">(&lt;:&lt;).</span><span class="n">refl</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="n">coerce</span><span class="o">[</span><span class="kt">F</span>,<span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">eqT</span><span class="o">)(</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 6:</strong> Using the <em>method</em> <code>substituteCo[F[_]](ff: F[A]): F[B]</code> of
objects of class <code>A =:= B</code>, whose
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html#substituteCo[F[_]](ff:F[From]):F[To]" rel="external" target="_self">documentation is here</a>,
write the function <code>def fromScalaEq[A,B](scala: A =:= B): EqT[A,B]</code>.</p>
  <details>
    <summary><em>Hint (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">fromScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">scala</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="cm">/* Find a definition for:
</span></span></span><span class="line"><span class="cl"><span class="cm">        - the type constructor `F`
</span></span></span><span class="line"><span class="cl"><span class="cm">        - the value `fa : F[A]`
</span></span></span><span class="line"><span class="cl"><span class="cm">  */</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="o">???</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="cm">/* Such that this call: */</span>
</span></span><span class="line"><span class="cl">  <span class="n">scala</span><span class="o">.</span><span class="n">substituteCo</span><span class="o">[</span><span class="kt">F</span><span class="o">](</span><span class="n">fa</span><span class="o">)</span> <span class="c1">// is of type `F[B]`
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="o">}</span></span></span></code></pre></div>
  </details>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">fromScalaEq</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">scala</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span><span class="k">:</span><span class="o">=</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">type</span> <span class="kt">F</span><span class="o">[</span><span class="kt">X</span><span class="o">]</span> <span class="k">=</span> <span class="nc">EqT</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">X</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">A</span><span class="o">]()</span>
</span></span><span class="line"><span class="cl">  <span class="n">scala</span><span class="o">.</span><span class="n">substituteCo</span><span class="o">[</span><span class="kt">F</span><span class="o">](</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<h3 id="use-case-witnessing-sub-typing">Use Case: Witnessing Sub Typing</h3>
<p>In this section, we want to create types <code>SubTypeOf[A,B]</code> whose values prove
that the type <code>A</code> is a sub-type of <code>B</code> (i.e. <code>A &lt;: B</code>).
A similar <em>but different</em> class already exists in the <em>Scala</em> library.
It is named <code>&lt;:&lt;[A,B]</code>, which is often written <code>A &lt;:&lt; B</code>. Its
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less.html" rel="external" target="_self">documentation is here</a>.
Because this section is about implementing a variant of this class,
please <strong>do not use</strong> <code>&lt;:&lt;[A,B]</code> to implement <code>SubTypeOf</code>.</p>
<ul>
<li>
<p><strong>Question 1:</strong> Using only <em>upper bounds</em> (i.e. <code>A &lt;: B</code>) or <em>lower bounds</em> (i.e. <code>A &gt;: B</code>)
and <strong>no</strong> <em>variance annotation</em> (i.e. <code>[+A]</code> and <code>[-A]</code>),
create the trait <code>SubTypeOf[A,B]</code> (and all that is necessary) such that:</p>
<blockquote>
<p>There exists a value of type <code>SubType[A,B]</code> <strong>if and only if</strong>
<code>A</code> is a sub-type of <code>B</code> (i.e. <code>A &lt;: B</code>).</p>
</blockquote>
<p>Remember that, by definition, a type <code>A</code> is a sub-type of itself (i.e. <code>A &lt;: A</code>).</p>
<p>Remember that you should not use the <code>class &lt;:&lt;[A,B]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">SubTypeEvidence</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">B</span>, <span class="kt">B</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span></span></span></code></pre></div>
  <details>
    <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em></summary>
<p>In production, it is convenient to write the following equivalent code:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">SubTypeOf</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">B</span>, <span class="kt">B</span><span class="o">]()</span> <span class="k">extends</span> <span class="nc">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">evidence</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">B</span>, <span class="kt">B</span><span class="o">]</span><span class="k">:</span> <span class="kt">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">Evidence</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">]()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
  </details>
</li>
</ul>
<h3 id="use-case-avoiding-annoying-scalac-error-messages-about-bounds-not-respected">Use Case: Avoiding annoying <em>scalac</em> error messages about bounds not respected</h3>
<p>In this example, we want to model the diet of some animals.
We start by defining the <code>Food</code> type and some of its subtypes:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Food</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Vegetable</span> <span class="k">extends</span> <span class="nc">Food</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">Fruit</span> <span class="k">extends</span> <span class="nc">Food</span></span></span></code></pre></div>
<p>and then the class representing animals eating food of type <code>A</code>
(i.e. <code>Vegetable</code>, <code>Fruit</code>, etc):</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">Food</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nc">val</span> <span class="n">elephant</span> <span class="k">:</span> <span class="kt">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">]</span></span></span></code></pre></div>
<p>Let&rsquo;s define a function like there are so many in
<em>Functional Programming</em>, and apply it to <code>elephant</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="s">&#34;Ok!&#34;</span></span></span></code></pre></div>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">List</span>, <span class="kt">Int</span><span class="o">](</span><span class="nc">List</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span><span class="mi">2</span><span class="o">,</span><span class="mi">3</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">Option</span>, <span class="kt">Boolean</span><span class="o">](</span><span class="nc">Some</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="n">res1</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">AnimalEating</span>, <span class="kt">Vegetable</span><span class="o">](</span><span class="n">elephant</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">            <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="kt">kinds</span> <span class="kt">of</span> <span class="kt">the</span> <span class="k">type</span> <span class="kt">arguments</span> <span class="o">(</span><span class="kt">AnimalEating</span><span class="o">,</span><span class="kt">Vegetable</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">       <span class="k">do</span> <span class="n">not</span> <span class="n">conform</span> <span class="n">to</span> <span class="n">the</span> <span class="n">expected</span> <span class="n">kinds</span> <span class="n">of</span> <span class="n">the</span> <span class="k">type</span> <span class="kt">parameters</span> <span class="o">(</span><span class="k">type</span> <span class="kt">F</span><span class="o">,</span><span class="k">type</span> <span class="kt">A</span><span class="o">).</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">       <span class="nc">AnimalEating</span>&#39;s <span class="k">type</span> <span class="kt">parameters</span> <span class="kt">do</span> <span class="kt">not</span> <span class="kt">match</span> <span class="k">type</span> <span class="kt">F</span><span class="err">&#39;</span><span class="kt">s</span> <span class="kt">expected</span> <span class="kt">parameters:</span>
</span></span><span class="line"><span class="cl">       <span class="k">type</span> <span class="kt">A</span><span class="err">&#39;</span><span class="kt">s</span> <span class="kt">bounds</span> <span class="k">&lt;:</span> <span class="kt">Food</span> <span class="kt">are</span> <span class="kt">stricter</span> <span class="kt">than</span>
</span></span><span class="line"><span class="cl">       <span class="k">type</span> <span class="k">_</span><span class="err">&#39;</span><span class="kt">s</span> <span class="kt">declared</span> <span class="kt">bounds</span> <span class="k">&gt;:</span> <span class="kt">Nothing</span> <span class="k">&lt;:</span> <span class="kt">Any</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> Why does <em>scalac</em> complains?</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>The function <code>dummy</code> requires its argument <code>F</code>, which is a type constructor
like <code>List</code>, <code>Option</code>, <code>Future</code>, etc,  to accept any type
as argument so that we can write <code>F[A]</code> for any type <code>A</code>. On the contrary,
<code>AnimalEating</code> requires its argument to be a sub-type of <code>Food</code>.
Thus <code>AnimalEating</code> can not be used as <code>dummy</code>&rsquo;s argument <code>F</code>.</p>
  </details>
</li>
</ul>
<p>The problem is that, when we defined <code>class AnimalEating[A &lt;: Food]</code>,
we gave the restriction that <code>A &lt;: Food</code>. So <em>Scala</em>, like <em>Java</em>,
forbids us to give <code>AnimalEating</code> anything but a sub-type of <code>Food</code>
(including <code>Food</code> itself):</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">type</span> <span class="kt">T1</span> <span class="o">=</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">                 <span class="o">^</span>
</span></span><span class="line"><span class="cl">       <span class="n">error</span><span class="k">:</span> <span class="k">type</span> <span class="kt">arguments</span> <span class="o">[</span><span class="kt">Int</span><span class="o">]</span> <span class="k">do</span> <span class="n">not</span> <span class="n">conform</span>
</span></span><span class="line"><span class="cl">       <span class="n">to</span> <span class="k">class</span> <span class="nc">AnimalEating</span>&#39;s <span class="k">type</span> <span class="kt">parameter</span> <span class="kt">bounds</span> <span class="o">[</span><span class="kt">A</span> <span class="k">&lt;:</span> <span class="kt">Food</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="k">type</span> <span class="kt">T2</span> <span class="o">=</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Food</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="n">defined</span> <span class="k">type</span> <span class="kt">alias</span> <span class="kt">T2</span></span></span></code></pre></div>
<p>We face a dilemma: to use the function <code>dummy</code>, that we really want
to use because it&rsquo;s a very nice function, we need to remove the
constraint <code>A &lt;: Food</code> from the definition <code>class AnimalEating[A &lt;: Food]</code>.
But we still want to say that animals eat food, not integers,
boolean or strings!</p>
<ul>
<li>
<p><strong>Question 2:</strong> How can you adapt the definition of <code>AnimalEating</code> so that:</p>
<ul>
<li>
<p>We can call <code>dummy</code> on <code>elephant</code>! We want:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">AnimalEating</span>, <span class="kt">Vegetable</span><span class="o">](</span><span class="n">elephant</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span></span></span></code></pre></div>
</li>
<li>
<p><em>If</em> <code>A</code> is <strong>not a sub-type</strong> of <code>Food</code> (including <code>Food</code> itself),
<em>then</em> it is <strong>impossible</strong> to create an instance of <code>AnimalEating[A]</code>.</p>
</li>
<li>
<p>The class <code>AnimalEating</code> <strong>must</strong> remain an open class
(i.e. neither sealed nor final)! It should be possible for anyone, anywhen,
to create, freely, sub-classes of <code>AnimalEating</code>. Obviously those
sub-classes must satisfy the constraints above.</p>
<details>
  <summary><em>Hint (click to expand)</em></summary>
<p>In <em>Scala</em>, <code>Nothing</code> is a type having no value.
Can you create a value of type <code>(Nothing, Int)</code>? Why?</p>
</details>
<details>
  <summary><em>Solution (click to expand)</em></summary>
<p>If, to create an instance of <code>AnimalEating[A]</code>, we force <strong>every</strong>
creation method to take an extra paramerer of type <code>SubTypeOf[A, Food]</code>,
then it will only be possible to create an instance of <code>AnimalEating[A]</code>
when <code>A</code> is a sub-type of <code>Food</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">ev</span> <span class="k">:</span> <span class="kt">SubTypeOf</span><span class="o">[</span><span class="kt">A</span>, <span class="kt">Food</span><span class="o">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">elephant</span> <span class="k">:</span> <span class="kt">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">new</span> <span class="nc">AnimalEating</span><span class="o">[</span><span class="kt">Vegetable</span><span class="o">](</span><span class="nc">SubTypeEvidence</span><span class="o">[</span><span class="kt">Vegetable</span>, <span class="kt">Food</span><span class="o">])</span></span></span></code></pre></div>
<p>To create a value of type <code>AnimalEating[A]</code>, we need to call
<code>AnimalEating</code>&rsquo;s constructor. And to call this constructor,
we need to provide <code>ev : SubTypeOf[A, Food]</code>.</p>
<p>Now we can apply the <code>dummy</code> function on <code>elephant</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">dummy</span><span class="o">[</span><span class="kt">AnimalEating</span>, <span class="kt">Vegetable</span><span class="o">](</span><span class="n">elephant</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">res0</span><span class="k">:</span> <span class="kt">String</span> <span class="o">=</span> <span class="nc">Ok</span><span class="o">!</span></span></span></code></pre></div>
<p>In practice, using implicits, we let the compiler
fill the parameter <code>ev : SubTypeOf[A, Food]</code> itself.</p>
<p>Note that you can now express the type <code>AnimalEating[Int]</code>
but you won&rsquo;t be able to create a value of this type.</p>
</details>
</li>
</ul>
</li>
</ul>
<h3 id="use-case-give-the-right-data-to-the-right-chart">Use Case: Give the right data to the right chart</h3>
<p>This use case is about enforcing at compile-time that only values
of the right type can be given to a function. In this example, we
consider the design of a chart library. For simplicity&rsquo;s sake, we will
assume that our library only supports two kinds of charts:
<a href="https://www.google.com/search?q=pie+chart&tbm=isch" rel="external" target="_self">Pie charts</a>
and
<a href="https://www.google.com/search?q=xy+charts&tbm=isch" rel="external" target="_self">XY charts</a>.
This is written in <em>Scala</em> via the enumeration:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ChartType</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">PieChart</span> <span class="k">extends</span> <span class="nc">ChartType</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">XYChart</span> <span class="k">extends</span> <span class="nc">ChartType</span></span></span></code></pre></div>
<p>Obviously <em>Pie</em> and <em>XY</em> charts rely on different kinds of data.
Once again for simplicity&rsquo;s sake, we will assume that our two
kinds of data are:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">PieData</span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">XYData</span></span></span></code></pre></div>
<p>A <em>pie</em> chart (<code>PieChart</code>) plots <strong>only</strong> <code>PieData</code>,
whereas an <em>XY</em> chart (<code>XYChart</code>) plots <strong>only</strong> <code>XYData</code>.
Here is our drawing function <code>draw</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">draw</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">chartType</span><span class="k">:</span> <span class="kt">ChartType</span><span class="o">)(</span><span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">chartType</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PieChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">pieData</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">PieData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Do some stuff to draw pieData
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">XYChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">xyData</span> <span class="k">=</span> <span class="n">data</span><span class="o">.</span><span class="n">asInstanceOf</span><span class="o">[</span><span class="kt">XYData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Do some stuff to draw xyData
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>It assumes that the user will only call <code>draw</code> on the right data.
When <code>chartType</code> is <code>PieChart</code>, the function assumes, via
<code>data.asInstanceOf[PieData]</code> that <code>data</code> is actually of type <code>PieData</code>.
And when <code>chartType</code> is <code>XYChart</code>, it assumes that <code>data</code> is actually
of type <code>XYData</code>.</p>
<p>The problem is that these assumptions rely on the hypothesis that
users and developers will always make sure they are calling <code>draw</code> on
the right data type. But nothing stops someone to call <code>draw</code> on a
<code>PieChart</code> with <code>XYData</code> (or the opposite), crashing the system miserably at runtime!</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">draw</span><span class="o">(</span><span class="nc">PieChart</span><span class="o">)(</span><span class="k">new</span> <span class="nc">XYData</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="n">java</span><span class="o">.</span><span class="n">lang</span><span class="o">.</span><span class="nc">ClassCastException</span><span class="k">:</span> <span class="kt">XYData</span> <span class="kt">cannot</span> <span class="kt">be</span> <span class="kt">cast</span> <span class="kt">to</span> <span class="kt">PieData</span>
</span></span><span class="line"><span class="cl">  <span class="n">at</span> <span class="o">.</span><span class="n">draw</span><span class="o">(&lt;</span><span class="n">pastie</span><span class="k">&gt;:</span><span class="mi">11</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">...</span> <span class="mi">28</span> <span class="n">elided</span></span></span></code></pre></div>
<p>As developers, we know mistakes do happen! We want a way to prevent
theses annoying bugs to happen in production! We want to enforce at
compile-time that only these two scenarii are possible:</p>
<ul>
<li>When <code>draw</code> is called with <code>chartType == PieChart</code>:
the argument <code>data</code> can only be of type <code>PieData</code></li>
<li>When <code>draw</code> is called with <code>chartType == XYChart</code>:
the argument <code>data</code> can only be of type <code>XYData</code>.</li>
</ul>
<p>Remember that these two constraints have to be enforced at compile-time!</p>
<ul>
<li>
<p><strong>Question 1:</strong> Adapt the definition of <code>ChartType</code>, <code>PieChart</code>, <code>XYChart</code> and <code>draw</code> such that:</p>
<ul>
<li>
<p>Any scenario other than the two above will make the compilation fail
on a type error.</p>
</li>
<li>
<p><code>ChartType</code> must still be a <code>sealed trait</code>.
It is now allowed to have <em>type parameters</em> (i.e. <em>generics</em>).</p>
</li>
<li>
<p><code>PieChart</code> and <code>XYChar</code> must still be two <code>case object</code>.
They should still extends <code>ChartType</code>.</p>
</li>
<li>
<p><code>ChartType</code>, <code>PieChart</code> and <code>XYChar</code> declarations must have <em>no body</em> at all
(i.e. there should be no brackets <code>{ ... }</code> in their declaration).</p>
</li>
</ul>
  <details>
    <summary><em>Hint (click to expand)</em></summary>
<p>The code looks like this:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">/*PUT</span> <span class="kt">SOME</span> <span class="kt">GENERICS</span> <span class="kt">HERE*/</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">case</span> <span class="k">object</span> <span class="nc">PieChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">/*There</span> <span class="kt">is</span> <span class="kt">something</span> <span class="kt">to</span> <span class="kt">write</span> <span class="kt">here*/</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">XYChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">/*There</span> <span class="kt">is</span> <span class="kt">something</span> <span class="kt">to</span> <span class="kt">write</span> <span class="kt">here</span> <span class="kt">too*/</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">draw</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">chartType</span><span class="k">:</span> <span class="kt">ChartType</span><span class="o">[</span><span class="kt">/*Write</span> <span class="kt">something</span> <span class="kt">here*/</span><span class="o">])(</span><span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">chartType</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PieChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">pieData</span> <span class="k">:</span> <span class="kt">PieData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">XYChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">xyData</span><span class="k">:</span> <span class="kt">XYData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div>
  </details>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">case</span> <span class="k">object</span> <span class="nc">PieChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">PieData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">case</span> <span class="k">object</span> <span class="nc">XYChart</span> <span class="k">extends</span> <span class="nc">ChartType</span><span class="o">[</span><span class="kt">XYData</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">draw</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">chartType</span><span class="k">:</span> <span class="kt">ChartType</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">data</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl"> <span class="n">chartType</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PieChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">pieData</span> <span class="k">:</span> <span class="kt">PieData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">XYChart</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">xyData</span><span class="k">:</span> <span class="kt">XYData</span> <span class="o">=</span> <span class="n">data</span>
</span></span><span class="line"><span class="cl">      <span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>You can now sleep well knowing your production will not
crash because of some bad inputs here üòâ</p>
<h2 id="more-advanced-use-cases">More Advanced Use Cases</h2>
<p>Now that you have seen what <em>GADTs</em> are about and how to use
them in real-life, you are ready for the big use cases below.
There are three of them. Each one illustrates one different way
to use the power of <em>GADTs</em>.
The <a href="../../posts/gadts_by_use_cases/index.html#use-case-effects">first one</a> is about expressing effects,
which is widely used in every popular <em>IO</em> monads or algebraic effects.
Do not worry if you do not know what they are, the section will clarifies it.
The <a href="../../posts/gadts_by_use_cases/index.html#use-case-ensuring-types-are-supported-by-the-database">second one</a>
is about enforcing properties. This point is illustrated
by the real-life use-case of enabling functional programming techniques
support constructions that only work for a limited set of types
(in the example, types supported by our fictional database).
The <a href="../../posts/gadts_by_use_cases/index.html#use-case-simplifying-implicits">third one</a> is about simplifying
the creation of implicits.</p>
<h3 id="use-case-effects">Use Case: Effects!</h3>
<p>What we call an effect is sometimes just an interface declaring some functions with
no implementation. For example we can define the trait below. Note that <em>none</em> of its functions
has an implementation.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">ExampleEffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">randomInt</span> <span class="k">:</span> <span class="kt">Int</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">ignore</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Implementations of these interfaces are given elsewhere and there can be many of them! This
is useful to switch between implementations easily:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">ExampleEffectImpl</span> <span class="k">extends</span> <span class="nc">ExampleEffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">echo</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">randomInt</span> <span class="k">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">ignore</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span> <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Another equivalent way to define <code>ExampleEffectSig</code> is via a <code>sealed trait</code>
with some <code>final case class</code> (possibly none!) and/or some<code>case object</code> (possibly none too!):</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Echo</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">RandomInt</span> <span class="k">extends</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">Int</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Ignore</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">ExampleEffect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span></span></span></code></pre></div>
<p>Once again this is a declaration with no implementation! Once again implementations
can be written elsewhere and there can also be many of them:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">runExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">ExampleEffect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Echo</span><span class="o">(</span><span class="n">value</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="n">value</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">RandomInt</span>   <span class="k">=&gt;</span> <span class="n">scala</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="nc">Random</span><span class="o">.</span><span class="n">nextInt</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Ignore</span><span class="o">(</span><span class="k">_</span><span class="o">)</span>   <span class="k">=&gt;</span> <span class="o">()</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
<p>Let&rsquo;s consider a more realistic effect and one possible implementation:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">EffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">currentTimeMillis</span><span class="k">:</span> <span class="kt">Long</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">printLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">EffectImpl</span> <span class="k">extends</span> <span class="nc">EffectSig</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">currentTimeMillis</span><span class="k">:</span> <span class="kt">Long</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">printLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span><span class="k">:</span> <span class="kt">Unit</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">r</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 1:</strong> <code>ExampleEffect</code> is the equivalent of <code>ExampleEffectSig</code>,
but using a <code>sealed trait</code> with some <code>final case class</code> and <code>case object</code>.
Write the equivalent of <code>EffectSig</code> in the same way. Call this trait <code>Effect</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">CurrentTimeMillis</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 2:</strong> Write the function <code>def run[A](effect: Effect[A]): A</code>
that mimics the implementation of <code>EffectImpl</code>
just like <code>runExampleEffect</code> mimics <code>ExampleEffectImpl</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">CurrentTimeMillis</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Mesure</span><span class="o">(</span><span class="n">fun</span><span class="o">,</span> <span class="n">arg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>The type <code>Effect[A]</code> declares interesting effects (<code>CurrentTimeMillis</code>,
<code>PrintLn</code> and <code>Mesure</code>) but to be really useful, we need to be able
to chain effects! To do so, we want to have these two functions:</p>
<ul>
<li><code>def pure[A](value: A): Effect[A]</code></li>
<li><code>def flatMap[X,A](fx: Effect[X], f: X =&gt; Effect[A]): Effect[A]</code></li>
</ul>
<p>Once again we do not care yet about the implementation. Presently all
we want is declaring these two operations, just like we declared <code>CurrentTimeMillis</code>,
<code>PrintLn</code> and <code>Mesure</code>.</p>
<ul>
<li>
<p><strong>Question 3:</strong> Add two <em>final case classes</em>, <code>Pure</code> and <code>FlatMap</code>,
to <code>Effect[A]</code> declaring these operations.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">CurrentTimeMillis</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">FlatMap</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fx</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">X</span><span class="o">],</span> <span class="n">f</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 4:</strong> Adapt the function <code>run</code> to handle these two new cases.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">CurrentTimeMillis</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Mesure</span><span class="o">(</span><span class="n">fun</span><span class="o">,</span> <span class="n">arg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="n">fx</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">x</span>  <span class="k">=</span> <span class="n">run</span><span class="o">(</span><span class="n">fx</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">run</span><span class="o">(</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 5:</strong> Add the two following methods to trait <code>Effect[A]</code> to get:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">]((</span><span class="n">a</span><span class="k">:</span><span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>And run the follwing code to see if it works:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">effect1</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t0</span> <span class="k">&lt;-</span> <span class="nc">CurrentTimeMillis</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span>  <span class="k">&lt;-</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="s">s&#34;The current time is </span><span class="si">$t0</span><span class="s">&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">run</span><span class="o">(</span><span class="n">effect1</span><span class="o">)</span></span></span></code></pre></div>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span> <span class="n">flatMap</span><span class="o">[</span><span class="kt">B</span><span class="o">]((</span><span class="n">a</span><span class="k">:</span><span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">)))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">CurrentTimeMillis</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Long</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="k">:</span> <span class="kt">String</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Mesure</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fun</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="n">A</span><span class="o">,</span> <span class="n">arg</span><span class="k">:</span> <span class="kt">X</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">Pure</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">FlatMap</span><span class="o">[</span><span class="kt">X</span>,<span class="kt">A</span><span class="o">](</span><span class="n">fx</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">X</span><span class="o">],</span> <span class="n">f</span><span class="k">:</span> <span class="kt">X</span> <span class="o">=&gt;</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="n">run</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">effect</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">effect</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">CurrentTimeMillis</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="n">msg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Mesure</span><span class="o">(</span><span class="n">fun</span><span class="o">,</span> <span class="n">arg</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t0</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">r</span>  <span class="k">=</span> <span class="n">fun</span><span class="o">(</span><span class="n">arg</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">t1</span> <span class="k">=</span> <span class="nc">System</span><span class="o">.</span><span class="n">currentTimeMillis</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">      <span class="n">println</span><span class="o">(</span><span class="s">s&#34;Took </span><span class="si">${</span><span class="n">t1</span> <span class="o">-</span> <span class="n">t0</span><span class="si">}</span><span class="s"> milli-seconds&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">r</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">Pure</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="n">a</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">FlatMap</span><span class="o">(</span><span class="n">fx</span><span class="o">,</span> <span class="n">f</span><span class="o">)</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">x</span>  <span class="k">=</span> <span class="n">run</span><span class="o">(</span><span class="n">fx</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">fa</span> <span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span> <span class="n">f</span><span class="o">(</span><span class="n">x</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">      <span class="n">run</span><span class="o">(</span><span class="n">fa</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">effect1</span><span class="k">:</span> <span class="kt">Effect</span><span class="o">[</span><span class="kt">Unit</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="k">for</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">t0</span> <span class="k">&lt;-</span> <span class="nc">CurrentTimeMillis</span>
</span></span><span class="line"><span class="cl">    <span class="k">_</span>  <span class="k">&lt;-</span> <span class="nc">PrintLn</span><span class="o">(</span><span class="s">s&#34;The current time is </span><span class="si">$t0</span><span class="s">&#34;</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span> <span class="k">yield</span> <span class="o">()</span></span></span></code></pre></div>
<p>When we run <code>run(effect1)</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="n">scala</span><span class="o">&gt;</span> <span class="n">run</span><span class="o">(</span><span class="n">effect1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="nc">The</span> <span class="n">current</span> <span class="n">time</span> <span class="n">is</span> <span class="mi">1569773175010</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>Congratulations! You just wrote your first <em>IO</em> monad! There
is a lot of scientific words to name the <code>sealed trait Effect[A]</code>:
you can call it an <em>algebraic effect</em>, a <em>free monad</em>, an <em>IO</em>, etc.
But in the end, it is just a plain simple <code>sealed trait</code> with
some <code>final case class</code> and <code>case object</code> that
represent the functions we wanted to have, without providing
their implementation (<code>CurrentTimeMillis</code>, <code>PrintLn</code>, <code>Mesure</code>,
<code>Pure</code> and <code>FlatMap</code>). You can call them <em>virtual methods</em> if you
like. <strong>What really matters is that we isolated the declaration of
the functions from their implementation.</strong> Remember that a <code>trait</code>
is just a interface after all.</p>
<h3 id="use-case-ensuring-types-are-supported-by-the-database">Use Case: Ensuring types are supported by the Database</h3>
<p>Databases are great. We can store tables, documents, key/values pairs, graphs, etc.
But for any database, there is unfortunately only a limited set of supported types.
Take a database you like, I am sure I can find some types it does not support.</p>
<p>In this section we consider the use case of data structures and code that do not work
for (values of) any type but only for some! This problem is not limited to databases but
concerns any <em>API</em> that only supports a limited set of types (the vast majority of <em>APIs</em>).
How to enforce this constraint? How to adapt the patterns we like to work under this constraint?
This is all this section is about.</p>
<p>We consider a fictional database that <strong>only</strong> supports the following types:</p>
<ol>
<li><code>String</code></li>
<li><code>Double</code></li>
<li><code>(A,B)</code> where <code>A</code> and <code>B</code> are also types supported by the database.</li>
</ol>
<p>It means that the values stored by the database (in tables, key/value pairs, etc) <strong>must</strong>
follow the rules above. It can store <code>&quot;Hello World&quot;</code> because it is a <code>String</code> which is
a supported type by rule <em>1</em>. Likewise, it can store <code>5.2</code> because it is a <code>Double</code>,
but it can <em>not</em> store <code>5 : Int</code> because it is an <code>Int</code>. It can store <code>(&quot;Hello World&quot;, 5.2)</code>
thanks to rule <em>3</em> and also <code>((&quot;Hello World&quot;, 5.2) , 8.9)</code> once again by rule <em>3</em>.</p>
<ul>
<li>
<p><strong>Question 1:</strong> Define the type <code>DBType[A]</code> such that:</p>
<blockquote>
<p>There exists a value of type <code>DBType[A]</code> <strong>if and only if</strong> <code>A</code>
is a type supported by the database.</p>
</blockquote>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>Transposing the rules above in code, we get:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBString</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBDouble</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span>  <span class="nc">DBPair</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">first</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">second</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span></span></span></code></pre></div>
  <details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em></summary>
<p>Using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">DBType</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBString</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">DBDouble</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DBPair</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">first</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">second</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span> <span class="k">extends</span> <span class="nc">DBType</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">dbString</span> <span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBString</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">dbDouble</span> <span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">Double</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBDouble</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">dbPair</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="k">implicit</span> <span class="n">first</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">second</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[(</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">)]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBPair</span><span class="o">(</span><span class="n">first</span><span class="o">,</span> <span class="n">second</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
  </details>
</li>
</ul>
<p>Using <code>DBType</code>, we can pair a value of type <code>A</code> with a value of type <code>DBType[A]</code>,
which provides an evidence that the type <code>A</code> is supported by the database:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">DBValue</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">value</span><span class="k">:</span> <span class="kt">A</span><span class="o">)(</span><span class="k">implicit</span> <span class="k">val</span> <span class="n">dbType</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span></span></span></code></pre></div>
<p>Note that the parameter <code>dbType</code> does not need to be implicit! All that matters is that
to create a value of type <code>DBValue[A]</code>, we need to provide a value of type <code>DBType[A]</code>
which forces <code>A</code> to be a supported type.</p>
<p>A functor is, approximately, a type constructor <code>F</code> like <code>List</code>, <code>Option</code>, <code>DBValue</code>, &hellip;
for which you can write an instance of the trait</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>where <code>map(fa)(f)</code> applies the function <code>f</code> to any value of type <code>A</code> contained in <code>fa</code>.
For example:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">object</span> <span class="nc">OptionFunctor</span> <span class="k">extends</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">Option</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">Option</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">fa</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="nc">Some</span><span class="o">(</span><span class="n">a</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Some</span><span class="o">(</span><span class="n">f</span><span class="o">(</span><span class="n">a</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="k">case</span> <span class="nc">None</span> <span class="k">=&gt;</span> <span class="nc">None</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 2:</strong> Write an instance of <code>Functor[DBValue]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<p>We actually can not! If we try to compile the following code:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">DBValueFunctor</span> <span class="k">extends</span> <span class="nc">Functor</span><span class="o">[</span><span class="kt">DBValue</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="o">(</span><span class="n">fa</span><span class="o">.</span><span class="n">value</span><span class="o">))</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p><em>Scala</em> complains: <code>could not find implicit value for parameter dbType: DBType[B]</code>.
Indeed, booleans are not a supported type by the database: they are neither strings,
nor doubles, not pairs.
But if we could write a <code>Functor</code> instance for <code>DBValue</code>
(i.e. if we could write a <code>map</code> function for <code>DBValue</code>),
then we could write:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">val</span> <span class="n">dbValueString</span>  <span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">String</span><span class="o">]</span>  <span class="k">=</span> <span class="nc">DBValue</span><span class="o">(</span><span class="s">&#34;A&#34;</span><span class="o">)(</span><span class="nc">DBString</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">dbValueBoolean</span> <span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span> <span class="k">=</span> <span class="n">dbValueString</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="k">_</span> <span class="k">=&gt;</span> <span class="kc">true</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">dbTypeBoolean</span>  <span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">Boolean</span><span class="o">]</span>  <span class="k">=</span> <span class="n">dbValueBoolean</span><span class="o">.</span><span class="n">dbType</span></span></span></code></pre></div>
<p>We would get a value (<code>dbTypeBoolean</code>) of type <code>DBType[Boolean]</code>,
which would mean that the type <code>Boolean</code> is supported by the database.
But it is not! Furthermore, by definition:</p>
<blockquote>
<p>There exists a value of type <code>DBType[A]</code> <strong>if and only if</strong>
<code>A</code> is a type supported by the database.</p>
</blockquote>
<p>So it is impossible to have a value of type <code>DBType[Boolean]</code>
and thus it is impossible to write a function <code>map</code> for <code>DBValue</code>.
So there is no way to write a <code>Functor</code> instance for <code>DBValue</code>.</p>
  </details>
</li>
</ul>
<p>A <em>Generalized Functor</em> is very much like a regular <code>Functor</code>.
But whereas the <code>map</code> function of functors have to work for <strong>every</strong>
types <code>A</code> and <code>B</code>, the <code>map</code> function of <em>generalized functor</em>
can be narrowed to only operate on a limited set of types <code>A</code> and <code>B</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">P</span><span class="o">[</span><span class="k">_</span><span class="o">]</span>,<span class="kt">F</span><span class="o">[</span><span class="k">_</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">evA</span><span class="k">:</span> <span class="kt">P</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">evB</span><span class="k">:</span> <span class="kt">P</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">F</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>For example <code>Set</code> (more precisely <code>TreeSet</code>) is not a functor!
Indeed there is no way to write a function <code>map</code> that works for
any type <code>B</code> (because <code>B</code> need to have an ordering). But if we narrow
<code>map</code> to the only types <code>B</code> having an ordering, we can write it.</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">import</span> <span class="nn">scala.collection.immutable._</span>
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">TreeSetFunctor</span> <span class="k">extends</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">Ordering</span>, <span class="kt">TreeSet</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">TreeSet</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">evA</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">evB</span><span class="k">:</span> <span class="kt">Ordering</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">TreeSet</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">TreeSet</span><span class="o">.</span><span class="n">empty</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">evB</span><span class="o">)</span> <span class="o">++</span> <span class="n">fa</span><span class="o">.</span><span class="n">toSeq</span><span class="o">.</span><span class="n">map</span><span class="o">(</span><span class="n">f</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<ul>
<li>
<p><strong>Question 3:</strong> Write an instance of <code>GenFunctor[DBType, DBValue]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">DBValueGenFunctor</span> <span class="k">extends</span> <span class="nc">GenFunctor</span><span class="o">[</span><span class="kt">DBType</span>, <span class="kt">DBValue</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">map</span><span class="o">[</span><span class="kt">A</span>,<span class="kt">B</span><span class="o">](</span><span class="n">fa</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">A</span><span class="o">])(</span><span class="n">f</span><span class="k">:</span> <span class="kt">A</span> <span class="o">=&gt;</span> <span class="n">B</span><span class="o">)(</span><span class="k">implicit</span> <span class="n">evA</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">A</span><span class="o">],</span> <span class="n">evB</span><span class="k">:</span> <span class="kt">DBType</span><span class="o">[</span><span class="kt">B</span><span class="o">])</span><span class="k">:</span> <span class="kt">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">DBValue</span><span class="o">[</span><span class="kt">B</span><span class="o">](</span><span class="n">f</span><span class="o">(</span><span class="n">fa</span><span class="o">.</span><span class="n">value</span><span class="o">))(</span><span class="n">evB</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>What we have done to <code>Functor</code> can be done for many data-structures and patterns.
We can often limit the types on which a data-structure or a type-class can operate
by adding an extra parameter like <code>ev : DBType[A]</code> to constructors and methods.</p>
<h3 id="use-case-simplifying-implicits">Use Case: Simplifying Implicits</h3>
<p>This use case is one the most interesting but unfortunately, not one of the easiest. It
illustrates how it is possible to use <em>GADTs</em> to simplify the creation of implicit values.
In this example we consider lists of values whose items can be of different types. Theses
lists are called <em>heterogeneous lists</em>. They are usually defined in <em>Scala</em> almost like
normal lists:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HNil</span><span class="o">()</span> <span class="c1">// The empty list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="n">head</span><span class="k">:</span> <span class="kt">Head</span><span class="o">,</span> <span class="n">tail</span><span class="k">:</span> <span class="kt">Tail</span><span class="o">)</span> <span class="c1">// The `head :: tail` operation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">empty</span> <span class="k">:</span> <span class="kt">HNil</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">HNil</span><span class="o">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">oneTrueToto</span> <span class="k">:</span> <span class="kt">HCons</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">Boolean</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">String</span>, <span class="kt">HNil</span><span class="o">]]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">HCons</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="s">&#34;toto&#34;</span><span class="o">,</span> <span class="nc">HNil</span><span class="o">())))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">val</span> <span class="n">falseTrueFive</span><span class="k">:</span> <span class="kt">HCons</span><span class="o">[</span><span class="kt">Boolean</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">Boolean</span>, <span class="kt">HCons</span><span class="o">[</span><span class="kt">Int</span>, <span class="kt">HNil</span><span class="o">]]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="nc">HCons</span><span class="o">(</span><span class="kc">false</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="nc">HCons</span><span class="o">(</span><span class="mi">5</span><span class="o">,</span> <span class="nc">HNil</span><span class="o">())))</span></span></span></code></pre></div>
<p>As you can see, there is nothing special about it. We want to define
orderings on heterogeneous lists. An ordering is a way to compare two
values (<strong>of the same type!</strong>): they can be equal or one may be lesser
than the other. In <em>Scala</em> we can define the trait <code>Order</code>:</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">trait</span> <span class="nc">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// true if and only if a1 &lt; a2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">def</span> <span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// a1 and a2 are equal if and only if none of them is lesser than the other.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">final</span> <span class="k">def</span> <span class="n">areEqual</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="n">a2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a2</span><span class="o">,</span> <span class="n">a1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// a1 &gt; a2 if and only if a2 &lt; a1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">final</span> <span class="k">def</span> <span class="n">greaterThan</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="n">lesserThan</span><span class="o">(</span><span class="n">a2</span><span class="o">,</span> <span class="n">a1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">lesserThanOrEqual</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a2</span><span class="o">,</span> <span class="n">a1</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">def</span> <span class="n">greaterThanOrEqual</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="o">!</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span> <span class="n">a2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">Order</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">make</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="n">lg_</span> <span class="k">:</span> <span class="o">(</span><span class="kt">A</span><span class="o">,</span><span class="kt">A</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="nc">Boolean</span><span class="o">)</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">def</span> <span class="n">lesserThan</span><span class="o">(</span><span class="n">a1</span><span class="k">:</span> <span class="kt">A</span><span class="o">,</span> <span class="n">a2</span><span class="k">:</span> <span class="kt">A</span><span class="o">)</span><span class="k">:</span> <span class="kt">Boolean</span> <span class="o">=</span> <span class="n">lg_</span><span class="o">(</span><span class="n">a1</span><span class="o">,</span><span class="n">a2</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">val</span> <span class="n">orderInt</span>    <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">Int</span><span class="o">](</span><span class="k">_</span> <span class="o">&lt;</span> <span class="k">_</span><span class="o">)</span>
</span></span><span class="line"><span class="cl"><span class="k">implicit</span> <span class="k">val</span> <span class="n">orderString</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">String</span><span class="o">](</span><span class="k">_</span> <span class="o">&lt;</span> <span class="k">_</span><span class="o">)</span></span></span></code></pre></div>
<p>Remember that we will only compare lists of the <em>same type</em>:</p>
<ul>
<li>Lists of type <code>HNil</code> will only be compared to lists of type <code>HNil</code>.</li>
<li>Lists of type <code>HCons[H,T]</code> will only be compared to lists of type <code>HCons[H,T]</code>.</li>
</ul>
<p>Comparing lists of type <code>HNil</code> is trivial because there is only one value
of type <code>HNil</code> (the empty list <code>HNil()</code>).
But there are many ways of comparing lists of type <code>HCons[H,T]</code>.
Here are two possible orderings (there exists many more!):</p>
<ul>
<li>
<p>The <em>lexicographic ordering</em> (i.e. dictionary order: from left to right)</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>h1 &lt; h2</code> <em>or</em> (<code>h1 == h2</code> <em>and</em> <code>t1 &lt; t2</code> <em>by lexicographic ordering</em>).</p>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Lex</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">order</span> <span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">Lex</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">lexHNil</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Lex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">lexHCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">lexTail</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">Lex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Lex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">lexTail</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderHead</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</li>
<li>
<p>The <em>reverse-lexicographic</em> ordering, which is the reverse version
of the lexicographic ordering, (i.e. from right to left)</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>t1 &lt; t2</code> <em>by reverse-lexicographic ordering or</em> (<code>t1 == t2</code> <em>and</em> <code>h1 &lt; h2</code>).</p>
</blockquote>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">RevLex</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">order</span> <span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">RevLex</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">revLexHNil</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">RevLex</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">revLexHCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">revLexTail</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">RevLex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">RevLex</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">revLexTail</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderTail</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
</li>
</ul>
<p>As said above, it is possible to define more orderings:</p>
<ul>
<li>
<p><strong>Question 1:</strong> The <code>Alternate</code> ordering is defined by:</p>
<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>h1 &lt; h2</code> <em>or</em> (<code>h1 == h2</code> <em>and</em> <code>t1 &gt; t2</code> <em>by alternate ordering</em>).</p>
</blockquote>
<p>Just like what was done for <code>Lex</code> and <code>RevLex</code>,
implement the <code>Alternate</code> ordering.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">Alternate</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">val</span> <span class="n">order</span> <span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">object</span> <span class="nc">Alternate</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">alternateHNil</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Alternate</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">alternateHCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">alternateTail</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">Alternate</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="k">new</span> <span class="nc">Alternate</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">alternateTail</span><span class="o">.</span><span class="n">order</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">order</span> <span class="k">=</span> <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>, <span class="kt">Tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderHead</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderTail</span><span class="o">.</span><span class="n">greaterThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">}</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>There are lots of ways to define a valid ordering on heterogeneous lists!
Defining type classes like <code>Lex</code>, <code>RevLex</code> and <code>Alternate</code> for every ordering
we want to implement is clunky and messy. We can do much better than that &hellip;
with a <em>GADT</em> üòâ</p>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">sealed</span> <span class="k">trait</span> <span class="nc">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span>
</span></span><span class="line"><span class="cl"><span class="nc">object</span> <span class="nc">HListOrder</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">object</span> <span class="nc">HNilOrder</span> <span class="k">extends</span> <span class="nc">HListOrder</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">final</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">HConsOrder</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">hlistOrderTail</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span> <span class="k">extends</span> <span class="nc">HListOrder</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">]]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Implicit definitions
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">val</span> <span class="n">hnilOrder</span> <span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">HNilOrder</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">implicit</span> <span class="k">def</span> <span class="n">hconsOrder</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">](</span><span class="k">implicit</span>
</span></span><span class="line"><span class="cl">      <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">Head</span><span class="o">],</span>
</span></span><span class="line"><span class="cl">      <span class="n">hlistOrderTail</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">Tail</span><span class="o">]</span>
</span></span><span class="line"><span class="cl">    <span class="o">)</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">Head</span>,<span class="kt">Tail</span><span class="o">]]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">    <span class="nc">HConsOrder</span><span class="o">(</span><span class="n">orderHead</span><span class="o">,</span> <span class="n">hlistOrderTail</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">def</span> <span class="n">apply</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">ev</span><span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">ev.</span><span class="k">type</span> <span class="o">=</span> <span class="n">ev</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span></span></span></code></pre></div>
<p>Note that these implicit definitions are boilerplate. Their only purpose
is passing arguments to their corresponding constructor (i.e. <code>final case class</code>
or <code>case object</code>): <code>hnilOrder</code> to <code>HNilOrder</code> (O arguments) and <code>hconsOrder</code>
to <code>HConsOrder</code> (2 arguments).</p>
<ul>
<li>
<p><strong>Question 2:</strong> Write the function <code>def lex[A](implicit v : HListOrder[A]): Order[A]</code>
that computes the lexicographic ordering from a value of type <code>HListOrder[A]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">lex</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">v</span> <span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">HListOrder</span><span class="o">.</span><span class="nc">HNilOrder</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">hc</span> <span class="k">:</span> <span class="kt">HListOrder.HConsOrder</span><span class="o">[</span><span class="kt">head</span>,<span class="kt">tail</span><span class="o">]</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">head</span><span class="o">]</span> <span class="k">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">orderHead</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">lex</span><span class="o">(</span><span class="n">hc</span><span class="o">.</span><span class="n">hlistOrderTail</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">head</span>, <span class="kt">tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderHead</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
<li>
<p><strong>Question 3:</strong> Write the function <code>def revLex[A](implicit v : HListOrder[A]): Order[A]</code>
that computes the reverse-lexicographic ordering from a value of type <code>HListOrder[A]</code>.</p>
  <details>
    <summary><em>Solution (click to expand)</em></summary>
<div class="highlight wrap-code"><pre tabindex="0" class="chroma"><code class="language-scala" data-lang="scala"><span class="line"><span class="cl"><span class="k">def</span> <span class="n">revLex</span><span class="o">[</span><span class="kt">A</span><span class="o">](</span><span class="k">implicit</span> <span class="n">v</span> <span class="k">:</span> <span class="kt">HListOrder</span><span class="o">[</span><span class="kt">A</span><span class="o">])</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">A</span><span class="o">]</span> <span class="k">=</span>
</span></span><span class="line"><span class="cl">  <span class="n">v</span> <span class="k">match</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nc">HListOrder</span><span class="o">.</span><span class="nc">HNilOrder</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HNil</span><span class="o">]((</span><span class="k">_</span><span class="o">,</span><span class="k">_</span><span class="o">)</span> <span class="k">=&gt;</span> <span class="kc">false</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="n">hc</span> <span class="k">:</span> <span class="kt">HListOrder.HConsOrder</span><span class="o">[</span><span class="kt">head</span>,<span class="kt">tail</span><span class="o">]</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderHead</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">head</span><span class="o">]</span> <span class="k">=</span> <span class="n">hc</span><span class="o">.</span><span class="n">orderHead</span>
</span></span><span class="line"><span class="cl">      <span class="k">val</span> <span class="n">orderTail</span><span class="k">:</span> <span class="kt">Order</span><span class="o">[</span><span class="kt">tail</span><span class="o">]</span> <span class="k">=</span> <span class="n">revLex</span><span class="o">(</span><span class="n">hc</span><span class="o">.</span><span class="n">hlistOrderTail</span><span class="o">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nc">Order</span><span class="o">.</span><span class="n">make</span><span class="o">[</span><span class="kt">HCons</span><span class="o">[</span><span class="kt">head</span>, <span class="kt">tail</span><span class="o">]]</span> <span class="o">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">case</span> <span class="o">(</span><span class="nc">HCons</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">t1</span><span class="o">),</span> <span class="nc">HCons</span><span class="o">(</span><span class="n">h2</span><span class="o">,</span><span class="n">t2</span><span class="o">))</span> <span class="k">=&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="n">orderTail</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">||</span> <span class="o">(</span><span class="n">orderTail</span><span class="o">.</span><span class="n">areEqual</span><span class="o">(</span><span class="n">t1</span><span class="o">,</span><span class="n">t2</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">orderHead</span><span class="o">.</span><span class="n">lesserThan</span><span class="o">(</span><span class="n">h1</span><span class="o">,</span><span class="n">h2</span><span class="o">))</span>
</span></span><span class="line"><span class="cl">      <span class="o">}</span>
</span></span><span class="line"><span class="cl">  <span class="o">}</span></span></span></code></pre></div>
  </details>
</li>
</ul>
<p>This approach has several benefits. Whereas the initial approach had to find
one implicit by ordering, the <em>GADT</em> approach only have to find one! Considering
implicit resolution is a costly operation, reducing it means faster compilation times.
Reading the code of functions <code>lex</code> and <code>revLex</code> is easier than understanding how
implicit resolution works for traits <code>Lex</code> and <code>RevLex</code>. Furthermore, they are just
functions, you can use all you can code in building the instance <code>Order[A]</code>.</p>
<h2 id="conclusion">Conclusion</h2>
<p>Not so trivial, isn&rsquo;t it? üòâ Actually a fair amount
of the complexity you may have experienced comes to
the fact that reasoning about values and types is almost
never taught in programming courses.
What you consider simple now (web APIs, Streaming, Databases, etc)
would probably terrifies your younger self when you
were introduced for the first time to &ldquo;Hello World!&rdquo;.
You probably did not learn all you know in programming
in three hours so do not expect reasoning about programs
to be magically easier.</p>
<p>This workshop aimed at inspiring you, opening your mind
to this all new set of possibilities. If you found the use case
interesting, then take the time to understand the techniques.</p>
<p>Have fun and take care ‚ù§Ô∏è</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js?1731043964" defer></script>
    <script src="../../js/perfect-scrollbar.min.js?1731043964" defer></script>
    <script>
      function useMathJax( config ){
        window.MathJax = Object.assign( window.MathJax || {}, {
          tex: {
            inlineMath:  [['\\(', '\\)'], ['$',  '$']],  
            displayMath: [['\\[', '\\]'], ['$$', '$$']], 
          },
          options: {
            enableMenu: false 
          }
        }, config );
      }
      useMathJax( JSON.parse("{}") );
    </script>
    <script id="MathJax-script" async src="../../js/mathjax/tex-mml-chtml.js?1731043964"></script>
    <script src="../../js/theme.js?1731043964" defer></script>
  </body>
</html>
