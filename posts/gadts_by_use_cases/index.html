<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.58.0" />
    <meta name="description" content="@chrilves&#39; Archives">
<meta name="author" content="@chrilves">

    <link rel="icon" href="https://chrilves.github.io/images/favicon.png" type="image/png">

    <title>GADTs By Use Cases :: @chrilves&#39; Archives</title>

    
    <link href="https://chrilves.github.io/css/nucleus.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/fontawesome-all.min.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/hybrid.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/featherlight.min.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/perfect-scrollbar.min.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/auto-complete.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/atom-one-dark-reasonable.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/theme.css?1572061108" rel="stylesheet">
    <link href="https://chrilves.github.io/css/hugo-theme.css?1572061108" rel="stylesheet">
    

    <script src="https://chrilves.github.io/js/jquery-3.3.1.min.js?1572061108"></script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_SVG"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
    </style>
    
  </head>
  <body class="" data-url="/posts/gadts_by_use_cases/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="https://chrilves.github.io/">
<svg
   xmlns:dc="http://purl.org/dc/elements/1.1/"
   xmlns:cc="http://creativecommons.org/ns#"
   xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
   xmlns:svg="http://www.w3.org/2000/svg"
   xmlns="http://www.w3.org/2000/svg"
   xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"
   xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"
   width="65mm"
   height="7mm"
   viewBox="0 0 96.990127 7.7258329"
   version="1.1"
   id="svg8"
   sodipodi:docname="logo.svg"
   inkscape:version="0.92.3 (2405546, 2018-03-11)">
  <defs
     id="defs2" />
  <sodipodi:namedview
     id="base"
     pagecolor="#ffffff"
     bordercolor="#666666"
     borderopacity="1.0"
     inkscape:pageopacity="0.0"
     inkscape:pageshadow="2"
     inkscape:zoom="2.8"
     inkscape:cx="193.2115"
     inkscape:cy="-34.320002"
     inkscape:document-units="mm"
     inkscape:current-layer="layer1"
     showgrid="false"
     fit-margin-top="0"
     fit-margin-left="0"
     fit-margin-right="0"
     fit-margin-bottom="0"
     inkscape:window-width="1920"
     inkscape:window-height="1026"
     inkscape:window-x="0"
     inkscape:window-y="0"
     inkscape:window-maximized="1" />
  <metadata
     id="metadata5">
    <rdf:RDF>
      <cc:Work
         rdf:about="">
        <dc:format>image/svg+xml</dc:format>
        <dc:type
           rdf:resource="http://purl.org/dc/dcmitype/StillImage" />
        <dc:title></dc:title>
      </cc:Work>
    </rdf:RDF>
  </metadata>
  <g
     inkscape:label="Calque 1"
     inkscape:groupmode="layer"
     id="layer1"
     transform="translate(-8.9716412,-5.0276302)">
    <text
       xml:space="preserve"
       style="font-style:normal;font-weight:normal;font-size:10.58333302px;line-height:1.25;font-family:sans-serif;letter-spacing:0px;word-spacing:0px;fill:#000000;fill-opacity:1;stroke:none;stroke-width:0.26458332"
       x="8.3895578"
       y="12.61588"
       id="text4543"><tspan
         sodipodi:role="line"
         id="tspan4541"
         x="8.3895578"
         y="12.61588"
         style="font-style:normal;font-variant:normal;font-weight:normal;font-stretch:normal;font-family:'TeX Gyre Bonum';-inkscape-font-specification:'TeX Gyre Bonum';stroke-width:0.26458332;fill:#ffffff">@chrilves' Archives</tspan></text>
  </g>
</svg>
</a>
    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="https://chrilves.github.io/js/lunr.min.js?1572061108"></script>
<script type="text/javascript" src="https://chrilves.github.io/js/auto-complete.js?1572061108"></script>
<script type="text/javascript">
    
        var baseurl = "https:\/\/chrilves.github.io";
    
</script>
<script type="text/javascript" src="https://chrilves.github.io/js/search.js?1572061108"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/posts/" title="Posts" class="dd-item 
        parent
        
        
        ">
      <a href="https://chrilves.github.io/posts/">
          Posts
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/posts/gadts_by_use_cases/" title="GADTs By Use Cases" class="dd-item active">
        <a href="https://chrilves.github.io/posts/gadts_by_use_cases/">
        GADTs By Use Cases
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/auto_batch/" title="10 Tips for Fast Stack-safe Functional code: the Automatic-Batching experience" class="dd-item ">
        <a href="https://chrilves.github.io/posts/auto_batch/">
        10 Tips for Fast Stack-safe Functional code: the Automatic-Batching experience
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/prime/" title="Proving Primality with GADTs" class="dd-item ">
        <a href="https://chrilves.github.io/posts/prime/">
        Proving Primality with GADTs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/recursion_schemes_intro/" title="Recursion Schemes: the high-school introduction" class="dd-item ">
        <a href="https://chrilves.github.io/posts/recursion_schemes_intro/">
        Recursion Schemes: the high-school introduction
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/gadts_intro/" title="Demystifying GADTs" class="dd-item ">
        <a href="https://chrilves.github.io/posts/gadts_intro/">
        Demystifying GADTs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/folds/" title="Let&#39;s meet the charming fold family" class="dd-item ">
        <a href="https://chrilves.github.io/posts/folds/">
        Let&#39;s meet the charming fold family
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/slimetrail/" title="How to make game in the browser thanks to ScalaJS" class="dd-item ">
        <a href="https://chrilves.github.io/posts/slimetrail/">
        How to make game in the browser thanks to ScalaJS
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/json2xml/" title="JSON to XML: the probably a tiny bit over engineered way" class="dd-item ">
        <a href="https://chrilves.github.io/posts/json2xml/">
        JSON to XML: the probably a tiny bit over engineered way
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/posts/falgebra_scalaio_2017/" title="F-Algebra talk at ScalaIO 2017: Modéliser astucieusement vos données" class="dd-item ">
        <a href="https://chrilves.github.io/posts/falgebra_scalaio_2017/">
        F-Algebra talk at ScalaIO 2017: Modéliser astucieusement vos données
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/types/" title="Introduction to Types" class="dd-item 
        
        
        
        ">
      <a href="https://chrilves.github.io/types/">
          Introduction to Types
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/types/1-why/" title="Episode 1 - Why Types?" class="dd-item ">
        <a href="https://chrilves.github.io/types/1-why/">
        Episode 1 - Why Types?
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/types/2-enums/" title="Episode 2 - Enumerations" class="dd-item ">
        <a href="https://chrilves.github.io/types/2-enums/">
        Episode 2 - Enumerations
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/types/3-products/" title="Episode 3 - Products" class="dd-item ">
        <a href="https://chrilves.github.io/types/3-products/">
        Episode 3 - Products
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/types/4-coproducts/" title="Episode 4 - CoProducts" class="dd-item ">
        <a href="https://chrilves.github.io/types/4-coproducts/">
        Episode 4 - CoProducts
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/types/5-rectypes/" title="Episode 5 - Recursive Data Types" class="dd-item ">
        <a href="https://chrilves.github.io/types/5-rectypes/">
        Episode 5 - Recursive Data Types
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
              
    </li>
  
 

          
         
    </ul>

    
    
      <section id="shortcuts">
        <h3>More</h3>
        <ul>
          
              <li> 
                  <a class="padding" href="https://github.com/chrilves"><i class='fab fa-fw fa-github'></i> Github</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://www.linkedin.com/in/christophe-calv%C3%A8s-ab6325b0/"><i class='fab fa-fw fa-linkedin'></i> LinkedIn</a>
              </li>
          
              <li> 
                  <a class="padding" href="https://twitter.com/chrilves"><i class='fab fa-fw fa-twitter'></i> Twitter</a>
              </li>
          
        </ul>
      </section>
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      
      
      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      </ul>
    </section>
    
    <section id="footer">
      <p>Built with <a href="https://github.com/matcornic/hugo-theme-learn"><i class="fas fa-heart"></i></a> from <a href="https://getgrav.org">Grav</a> and <a href="https://gohugo.io/">Hugo</a></p>

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                  
                  
                  
                  <div id="top-github-link">
                    <a class="github-link" title='Edit this page' href="https://github.com/chrilves/chrilves.github.io/edit/master/hugo/posts/gadts_by_use_cases.md" target="blank">
                      <i class="fas fa-code-branch"></i>
                      <span id="top-github-link-text">Edit this page</span>
                    </a>
                  </div>
                  
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt"></i></span>
                  
                  <span class="links">
                 
                 
                   GADTs By Use Cases 
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
<nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#acknowledgements">Acknowledgements</a></li>
<li><a href="#readme">README</a></li>
<li><a href="#stretching">Stretching</a>
<ul>
<li><a href="#values-and-types"><em>Values</em> and <em>Types</em>?</a></li>
<li><a href="#how-many-types">How many types?</a></li>
<li><a href="#how-many-values">How many values?</a></li>
</ul></li>
<li><a href="#first-contact">First Contact</a>
<ul>
<li><a href="#use-case-evidence-of-some-property">Use Case: Evidence of some property</a></li>
<li><a href="#use-case-the-only-thing-i-know-is-it-exists">Use Case: The only thing I know is it exists</a></li>
<li><a href="#intermediary-conclusion">Intermediary Conclusion</a></li>
</ul></li>
<li><a href="#easy-useful-use-cases-relations-on-types">Easy Useful Use Cases: Relations on Types</a>
<ul>
<li><a href="#use-case-witnessing-type-equality">Use Case: Witnessing Type Equality</a>
<ul>
<li><a href="#switching-between-equal-types">Switching between equal types</a></li>
</ul></li>
<li><a href="#use-case-witnessing-sub-typing">Use Case: Witnessing Sub Typing</a></li>
<li><a href="#use-case-avoiding-annoying-scalac-error-messages-about-bounds-not-respected">Use Case: Avoiding annoying <em>scalac</em> error messages about bounds not respected</a></li>
<li><a href="#use-case-give-the-right-data-to-the-right-chart">Use Case: Give the right data to the right chart</a></li>
</ul></li>
<li><a href="#more-advanced-use-cases">More Advanced Use Cases</a>
<ul>
<li><a href="#use-case-effects">Use Case: Effects!</a></li>
<li><a href="#use-case-ensuring-types-are-supported-by-the-database">Use Case: Ensuring types are supported by the Database</a></li>
<li><a href="#use-case-simplifying-implicits">Use Case: Simplifying Implicits</a></li>
</ul></li>
<li><a href="#conclusion">Conclusion</a></li>
</ul></li>
</ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            <h1>
              
              GADTs By Use Cases
            </h1>
          

        





<p>Welcome. This session will introduce you to a very powerful tool in
programming. Whereas most introduction start by presenting its
theoretical foundations in a very formal way, we chose to present
it via short examples and practical use cases.</p>

<p>This workshop is made of three parts. The last one presents three
of the most valuable use cases. They are the real big powerful use cases.
But do not go there unprepared! This is the last part for a reason:
they rely massively on lessons you will learn in the previous parts.
Start <a href="#first-contact">First Contact</a>, it will show
you, via the simplest examples, the core ideas. Its goal is to open your
mind to ways of using types and data you may have never imagined possible.
Then go to
<a href="#easy-useful-use-cases-relations-on-types">Easy Useful Use Cases: Relations on Types</a>,
for the first real-life challenge.
Then you are ready for <a href="#more-advanced-use-cases">More Advanced Use Cases</a>.</p>

<p>Be sure to <strong>read <a href="#readme">README</a></strong>, it contains precious tips to ease your
journey.</p>

<h2 id="acknowledgements">Acknowledgements</h2>

<p>We would like to thank <a href="http://www.laure-juglaret.fr/">Laure Juglaret</a> for
having reviewed this presentation many times, for her precious remarks and
corrections.</p>

<h2 id="readme">README</h2>

<p>In this presentation we will assume that:</p>

<ul>
<li><code>null</code> <strong>does not exists!</strong></li>
<li><strong>runtime-reflection does not exist!</strong> (i.e. <code>isInstanceOf</code>, <code>getClass</code>, etc)</li>
</ul>

<p>This presentation considers that <em>these features do not exists at all</em>.</p>

<p><strong>Using these features will never lead to a valid answer</strong>.</p>

<p>This presentation expects you to have access to something where
you can easily write, compile and run <em>Scala</em> code. The best way to do so
is opening a <em>R.E.P.L.</em> session. If you have <em>Scala</em> installed on your system,
you can easily start one from the command-line by executing <code>scala</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">system<span style="color:#f92672">-</span>command<span style="color:#f92672">-</span>line<span style="color:#66d9ef">#</span> scala
<span style="color:#a6e22e">Welcome</span> to <span style="color:#a6e22e">Scala</span> <span style="color:#ae81ff">2.13</span><span style="color:#f92672">.</span><span style="color:#ae81ff">1</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">OpenJDK</span> <span style="color:#ae81ff">64</span><span style="color:#f92672">-</span><span style="color:#a6e22e">Bit</span> <span style="color:#a6e22e">Server</span> <span style="color:#a6e22e">VM</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">Java</span> <span style="color:#ae81ff">1.8</span><span style="color:#f92672">.</span><span style="color:#ae81ff">0</span>_222<span style="color:#f92672">).</span>
<span style="color:#a6e22e">Type</span> in expressions <span style="color:#66d9ef">for</span> evaluation<span style="color:#f92672">.</span> <span style="color:#a6e22e">Or</span> <span style="color:#66d9ef">try</span> <span style="color:#66d9ef">:</span><span style="color:#66d9ef">help.</span>

<span style="color:#66d9ef">scala&gt;</span></code></pre></div>
<p>If you don&rsquo;t have <em>Scala</em> installed, you can use the <em>online-REPL</em>
<a href="https://scastie.scala-lang.org/">https://scastie.scala-lang.org/</a> .</p>

<h2 id="stretching">Stretching</h2>

<p>This section is a brief reminder of some definitions and properties
about values and types.</p>

<h3 id="values-and-types"><em>Values</em> and <em>Types</em>?</h3>

<p><strong>Values</strong> are <em>actual piece of data your program manipulates</em>
like the integer <code>5</code>, the boolean <code>true</code>, the string <code>&quot;Hello World!&quot;</code>,
the function <code>(x: Double) =&gt; x / 7.5</code>, the list <code>List(1,2,3)</code>, etc.
We often like to classify values into groups. These groups are called
<strong>types</strong>. For example:</p>

<ul>
<li><code>Int</code> is the group of integer values, i.e. values like <code>1</code>, <code>-7</code>, <code>19</code>, etc.</li>
<li><code>Boolean</code> is the group containing exactly the values
<code>true</code> and <code>false</code> (no more, no less!).</li>
<li><code>String</code> is the group whose values are <code>&quot;Hello World!&quot;</code>, <code>&quot;&quot;</code>, <code>&quot;I ❤️ GADTs&quot;</code>, etc.</li>
<li><code>Double =&gt; Double</code> is the group whose values are functions taking
any <code>Double</code> as argument and returning some <code>Double</code>.</li>
</ul>

<p>To indicate that the value <code>v</code> belongs to the type (i.e. group of values) <code>T</code>,
we write <code>v : T</code>. In <em>Scala</em>, testing if a value <code>v</code> belongs to a type <code>T</code>
is very simple: just type <code>v : T</code> in the <em>REPL</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span>
res7<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span></code></pre></div>
<p>If <em>Scala</em> accepts it, then <code>v</code> belongs to <code>T</code>. If <em>Scala</em> complains,
it most probably does not :</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span>
       <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">mismatch</span><span style="color:#f92672">;</span>
        found   <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span><span style="color:#f92672">(</span><span style="color:#960050;background-color:#1e0010">5</span><span style="color:#f92672">)</span>
        <span style="color:#66d9ef">required:</span> <span style="color:#66d9ef">String</span></code></pre></div>
<h3 id="how-many-types">How many types?</h3>

<p>Let&rsquo;s now create some types and some of their values (when possible!).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OneType</span></code></pre></div>
<ul>
<li><p><strong>Question 1:</strong> How many types does the line <code>class OneType</code> defines?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>As the name suggests, <code>class OneType</code> defines only one type which is named <code>OneType</code>.
</details></p></li>
</ul>

<p>Let&rsquo;s now consider:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">OneTypeForEvery</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span></code></pre></div>
<ul>
<li><p><strong>Question 2:</strong> How many types does the line <code>class OneTypeForEvery[A]</code> defines?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>As the name suggests, every concrete type <code>A</code> give rise to a distinct type <code>OneTypeForEvery[A]</code>.</p>

<p>For example, a list of integers is neither a list of booleans, nor a list of strings,
  nor a list of functions, nor &hellip; It means the types <code>List[Int]</code>, <code>List[Boolean]</code>,
  <code>List[Int =&gt; Int]</code>, etc are all distinct types.</p>

<p>The line <code>class OneTypeForEvery[A]</code> defines a <strong>distinct type for every concrete type</strong> <code>A</code>. There
  is an infnity of concrete types <code>A</code>, so an infinity of distinct types <code>OneTypeForEvery[A]</code>.
</details></p></li>

<li><p><strong>Question 3:</strong> Give a value that belongs to both <code>OneTypeForEvery[Int]</code> and <code>OneTypeForEvery[Boolean]</code>.</p>

<p><strong>Remember that <code>null</code> does not exist!</strong></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary>
  This is actually impossible. Every concrete type <code>A</code> give rise a distinct type <code>OneTypeForEvery[A]</code>
  that have no values in common with others types <code>OneTypeForEvery[B]</code> for <code>B ≠ A</code>.
</details></p></li>
</ul>

<h3 id="how-many-values">How many values?</h3>

<p>Considering the following type:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">abstract</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">NoValueForThisType</span></code></pre></div>
<ul>
<li><p><strong>Question 1:</strong> Give a value belonging to the type <code>NoValueForThisType</code>?
How many values belong to <code>NoValueForThisType</code>?</p>

<p><details>
  <summary><em>Hint (click to expand)</em></summary></p>

<ul>
<li>What is a <code>final</code> class? How does it differ from a normal non-final class?</li>
<li>What is an <code>abstract</code> class? How does it differ from a concrete class?
</details></li>
</ul>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>The class <code>NoValueForThisType</code> is declared <code>abstract</code>. It is then forbidden to create
  a direct instance of this class:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">  scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">NoValueForThisType</span>
         <span style="color:#f92672">^</span>
         error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">NoValueForThisType</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">abstract</span><span style="color:#f92672">;</span> cannot be instantiated</code></pre></div>
<p>The only way to create an instance of an abstract class is creating a concrete sub-class.
  But the keyword <code>final</code> forbids creating such sub-classes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">  scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ConcreteSubClass</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">NoValueForThisType</span>
                                         <span style="color:#f92672">^</span>
         error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">illegal</span> <span style="color:#66d9ef">inheritance</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">class</span> <span style="color:#66d9ef">NoValueForThisType</span></code></pre></div>
<p>There is no way to create an instance of <code>NoValueForThisType</code>.
</details></p></li>
</ul>

<p>Let&rsquo;s take another example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ExactlyOneValue</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">TheOnlyValue</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExactlyOneValue</span></code></pre></div>
<ul>
<li><p><strong>Question 2:</strong> Give a value belonging to the type <code>ExactlyOneValue</code>?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>By definition, <code>TheOnlyValue</code> is a value of type <code>ExactlyOneValue</code>.
</details></p></li>

<li><p><strong>Question 3:</strong> How many values belong to <code>ExactlyOneValue</code>?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>Just like above, <code>ExactlyOneValue</code>, being a <code>trait</code>, is <em>abstract</em>. Being <code>sealed</code>,
  extending it outside of its defining file is forbidden.
  So <code>TheOnlyValue</code> is the only value of type <code>ExactlyOneValue</code>.
</details></p></li>
</ul>

<h2 id="first-contact">First Contact</h2>

<p>This part presents the core ideas. There are actually
only two ideas! What you will find here are stripped down
examples to illustrate each of these ideas.</p>

<h3 id="use-case-evidence-of-some-property">Use Case: Evidence of some property</h3>

<p>Let&rsquo;s define a simple <em>sealed trait</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">AValue</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Char</span><span style="color:#f92672">]</span></code></pre></div>
<ul>
<li><p><strong>Question 1:</strong> Give a value of type <code>ATrait[Char]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>By definition, <code>AValue</code> is a value of type <code>ATrait[Char]</code>.
</details></p></li>

<li><p><strong>Question 2:</strong> Give a value of type <code>ATrait[Double]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>There is no way to have an instance of type <code>ATrait[Double]</code>.
  There is actually no way to have an instance of type <code>ATrait[B]</code> for <code>B ≠ Char</code>
  because the only possible value is <code>AValue</code> which is of type <code>ATrait[Char]</code>.
</details></p></li>

<li><p><strong>Question 3:</strong> What can you conclude about a type <code>A</code> if you have a value
<code>ev</code> of type <code>ATrait[A]</code> (i.e. <code>ev: ATrait[A]</code>)?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>The only possible value is <code>AValue</code>, so <code>ev == AValue</code>.
Furthermore <code>AValue</code> is of type <code>ATrait[Char]</code> so <code>A = Char</code>.</p>

<p></details></p></li>

<li><p><strong>Question 4:</strong> In the <em>REPL</em>, enter the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span>
  x</code></pre></div></li>

<li><p><strong>Question 5:</strong> Now try pattern matching on <code>ev: ATrait[A]</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span>
  ev <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">AValue</span> <span style="color:#66d9ef">=&gt;</span> x
  <span style="color:#f92672">}</span></code></pre></div>
<p>Is the pattern-matching exhaustive?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>The pattern-matching is exhaustive because the only possible actual
  value for <code>ev</code> is <code>AValue</code>. Furthermore <code>AValue</code> is of type <code>ATrait[Char]</code>
  which means <code>ev : ATrait[Char]</code> because <code>ev == AValue</code>. So <code>A = Char</code> and <code>x : Char</code>.
</details></p></li>

<li><p><strong>Question 6:</strong> Call <code>f</code> with <code>x = 'w' : Char</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">Char</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#39;w&#39;</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">AValue</span><span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span> w</code></pre></div>
<p></details></p></li>

<li><p><strong>Question 7:</strong> Call <code>f</code> with <code>x =  5.2 : Double</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>This is impossible because it would require to give a value
<code>ev : ATrait[Double]</code> which does not exist!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">](</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">AValue</span><span style="color:#f92672">)</span>
                    <span style="color:#f92672">^</span>
          error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">mismatch</span><span style="color:#f92672">;</span>
            found   <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AValue.type</span>
            required<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ATrait</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span></code></pre></div>
<p></details></p></li>
</ul>

<p><details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em> </summary></p>

<p>Using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">IsChar</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Evidence</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Char</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> evidence<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    evidence
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A:</span> <span style="color:#66d9ef">IsChar</span><span style="color:#f92672">](</span>x<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Char</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">IsChar</span><span style="color:#f92672">.</span><span style="color:#a6e22e">Evidence</span> <span style="color:#66d9ef">=&gt;</span> x
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<h3 id="use-case-the-only-thing-i-know-is-it-exists">Use Case: The only thing I know is it exists</h3>

<p>What would you do if you wanted your codebase to log messages, but you want to be sure your
codebase do not rely on any implementation details of the logger so that you can change its
implementation without risking breaking the codebase?</p>

<p>Take the following logger type <code>UnknownLogger</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">UnknownLogger</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> appendMessage<span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> X<span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">UnknownLogger</span></code></pre></div>
<p>The first logger we will create stores the logs in a <code>String</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> loggerStr <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">](</span><span style="color:#e6db74">&#34;&#34;</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> logs <span style="color:#f92672">++</span> message<span style="color:#f92672">)</span></code></pre></div>
<p>The second logger stores them in a <code>List[String]</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> loggerList <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]](</span><span style="color:#a6e22e">Nil</span><span style="color:#f92672">,</span> <span style="color:#f92672">(</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">List</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">],</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> message <span style="color:#66d9ef">:</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">logs</span><span style="color:#f92672">)</span></code></pre></div>
<p>The third logger directly print the messages to the standard output:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> loggerStdout <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]((),</span> <span style="color:#f92672">(</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> println<span style="color:#f92672">(</span>message<span style="color:#f92672">))</span></code></pre></div>
<p>Note that these three loggers all have the same type (i.e. <code>UnknownLogger</code>) but they store
the logs using different types <code>X</code> (<code>String</code>, <code>List[String]</code> and <code>Unit</code>).</p>

<ul>
<li><p><strong>Question 1:</strong> Let <code>v</code> be a value of type <code>UnknownLogger</code>.
Clearly <code>v</code> has to be an instance of the class <code>LogWith[X]</code> for some type <code>X</code>.
What can you say about the type <code>X</code>? Can you figure out which type <code>X</code> actually is?</p>

<p><strong>Remember we refuse to use runtime-reflection!</strong> (i.e. <code>isInstanceOf</code>, <code>getClass</code>, etc)</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>We know almost nothing about <code>X</code>. The only thing we know is there exists at least
one value (<code>v.logs</code>) of type <code>X</code>. Appart from that, <code>X</code> can be any type.</p>

<p>Not knowing which type is actually <code>X</code> is very useful to guarantee that the code that will
use <code>v : UnknownLogger</code> will not rely on the nature of <code>X</code>. If the code knew <code>X</code> was
<code>String</code> for example, it could perform some operations we want to forbid like reversing
the list, taking only the <em>nth</em> first characters, etc. By hiding the real type <code>X</code>, we force
our codebase to not depend on what <code>X</code> is but to use the provided <code>v.appendMessage</code>.
So changing the real implementation of the logger won&rsquo;t break any code.</p>

<p></details></p></li>

<li><p><strong>Question 2:</strong> Write the function <code>def log(message: String, v: UnknownLogger): UnknownLogger</code>
that uses <code>v.appendMessage</code> to append <code>message</code> to <code>v.logs</code>
and returns a new <code>UnknownLogger</code> containing the new logs.</p>

<p>Remember that in <em>Scala</em>, the following pattern (i.e. <code>ac : AClass[t]</code>) is allowed
in <code>match/case</code> expressions:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AClass</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span>

<span style="color:#66d9ef">def</span> f<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>v<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AClass</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> ac <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AClass</span><span style="color:#f92672">[</span><span style="color:#66d9ef">t</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#75715e">// The variable `t` is a type variable
</span><span style="color:#75715e"></span>      <span style="color:#75715e">// The type `t` is equal to `A`
</span><span style="color:#75715e"></span>      <span style="color:#66d9ef">val</span> r <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">t</span> <span style="color:#f92672">=</span> ac<span style="color:#f92672">.</span>value
      r
  <span style="color:#f92672">}</span></code></pre></div>
<p>Its main benefit is introducing the type variable <code>t</code>.
Type variables work like normal pattern variables except that they represent types
instead of values. Having <code>t</code> enable us to help the compiler by giving explicit types
(like just above, saying <code>r</code> is of type <code>t</code>).</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> log<span style="color:#f92672">(</span>message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">,</span> v<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> vx <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">x</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">x</span><span style="color:#f92672">](</span>vx<span style="color:#f92672">.</span>appendMessage<span style="color:#f92672">(</span>vx<span style="color:#f92672">.</span>logs<span style="color:#f92672">,</span> message<span style="color:#f92672">),</span> vx<span style="color:#f92672">.</span>appendMessage<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 3:</strong> Execute <code>log(&quot;Hello World&quot;, loggerStr)</code> and <code>log(&quot;Hello World&quot;, loggerList)</code>
and <code>log(&quot;Hello World&quot;, loggerStdout)</code></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">,</span> loggerStr<span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Hello</span> <span style="color:#a6e22e">World</span><span style="color:#f92672">,</span><span style="color:#a6e22e">$$Lambda$988</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1455466014</span><span style="color:#66d9ef">@</span><span style="color:#ae81ff">421</span>ead7e<span style="color:#f92672">)</span>

scala<span style="color:#f92672">&gt;</span> log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">,</span> loggerList<span style="color:#f92672">)</span>
res1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">(</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#a6e22e">Hello</span> <span style="color:#a6e22e">World</span><span style="color:#f92672">),</span><span style="color:#a6e22e">$$Lambda$989</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1705282731</span><span style="color:#66d9ef">@</span><span style="color:#ae81ff">655621</span>fd<span style="color:#f92672">)</span>

scala<span style="color:#f92672">&gt;</span> log<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;Hello World&#34;</span><span style="color:#f92672">,</span> loggerStdout<span style="color:#f92672">)</span>
<span style="color:#a6e22e">Hello</span> <span style="color:#a6e22e">World</span>
res2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">((),</span><span style="color:#a6e22e">$$Lambda$990</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1835105031</span><span style="color:#66d9ef">@</span><span style="color:#ae81ff">340</span>c57e0<span style="color:#f92672">)</span></code></pre></div>
<p></details></p></li>
</ul>

<p><details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em> </summary></p>

<p>Once again, using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">UnknownLogger</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">LogsType</span>
  <span style="color:#66d9ef">val</span> logs <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span>
  <span style="color:#66d9ef">def</span> appendMessage<span style="color:#f92672">(</span>presentLogs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">UnknownLogger</span> <span style="color:#f92672">{</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> appendMessage_ <span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> X<span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">UnknownLogger</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">LogsType</span> <span style="color:#f92672">=</span> X
    <span style="color:#66d9ef">def</span> appendMessage<span style="color:#f92672">(</span>presentLogs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span><span style="color:#f92672">,</span> message<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">LogsType</span> <span style="color:#f92672">=</span>
      appendMessage_<span style="color:#f92672">(</span>presentLogs<span style="color:#f92672">,</span> message<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> appendMessage<span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">X</span><span style="color:#f92672">,</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> X<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">UnknownLogger</span> <span style="color:#f92672">=</span>
    <span style="color:#a6e22e">LogWith</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">](</span>logs<span style="color:#f92672">,</span> appendMessage<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<h3 id="intermediary-conclusion">Intermediary Conclusion</h3>

<p><em>GADTs</em> are actually only this: simple <em>sealed trait</em> with some
<em>case object</em> (possibly none) and some <em>final case class</em> (possible none too!).
In the following parts we will explore some major use cases of <em>GADTs</em></p>

<h2 id="easy-useful-use-cases-relations-on-types">Easy Useful Use Cases: Relations on Types</h2>

<p>One easy but very useful benefit of <em>GADTs</em> is expressing relations about types such that:</p>

<ul>
<li>Is type <code>A</code> equal to type <code>B</code>?</li>
<li>Is type <code>A</code> a sub-type of <code>B</code>?</li>
</ul>

<p>Note that, by definition, a type <code>A</code> is a sub-type of itself (i.e. <code>A &lt;: A</code>),
very much like an integer <code>x</code> is also lesser-than-or-equal to itself <code>x ≤ x</code>.</p>

<h3 id="use-case-witnessing-type-equality">Use Case: Witnessing Type Equality</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span></code></pre></div>
<ul>
<li><p><strong>Question 1:</strong> Give a value of type <code>EqT[Int, Int]</code></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>,<span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">()</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 2:</strong> Give a value of type <code>EqT[String, Int]</code></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>The class <code>Evidence</code> is the only concrete sub-class of trait <code>EqT</code> and we cannot
  create another one because <code>EqT</code> is <code>sealed</code>. So any value <code>v : EqT[A,B]</code> has to be
  an instance of <code>Evidence[X]</code> for some type <code>X</code>, which is of type <code>EqT[X,X]</code>.
  Thus there is no way to get a value of type <code>EqT[String, Int]</code>.</p>

<p></details></p></li>

<li><p><strong>Question 3:</strong> Given two (unknown) types <code>A</code> and <code>B</code>.
What can you conclude if I give you a value of type <code>EqT[A,B]</code>?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>If I give you a value <code>v : EqT[A,B]</code>, then you know that <code>v</code> is an instance of
  <code>Evidence[X]</code> for some type <code>X</code> because the class <code>Evidence</code> is the only concrete
  sub-class of the sealed trait <code>EqT</code>. Actually <code>Evidence[X]</code> is a sub-type of
  <code>EqT[X,X]</code>. Thus <code>v : EqT[X,X]</code>. Types <code>EqT[A,B]</code> and <code>EqT[X,X]</code> have no value in
  common if <code>A ≠ X</code> or <code>B ≠ X</code>, so <code>A = X</code> and <code>B = X</code>. Thus <code>A = B</code>.</p>

<p></details></p></li>
</ul>

<p><details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em> </summary></p>

<p>In production, it is convenient to define the following equivalent code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">EqT</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> evidence<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]()</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<h4 id="switching-between-equal-types">Switching between equal types</h4>

<p>If <code>A</code> and <code>B</code> are actually the same type, then <code>List[A]</code> is also the
same type as <code>List[B]</code>, <code>Option[A]</code> is also the same type as <code>Option[B]</code>,
etc. More generally, for any <code>F[_]</code>, <code>F[A]</code> is also the same type as <code>F[B]</code>.</p>

<ul>
<li><p><strong>Question 4:</strong> Write the function <code>def coerce[F[_],A,B](eqT: EqT[A,B])(fa: F[A]): F[B]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> coerce<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span>,<span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])(</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  eqT <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">x</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span> fa
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<p>The <em>Scala</em> standard library already defines a class, named <code>=:=[A,B]</code>
(yes, its name is really <code>=:=</code>), representing type equality.
You&rsquo;re strongly encouraged to have a quick look
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html">at its documentation (click here)</a>.
Thankfully, <em>Scala</em> enables to write <code>A =:= B</code> instead of <code>=:=[A,B]</code>.</p>

<p>Given two types <code>A</code> and <code>B</code>, having an instance (i.e. object)
of <code>A =:= B</code> means that <code>A</code> and <code>B</code> are actually the same type,
just like with <code>EqT[A,B]</code>.
Remember that <code>A =:= B</code> is just syntactic sugar for <code>=:=[A,B]</code>.</p>

<p>Instances of <code>A =:= B</code> can be created by the function
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less$.html#refl[A]:A=:=A"><code>(&lt;:&lt;).refl[X]: X =:= X</code>
(click for docs)</a>.
The &ldquo;symbol&rdquo; <code>&lt;:&lt;</code> is indeed a valid name for an object.</p>

<ul>
<li><p><strong>Question 5:</strong> Using the function <code>coerce</code> above,
write the function <code>def toScalaEq[A,B](eqT: EqT[A,B]): A =:= B</code>.</p>

<p><details>
  <summary><em>Hint (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> toScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">/* Find a definition for:
</span><span style="color:#75715e">        - the type constructor `F`
</span><span style="color:#75715e">        - the value `fa : F[A]`
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
  <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>

  <span style="color:#75715e">/* Such that this call: */</span>
  coerce<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>,<span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#f92672">)(</span>fa<span style="color:#f92672">)</span> <span style="color:#75715e">// is of type `F[B]`
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> toScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> A <span style="color:#f92672">=:=</span> X
  <span style="color:#66d9ef">val</span> fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">(&lt;:&lt;).</span>refl<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
  coerce<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span>,<span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>eqT<span style="color:#f92672">)(</span>fa<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 6:</strong> Using the <em>method</em> <code>substituteCo[F[_]](ff: F[A]): F[B]</code> of
objects of class <code>A =:= B</code>, whose
<a href="https://www.scala-lang.org/api/current/scala/$eq$colon$eq.html#substituteCo[F[_]](ff:F[From]):F[To]">documentation is here</a>,
write the function <code>def fromScalaEq[A,B](scala: A =:= B): EqT[A,B]</code>.</p>

<p><details>
  <summary><em>Hint (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> fromScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>scala<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">/* Find a definition for:
</span><span style="color:#75715e">        - the type constructor `F`
</span><span style="color:#75715e">        - the value `fa : F[A]`
</span><span style="color:#75715e">  */</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>
  <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">???</span>

  <span style="color:#75715e">/* Such that this call: */</span>
  scala<span style="color:#f92672">.</span>substituteCo<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">](</span>fa<span style="color:#f92672">)</span> <span style="color:#75715e">// is of type `F[B]`
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> fromScalaEq<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>scala<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span><span style="color:#66d9ef">:</span><span style="color:#f92672">=</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">EqT</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">X</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">val</span> fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]()</span>
  scala<span style="color:#f92672">.</span>substituteCo<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">](</span>fa<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<h3 id="use-case-witnessing-sub-typing">Use Case: Witnessing Sub Typing</h3>

<p>In this section, we want to create types <code>SubTypeOf[A,B]</code> whose values prove that the type <code>A</code> is
a sub-type of <code>B</code> (i.e. <code>A &lt;: B</code>). A similar <em>but different</em> class already exists in the <em>Scala</em> library.
It is named <code>&lt;:&lt;[A,B]</code>, which is often written <code>A &lt;:&lt; B</code>. Its
<a href="https://www.scala-lang.org/api/current/scala/$less$colon$less.html">documentation is here</a>.
Because this section is about implementing a variant of this class,
please <strong>do not use</strong> <code>&lt;:&lt;[A,B]</code> to implement <code>SubTypeOf</code>.</p>

<ul>
<li><p><strong>Question 1:</strong> Using only <em>upper bounds</em> (i.e. <code>A &lt;: B</code>) or <em>lower bounds</em> (i.e. <code>A &gt;: B</code>)
and <strong>no</strong> <em>variance annotation</em> (i.e. <code>[+A]</code> and <code>[-A]</code>),
create the trait <code>SubTypeOf[A,B]</code> (and all that is necessary) such that:</p>

<blockquote>
<p>There exists a value of type <code>SubType[A,B]</code> <strong>if and only if</strong>
<code>A</code> is a sub-type of <code>B</code> (i.e. <code>A &lt;: B</code>).</p>
</blockquote>

<p>Remember that, by definition, a type <code>A</code> is a sub-type of itself (i.e. <code>A &lt;: A</code>).</p>

<p>Remember that you should not use the <code>class &lt;:&lt;[A,B]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">SubTypeEvidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">B</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span></code></pre></div>
<p><details>
  <summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em> </summary></p>

<p>In production, it is convenient to define the following equivalent code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">SubTypeOf</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">B</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]()</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> evidence<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">B</span>, <span style="color:#66d9ef">B</span><span style="color:#f92672">]</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Evidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">]()</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<p></details></p></li>
</ul>

<h3 id="use-case-avoiding-annoying-scalac-error-messages-about-bounds-not-respected">Use Case: Avoiding annoying <em>scalac</em> error messages about bounds not respected</h3>

<p>In this example, we want to model the diet of some animals.
We start by defining the <code>Food</code> type and some of its subtypes:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Food</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Vegetable</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Food</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Fruit</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Food</span></code></pre></div>
<p>and then the class representing animals eating food of type <code>A</code>
(i.e. <code>Vegetable</code>, <code>Fruit</code>, etc):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Food</span><span style="color:#f92672">]</span>

<span style="color:#a6e22e">val</span> elephant <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">]</span></code></pre></div>
<p>Let&rsquo;s define a function like there are so many in
<em>Functional Programming</em> and apply it to <code>elephant</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;Ok!&#34;</span></code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">List</span>, <span style="color:#66d9ef">Int</span><span style="color:#f92672">](</span><span style="color:#a6e22e">List</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span><span style="color:#ae81ff">2</span><span style="color:#f92672">,</span><span style="color:#ae81ff">3</span><span style="color:#f92672">))</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span>

scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span>, <span style="color:#66d9ef">Boolean</span><span style="color:#f92672">](</span><span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">))</span>
res1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span>

scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">AnimalEating</span>, <span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span>elephant<span style="color:#f92672">)</span>
            <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">kinds</span> <span style="color:#66d9ef">of</span> <span style="color:#66d9ef">the</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">arguments</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">AnimalEating</span><span style="color:#f92672">,</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">)</span>
       <span style="color:#66d9ef">do</span> not conform to the expected kinds of the <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">parameters</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">,</span><span style="color:#66d9ef">type</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">).</span>

       <span style="color:#a6e22e">AnimalEating</span>&#39;s <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">parameters</span> <span style="color:#66d9ef">do</span> <span style="color:#66d9ef">not</span> <span style="color:#66d9ef">match</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">F</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">expected</span> <span style="color:#66d9ef">parameters:</span>
       <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">A</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">bounds</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Food</span> <span style="color:#66d9ef">are</span> <span style="color:#66d9ef">stricter</span> <span style="color:#66d9ef">than</span>
       <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">_</span><span style="color:#960050;background-color:#1e0010">&#39;</span><span style="color:#66d9ef">s</span> <span style="color:#66d9ef">declared</span> <span style="color:#66d9ef">bounds</span> <span style="color:#66d9ef">&gt;:</span> <span style="color:#66d9ef">Nothing</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Any</span></code></pre></div>
<ul>
<li><p><strong>Question 1:</strong> Why does <em>scalac</em> complains?</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>The function <code>dummy</code> requires its argument <code>F</code> to accept any type
as argument so that we can write <code>F[A]</code> for any type <code>A</code>. On the contrary,
<code>AnimalEating</code> requires its argument to be a sub-type of <code>Food</code>.
Thus <code>AnimalEating</code> can not be used as <code>dummy</code>&rsquo;s argument <code>F</code>.
</details></p></li>
</ul>

<p>The problem is that, when we defined <code>class AnimalEating[A &lt;: Food]</code>,
we gave the restriction that <code>A &lt;: Food</code>. So <em>Scala</em>, like <em>Java</em>,
forbids us to give <code>AnimalEating</code> anything but a sub-type of <code>Food</code>
(including <code>Food</code> itself):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">T1</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span>
                 <span style="color:#f92672">^</span>
       error<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">arguments</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">do</span> not conform
       to <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimalEating</span>&#39;s <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">parameter</span> <span style="color:#66d9ef">bounds</span> <span style="color:#f92672">[</span><span style="color:#66d9ef">A</span> <span style="color:#66d9ef">&lt;:</span> <span style="color:#66d9ef">Food</span><span style="color:#f92672">]</span>

scala<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">T2</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Food</span><span style="color:#f92672">]</span>
defined <span style="color:#66d9ef">type</span> <span style="color:#66d9ef">alias</span> <span style="color:#66d9ef">T2</span></code></pre></div>
<p>We face a dilemma: to use the function <code>dummy</code>, that we really want
to use because it&rsquo;s a very nice function, we need to remove the
constraint <code>A &lt;: Food</code> from the definition of <code>class AnimalEating[A &lt;: Food]</code>.
But we still want to say that animals eat food, not integers,
boolean or strings!</p>

<ul>
<li><p><strong>Question 2:</strong> How can you adapt the definition of <code>AnimalEating</code> so that:</p>

<ul>
<li><p>We can call <code>dummy</code> on <code>elephant</code>! We want:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">AnimalEating</span>, <span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span>elephant<span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span></code></pre></div></li>

<li><p><em>If</em> <code>A</code> is <strong>not a sub-type</strong> of <code>Food</code> (including <code>Food</code> itself),
<em>then</em> it is <strong>impossible</strong> to create an instance of <code>AnimalEating[A]</code>.</p></li>

<li><p>The class <code>AnimalEating</code> <strong>must</strong> remain an open class
(i.e. not sealed)! It should be possible for anyone, anywhen,
to create freely sub-classes of <code>AnimalEating</code>. Obviously those
sub-classes must satisfy the constraints above.</p></li>
</ul>

<p><details>
  <summary><em>Hint (click to expand)</em></summary></p>

<p>In <em>Scala</em>, <code>Nothing</code> is a type having no value.
Can you create a value of type <code>(Nothing, Int)</code>? Why?</p>

<p></details></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>If, to create an instance of <code>AnimalEating[A]</code>, we force <strong>every</strong>
creation method to take an extra paramerer of type <code>SubTypeOf[A, Food]</code>,
then it will only be possible to create an instance of <code>AnimalEating[A]</code>
when <code>A</code> is a sub-type of <code>Food</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>ev <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">SubTypeOf</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>, <span style="color:#66d9ef">Food</span><span style="color:#f92672">])</span>

<span style="color:#66d9ef">val</span> elephant <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">AnimalEating</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span><span style="color:#a6e22e">SubTypeEvidence</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Vegetable</span>, <span style="color:#66d9ef">Food</span><span style="color:#f92672">])</span></code></pre></div>
<p>To create a value of type <code>AnimalEating[A]</code>, we need to call
<code>AnimalEating</code>&rsquo;s constructor. And to call this constructor,
we need to provide <code>ev : SubTypeOf[A, Food]</code>.</p>

<p>Now we can apply the <code>dummy</code> function on <code>elephant</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> dummy<span style="color:#f92672">[</span><span style="color:#66d9ef">AnimalEating</span>, <span style="color:#66d9ef">Vegetable</span><span style="color:#f92672">](</span>elephant<span style="color:#f92672">)</span>
res0<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">Ok</span><span style="color:#f92672">!</span></code></pre></div>
<p>In practice, using implicits, we let the compiler
fill the parameter <code>ev : SubTypeOf[A, Food]</code> itself.</p>

<p>Note that you can now express the type <code>AnimalEating[Int]</code>
but you won&rsquo;t be able to create a value of this type.</p>

<p></details></p></li>
</ul>

<h3 id="use-case-give-the-right-data-to-the-right-chart">Use Case: Give the right data to the right chart</h3>

<p>This use case is about enforcing at compile-time that only values
of the right type can be given to a function. In this example, we
consider the design of a chart library. For simplicity&rsquo;s sake, we will
assume that our library only supports two kinds of charts:
<a href="https://www.google.com/search?q=pie+chart&amp;tbm=isch">Pie charts</a>
and
<a href="https://www.google.com/search?q=xy+charts&amp;tbm=isch">XY charts</a>.
This is written in <em>Scala</em> via the enumeration:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ChartType</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span></code></pre></div>
<p>Obviously <em>Pie</em> and <em>XY</em> charts rely on different kinds of data.
Once again for simplicity&rsquo;s sake, we will assume that our two
kinds of data are:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PieData</span>
<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">XYData</span></code></pre></div>
<p>A <em>pie</em> chart (<code>PieChart</code>) plots <strong>only</strong> <code>PieData</code>,
whereas an <em>XY</em> chart (<code>XYChart</code>) plots <strong>only</strong> <code>XYData</code>.
Here is our drawing function <code>draw</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> draw<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>chartType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ChartType</span><span style="color:#f92672">)(</span>data<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
  chartType <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> pieData <span style="color:#66d9ef">=</span> data<span style="color:#f92672">.</span>asInstanceOf<span style="color:#f92672">[</span><span style="color:#66d9ef">PieData</span><span style="color:#f92672">]</span>
      <span style="color:#75715e">// Do some stuff to draw pieData
</span><span style="color:#75715e"></span>      <span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> xyData <span style="color:#66d9ef">=</span> data<span style="color:#f92672">.</span>asInstanceOf<span style="color:#f92672">[</span><span style="color:#66d9ef">XYData</span><span style="color:#f92672">]</span>
      <span style="color:#75715e">// Do some stuff to draw xyData
</span><span style="color:#75715e"></span>      <span style="color:#f92672">()</span>
  <span style="color:#f92672">}</span></code></pre></div>
<p>It assumes that the user will only call <code>draw</code> on the right data.
When <code>chartType</code> is <code>PieChart</code>, the function assumes, via
<code>data.asInstanceOf[PieData]</code> that <code>data</code> is actually of type <code>PieData</code>.
And when <code>chartType</code> is <code>XYChart</code>, it assumes that <code>data</code> is actually
of type <code>XYData</code>.</p>

<p>The problem is these assumptions rely on the users and/or developers
to always make sure they are doing things right. But nothing stops
someone to call <code>draw</code> on a <code>PieChart</code> with <code>XYData</code> (or the opposite),
crashing the system miserably at runtime!</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> draw<span style="color:#f92672">(</span><span style="color:#a6e22e">PieChart</span><span style="color:#f92672">)(</span><span style="color:#66d9ef">new</span> <span style="color:#a6e22e">XYData</span><span style="color:#f92672">)</span>
java<span style="color:#f92672">.</span>lang<span style="color:#f92672">.</span><span style="color:#a6e22e">ClassCastException</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">XYData</span> <span style="color:#66d9ef">cannot</span> <span style="color:#66d9ef">be</span> <span style="color:#66d9ef">cast</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">PieData</span>
  at <span style="color:#f92672">.</span>draw<span style="color:#f92672">(&lt;</span>pastie<span style="color:#66d9ef">&gt;:</span><span style="color:#ae81ff">11</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">...</span> <span style="color:#ae81ff">28</span> elided</code></pre></div>
<p>As developers we know mistakes do happen! We want a way to prevent
theses annoying bugs to happen in production! We want to enforce at
compile-time that only these two scenarii are possible:</p>

<ul>
<li>When <code>draw</code> is called with <code>chartType == PieChart</code>:
the argument <code>data</code> can only be of type <code>PieData</code></li>
<li>When <code>draw</code> is called with <code>chartType == XYChart</code>:
the argument <code>data</code> can only be of type <code>XYData</code>.</li>
</ul>

<p>Remember that these two constraints have to be enforced at compile-time!</p>

<ul>
<li><p><strong>Question 1:</strong> Adapt the definition of <code>ChartType</code>, <code>PieChart</code>, <code>XYChart</code> and <code>draw</code> such that:</p>

<ul>
<li><p>Any scenario other than the two above will make the compilation fail
on a type error.</p></li>

<li><p><code>ChartType</code> must still be a <code>sealed trait</code>. It is now allowed to have <em>type parameters</em> (i.e. <em>generics</em>).</p></li>

<li><p><code>PieChart</code> and <code>XYChar</code> must still be two <code>case object</code>
and they should still extends <code>ChartType</code>.</p></li>

<li><p><code>ChartType</code>, <code>PieChart</code> and <code>XYChar</code> declarations must have <em>no body</em> at all (i.e. there should be no
brackets <code>{ ... }</code> in their declaration).</p></li>
</ul>

<p><details>
  <summary><em>Hint (click to expand)</em></summary></p>

<p>The code looks like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*PUT</span> <span style="color:#66d9ef">SOME</span> <span style="color:#66d9ef">GENERICS</span> <span style="color:#66d9ef">HERE*/</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*There</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">something</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">write</span> <span style="color:#66d9ef">here*/</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*There</span> <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">something</span> <span style="color:#66d9ef">to</span> <span style="color:#66d9ef">write</span> <span style="color:#66d9ef">here</span> <span style="color:#66d9ef">too*/</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">def</span> draw<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>chartType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">/*Write</span> <span style="color:#66d9ef">something</span> <span style="color:#66d9ef">here*/</span><span style="color:#f92672">])(</span>data<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
 chartType <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> pieData <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">PieData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> xyData<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">XYData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">PieData</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">XYData</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">def</span> draw<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>chartType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ChartType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>data<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
 chartType <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PieChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> pieData <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">PieData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">XYChart</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> xyData<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">XYData</span> <span style="color:#f92672">=</span> data
      <span style="color:#f92672">()</span>
    <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<p>You can now sleep well knowing that your production will not
crash because of some bad inputs here 😉</p>

<h2 id="more-advanced-use-cases">More Advanced Use Cases</h2>

<p>Now that you have seen what <em>GADTs</em> are about and how to use
them in real-life, you are ready for the big use cases below.
There are three of them. Each one illustrates one different way
to use the power of <em>GADTs</em>.
The <a href="#use-case-effects">first one</a> is about expressing effects,
which is widely used in every popular <em>IO</em> monads or algebraic effects.
Do not worry if you do not know what they are, the section will clarifies it.
The <a href="#use-case-ensuring-types-are-supported-by-the-database">second one</a>
is about enforcing properties. This point is illustrated
by a real-life use-case of enabling functional programming techniques
but only on certain types (in the example, types supported by our
fictional database).
The <a href="#use-case-simplifying-implicits">third one</a> is about simplifying
the creation of implicits.</p>

<h3 id="use-case-effects">Use Case: Effects!</h3>

<p>What we call an effect is sometimes just an interface declaring some functions with
no implementation. For example we can define the trait below. Note that <em>none</em> of its function
has an implementation.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ExampleEffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> echo<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span>
  <span style="color:#66d9ef">def</span> randomInt <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span>
  <span style="color:#66d9ef">def</span> ignore<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>Implementations of these interfaces are given elsewhere and there can be many of them! This
is useful to switch between implementations easily:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">ExampleEffectImpl</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> echo<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span> value
  <span style="color:#66d9ef">def</span> randomInt <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Int</span> <span style="color:#f92672">=</span> scala<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span><span style="color:#a6e22e">Random</span><span style="color:#f92672">.</span>nextInt<span style="color:#f92672">()</span>
  <span style="color:#66d9ef">def</span> ignore<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span> <span style="color:#f92672">()</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>Another equivalent way to define <code>ExampleEffectSig</code> is via a <code>sealed trait</code>
with some <code>final case class</code> (possibly none!) and/or some<code>case object</code> (possibly none too!):</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Echo</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">RandomInt</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Ignore</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span></code></pre></div>
<p>Once again this is a declaration with no implementation! Once again implementations
can be written elsewhere and there can also be many of them:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> runExampleEffect<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ExampleEffect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Echo</span><span style="color:#f92672">(</span>value<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> value
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">RandomInt</span>   <span style="color:#66d9ef">=&gt;</span> scala<span style="color:#f92672">.</span>util<span style="color:#f92672">.</span><span style="color:#a6e22e">Random</span><span style="color:#f92672">.</span>nextInt<span style="color:#f92672">()</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Ignore</span><span style="color:#f92672">(</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>   <span style="color:#66d9ef">=&gt;</span> <span style="color:#f92672">()</span>
  <span style="color:#f92672">}</span></code></pre></div>
<p>Let&rsquo;s consider a more realistic effect and one possible implementation:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">EffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> currentTimeMillis<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span>
  <span style="color:#66d9ef">def</span> printLn<span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span>
  <span style="color:#66d9ef">def</span> mesure<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">EffectImpl</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">EffectSig</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> currentTimeMillis<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Long</span> <span style="color:#f92672">=</span>
    <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

  <span style="color:#66d9ef">def</span> printLn<span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Unit</span> <span style="color:#f92672">=</span>
    println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">def</span> mesure<span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
    <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
    <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
    println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
    r
  <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><p><strong>Question 1:</strong> Just like <code>ExampleEffect</code> is the equivalent of <code>ExampleEffectSig</code> using a <code>sealed trait</code>
with some <code>final case class</code> and <code>case object</code>, write the equivalent of <code>EffectSig</code> in the same way.
Call this trait <code>Effect</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 2:</strong> Write the function <code>def run[A](effect: Effect[A]): A</code> that mimics the implementation of
<code>EffectImpl</code> just like <code>runExampleEffect</code> mimics <code>ExampleEffectImpl</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> run<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">(</span>fun<span style="color:#f92672">,</span> arg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
      r
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<p>The type <code>Effect[A]</code> declare interesting effects (<code>CurrentTimeMillis</code>,
<code>PrintLn</code> and <code>Mesure</code>) but to be really useful, we need to be able
to chain effects! To do so, we want to have these two functions:</p>

<ul>
<li><code>def pure[A](value: A): Effect[A]</code></li>
<li><code>def flatMap[X,A](fx: Effect[X], f: X =&gt; Effect[A]): Effect[A]</code></li>
</ul>

<p>Once again we do not care yet about the implementation. Presently all
we want is declaring these two operations just like we declared <code>CurrentTimeMillis</code>,
<code>PrintLn</code> and <code>Mesure</code>.</p>

<ul>
<li><p><strong>Question 3:</strong> Add two <em>final case classes</em>, <code>Pure</code> and <code>FlatMap</code>,
to <code>Effect[A]</code> declaring these operations.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Pure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fx<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">],</span> f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 4:</strong> Adapt the function <code>run</code> to handle these two new cases.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> run<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">(</span>fun<span style="color:#f92672">,</span> arg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
      r

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      a

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span>fx<span style="color:#f92672">,</span> f<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> x  <span style="color:#66d9ef">=</span> run<span style="color:#f92672">(</span>fx<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> f<span style="color:#f92672">(</span>x<span style="color:#f92672">)</span>
      run<span style="color:#f92672">(</span>fa<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 5:</strong> Add the two following methods to trait <code>Effect[A]</code> to get:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> f<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]((</span>a<span style="color:#66d9ef">:</span><span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>f<span style="color:#f92672">(</span>a<span style="color:#f92672">)))</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>And run the follwing code to see if it works:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> effect1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
    t0 <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">CurrentTimeMillis</span>
    <span style="color:#66d9ef">_</span>  <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;The current time is </span><span style="color:#e6db74">$t0</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span> <span style="color:#66d9ef">yield</span> <span style="color:#f92672">()</span>

run<span style="color:#f92672">(</span>effect1<span style="color:#f92672">)</span></code></pre></div>
<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span><span style="color:#66d9ef">this</span><span style="color:#f92672">,</span> f<span style="color:#f92672">)</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> flatMap<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]((</span>a<span style="color:#66d9ef">:</span><span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>f<span style="color:#f92672">(</span>a<span style="color:#f92672">)))</span>
<span style="color:#f92672">}</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Long</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">String</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fun<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> A<span style="color:#f92672">,</span> arg<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">Pure</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span>,<span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>fx<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">X</span><span style="color:#f92672">],</span> f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">X</span> <span style="color:#f92672">=&gt;</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>

<span style="color:#66d9ef">def</span> run<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>effect<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=</span>
  effect <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">CurrentTimeMillis</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      println<span style="color:#f92672">(</span>msg<span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Mesure</span><span style="color:#f92672">(</span>fun<span style="color:#f92672">,</span> arg<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> t0 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      <span style="color:#66d9ef">val</span> r  <span style="color:#66d9ef">=</span> fun<span style="color:#f92672">(</span>arg<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> t1 <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">System</span><span style="color:#f92672">.</span>currentTimeMillis<span style="color:#f92672">()</span>
      println<span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;Took </span><span style="color:#e6db74">${</span>t1 <span style="color:#f92672">-</span> t0<span style="color:#e6db74">}</span><span style="color:#e6db74"> milli-seconds&#34;</span><span style="color:#f92672">)</span>
      r

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Pure</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      a

    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">FlatMap</span><span style="color:#f92672">(</span>fx<span style="color:#f92672">,</span> f<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> x  <span style="color:#66d9ef">=</span> run<span style="color:#f92672">(</span>fx<span style="color:#f92672">)</span>
      <span style="color:#66d9ef">val</span> fa <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> f<span style="color:#f92672">(</span>x<span style="color:#f92672">)</span>
      run<span style="color:#f92672">(</span>fa<span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span>

<span style="color:#66d9ef">val</span> effect1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Effect</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Unit</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#66d9ef">for</span> <span style="color:#f92672">{</span>
    t0 <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">CurrentTimeMillis</span>
    <span style="color:#66d9ef">_</span>  <span style="color:#66d9ef">&lt;-</span> <span style="color:#a6e22e">PrintLn</span><span style="color:#f92672">(</span><span style="color:#e6db74">s&#34;The current time is </span><span style="color:#e6db74">$t0</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">)</span>
  <span style="color:#f92672">}</span> <span style="color:#66d9ef">yield</span> <span style="color:#f92672">()</span></code></pre></div>
<p>When we run <code>run(effect1)</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala">scala<span style="color:#f92672">&gt;</span> run<span style="color:#f92672">(</span>effect1<span style="color:#f92672">)</span>
<span style="color:#a6e22e">The</span> current time is <span style="color:#ae81ff">1569773175010</span></code></pre></div>
<p></details></p></li>
</ul>

<p>Congratulations! You just wrote your first <em>IO</em> monad! There
is a lot of scientific words to name the <code>sealed trait Effect[A]</code>:
you can call it an <em>algebraic effect</em>, a <em>free monad</em>, an <em>IO</em>, etc.
But in the end, it is just a plain simple <code>sealed trait</code> where
we just declared some <code>final case class</code> and <code>case object</code> to
represent the functions we wanted to have without providing
their implementation (<code>CurrentTimeMillis</code>, <code>PrintLn</code>, <code>Mesure</code>,
<code>Pure</code> and <code>FlatMap</code>). You can call them <em>virtual methods</em> if you
like. <strong>What really matters is that we isolated the declaration of
the functions from their implementation.</strong> Remember that a <code>trait</code>
is just a interface after all.</p>

<h3 id="use-case-ensuring-types-are-supported-by-the-database">Use Case: Ensuring types are supported by the Database</h3>

<p>Databases are great. We can store tables, documents, key/values pairs, graphs, etc.
But for any database, there is unfortunately only a limited set of supported types.
Take a database you like, I am sure I can find some types it does not support.</p>

<p>In this section we consider the use case of data structures and code that do not work
for (values of) any type but only for some! This problem is not limited to databases but
concerns any <em>API</em> that only supports a limited set of types (the vast majority of <em>APIs</em>).
How to enforce this constraint? How to adapt the patterns we like to work under this constraint?
This is all this section is about.</p>

<p>We consider a fictional database that <strong>only</strong> supports the following types:</p>

<ol>
<li><code>String</code></li>
<li><code>Double</code></li>
<li><code>(A,B)</code> where <code>A</code> and <code>B</code> are also types supported by the database.</li>
</ol>

<p>It means that the values stores by the database (in tables, key/value pairs, etc) <strong>must</strong>
follow the rules above. It can store <code>&quot;Hello World&quot;</code> because it is a <code>String</code> which is
a supported type by rule <em>1</em>. Likewise, it can store <code>5.2</code> because it is a <code>Double</code>,
but it can <em>not</em> store <code>5</code> because it is an <code>Int</code>. It can store <code>(&quot;Hello World&quot;, 5.2)</code>
thanks to rule <em>3</em> and also <code>((&quot;Hello World&quot;, 5.2) , 8.9)</code> once again by rule <em>3</em>.</p>

<ul>
<li><p><strong>Question 1:</strong> Define the type <code>DBType[A]</code> such that:</p>

<blockquote>
<p>There exists a value of type <code>DBType[A]</code> <strong>if and only if</strong> <code>A</code>
is a type supported by the database.</p>
</blockquote>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>The simple version is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBString</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBDouble</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span>
<span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span>  <span style="color:#a6e22e">DBPair</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> second<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">)]</span></code></pre></div>
<p><details>
<summary><strong>Remark for people fluent in <em>Scala</em></strong> <em>(click to expand)</em> </summary></p>

<p>Using all the nice features of <em>Scala</em>, the production-ready version of the code above is:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">DBType</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBString</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBDouble</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBPair</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> second<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">DBType</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">)]</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> dbString <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBString</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> dbDouble <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Double</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBDouble</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> dbPair<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> first<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> second<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[(</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">)]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBPair</span><span style="color:#f92672">(</span>first<span style="color:#f92672">,</span> second<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p>

<p></details></p></li>
</ul>

<p>Using <code>DBType</code>, we can pair a value of type <code>A</code> with a value of type <code>DBType[A]</code> which provides an evidence
that the type <code>A</code> is supported by the database:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>value<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> dbType<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span></code></pre></div>
<p>Note that the parameter <code>dbType</code> does not need to be implicit! All that matters is that
to create a value of type <code>DBValue[A]</code>, we need to provide a value of type <code>DBType[A]</code>
which forces <code>A</code> to be a supported type.</p>

<p>A functor is, approximately, a type constructor <code>F[_]</code> like <code>List</code>, <code>Option</code>, <code>DBValue</code>, &hellip;
for which you can write an instance of the trait</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Functor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>where <code>map(fa)(f)</code> applies the function <code>f</code> to any value of type <code>A</code> contained in <code>fa</code>. For example:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">OptionFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Functor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Option</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Option</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    fa <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>a<span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Some</span><span style="color:#f92672">(</span>f<span style="color:#f92672">(</span>a<span style="color:#f92672">))</span>
      <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">None</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">None</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><p><strong>Question 2:</strong> Write an instance of <code>Functor[DBValue]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>

<p>We actually can not! If we try to compile the following code:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBValueFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">Functor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">DBValue</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#f92672">(</span>fa<span style="color:#f92672">.</span>value<span style="color:#f92672">))</span>
<span style="color:#f92672">}</span></code></pre></div>
<p><em>Scala</em> complains: <code>could not find implicit value for parameter dbType: DBType[B]</code>. Indeed, booleans
are not a supported type by the database: they are neither strings, nor doubles, not pairs. But if we
could write a <code>Functor</code> instance for <code>DBValue</code> (i.e. if we could write a <code>map</code> function for <code>DBValue</code>),
then we could write:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">val</span> dbValueString  <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">]</span>  <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;A&#34;</span><span style="color:#f92672">)(</span><span style="color:#a6e22e">DBString</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dbValueBoolean <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> dbValueString<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span><span style="color:#66d9ef">_</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">true</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">val</span> dbTypeBoolean  <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span><span style="color:#f92672">]</span>  <span style="color:#66d9ef">=</span> dbValueBoolean<span style="color:#f92672">.</span>dbType</code></pre></div>
<p>We would get a value (<code>dbTypeBoolean</code>) of type <code>DBType[Boolean]</code>
which would mean that the type <code>Boolean</code> is supported by the database.
But it is not! And by definition:</p>

<blockquote>
<p>There exists a value of type <code>DBType[A]</code> <strong>if and only if</strong>
<code>A</code> is a type supported by the database.</p>
</blockquote>

<p>So it is impossible to have a value of type <code>DBType[Boolean]</code>
and thus it is impossible to write a function <code>map</code> for <code>DBValue</code>.
So there is no way to write a <code>Functor</code> instance for <code>DBValue</code>.</p>

<p></details></p></li>
</ul>

<p>A <em>Generalized Functor</em> is very much like a regular <code>Functor</code> but
the <code>map</code> function do not apply to any type <code>A</code> and <code>B</code> but is restricted
to the only types <code>A</code> and <code>B</code> satisfying some condition:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">GenFunctor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">P</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]</span>,<span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">_</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> evA<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">P</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> evB<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">P</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">F</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>For example <code>Set</code> (more precisely <code>TreeSet</code>) is not a functor!
Indeed there is no way to write a function <code>map</code> that works for
any type <code>B</code> (because <code>B</code> need to have an ordering). But if we restrict
<code>map</code> to only types <code>B</code> having an ordering, then we can write it.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">import</span> scala.collection.immutable._
<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">TreeSetFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">GenFunctor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Ordering</span>, <span style="color:#66d9ef">TreeSet</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">TreeSet</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> evA<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Ordering</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> evB<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Ordering</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">TreeSet</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">TreeSet</span><span style="color:#f92672">.</span>empty<span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>evB<span style="color:#f92672">)</span> <span style="color:#f92672">++</span> fa<span style="color:#f92672">.</span>toSeq<span style="color:#f92672">.</span>map<span style="color:#f92672">(</span>f<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span></code></pre></div>
<ul>
<li><p><strong>Question 3:</strong> Write an instance of <code>GenFunctor[DBType, DBValue]</code>r</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">object</span> <span style="color:#a6e22e">DBValueGenFunctor</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">GenFunctor</span><span style="color:#f92672">[</span><span style="color:#66d9ef">DBType</span>, <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> map<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span>,<span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>fa<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])(</span>f<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span> <span style="color:#f92672">=&gt;</span> B<span style="color:#f92672">)(</span><span style="color:#66d9ef">implicit</span> evA<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">],</span> evB<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBType</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">DBValue</span><span style="color:#f92672">[</span><span style="color:#66d9ef">B</span><span style="color:#f92672">](</span>f<span style="color:#f92672">(</span>fa<span style="color:#f92672">.</span>value<span style="color:#f92672">))(</span>evB<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<p>What we have done to <code>Functor</code> can be done for many data-structures and patterns. We can often
limit the types on which a data-structure or a type-class can operate by adding an extra parameter
like <code>ev : DBType[A]</code> to constructors and methods.</p>

<h3 id="use-case-simplifying-implicits">Use Case: Simplifying Implicits</h3>

<p>This use case is one the most interesting but unfortunately, not one of the easiest. It
illustrates how it is possible to use <em>GADTs</em> to simplify the creation of implicit values.
In this example we consider lists of values whose items can be of different types. Theses
lists are called <em>heterogeneous lists</em>. They are usually defined in <em>Scala</em> almost like
normal lists:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HNil</span><span style="color:#f92672">()</span> <span style="color:#75715e">// The empty list
</span><span style="color:#75715e"></span><span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span>head<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Head</span><span style="color:#f92672">,</span> tail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Tail</span><span style="color:#f92672">)</span> <span style="color:#75715e">// The `head :: tail` operation
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">val</span> empty <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HNil</span> <span style="color:#f92672">=</span>
  <span style="color:#a6e22e">HNil</span><span style="color:#f92672">()</span>

<span style="color:#66d9ef">val</span> oneTrueToto <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">String</span>, <span style="color:#66d9ef">HNil</span><span style="color:#f92672">]]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#ae81ff">1</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;toto&#34;</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HNil</span><span style="color:#f92672">())))</span>

<span style="color:#66d9ef">val</span> falseTrueFive<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Boolean</span>, <span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span>, <span style="color:#66d9ef">HNil</span><span style="color:#f92672">]]]</span> <span style="color:#66d9ef">=</span>
  <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#66d9ef">false</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span><span style="color:#ae81ff">5</span><span style="color:#f92672">,</span> <span style="color:#a6e22e">HNil</span><span style="color:#f92672">())))</span></code></pre></div>
<p>As you can see, there is nothing special about it. We want to define
orderings on heterogeneous lists. An ordering is a way to compare two
values (<strong>of the same type!</strong>): they can be equal or one may be lesser
than the other. In <em>Scala</em> we can define the trait <code>Order</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#75715e">// true if and only if a1 &lt; a2
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">def</span> lesserThan<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span>

  <span style="color:#75715e">// a1 and a2 are equal if and only if none of them is lesser than the other.
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> areEqual<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a1<span style="color:#f92672">,</span> a2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a2<span style="color:#f92672">,</span> a1<span style="color:#f92672">)</span>

  <span style="color:#75715e">// a1 &gt; a2 if and only if a2 &lt; a1
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> greaterThan<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> lesserThan<span style="color:#f92672">(</span>a2<span style="color:#f92672">,</span> a1<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> lesserThanOrEqual<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a2<span style="color:#f92672">,</span> a1<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">def</span> greaterThanOrEqual<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> <span style="color:#f92672">!</span>lesserThan<span style="color:#f92672">(</span>a1<span style="color:#f92672">,</span> a2<span style="color:#f92672">)</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Order</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">def</span> make<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span>lg_ <span style="color:#66d9ef">:</span> <span style="color:#f92672">(</span><span style="color:#66d9ef">A</span><span style="color:#f92672">,</span><span style="color:#66d9ef">A</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#a6e22e">Boolean</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">def</span> lesserThan<span style="color:#f92672">(</span>a1<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">,</span> a2<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">A</span><span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Boolean</span> <span style="color:#f92672">=</span> lg_<span style="color:#f92672">(</span>a1<span style="color:#f92672">,</span>a2<span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> orderInt    <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">Int</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> orderString <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">String</span><span style="color:#f92672">](</span><span style="color:#66d9ef">_</span> <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">_</span><span style="color:#f92672">)</span></code></pre></div>
<p>Remember that we will only compare lists of the <em>same type</em>:</p>

<ul>
<li>Lists of type <code>HNil</code> will only be compared to lists of type <code>HNil</code>.</li>
<li>Lists of type <code>HCons[H,T]</code> will only be compared to lists of type <code>HCons[H,T]</code>.</li>
</ul>

<p>Comparing lists of type <code>HNil</code> is trivial because there is only one value
of type <code>HNil</code> (the empty list <code>HNil()</code>) but there are many ways of comparing
lists of type <code>HCons[H,T]</code>.
Here are two possible orderings (there exists many more!):</p>

<ul>
<li><p>The <em>lexicographic ordering</em> (i.e. dictionary order: from left to right)</p>

<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>h1 &lt; h2</code> <em>or</em> (<code>h1 == h2</code> <em>and</em> <code>t1 &lt; t2</code> <em>by lexicographic ordering</em>).</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Lex</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> lexHNil<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> lexHCons<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      lexTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Lex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> lexTail<span style="color:#f92672">.</span>order

      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderHead<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div></li>

<li><p>The <em>reverse-lexicographic</em> ordering which is the reverse version
of the lexicographic ordering (i.e. from right to left)</p>

<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>t1 &lt; t2</code> <em>by reverse-lexicographic ordering or</em> (<code>t1 == t2</code> <em>and</em> <code>h1 &lt; h2</code>).</p>
</blockquote>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">RevLex</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> revLexHNil<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> revLexHCons<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      revLexTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">RevLex</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> revLexTail<span style="color:#f92672">.</span>order

      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderTail<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div></li>
</ul>

<p>As said above, it is possible to define more orderings:</p>

<ul>
<li><p><strong>Question 1:</strong> The <code>Alternate</code> ordering is defined by:</p>

<blockquote>
<p><code>HCons(h1,t1) &lt; HCons(h2,t2)</code> <strong>if and only if</strong>
<code>h1 &lt; h2</code> <em>or</em> (<code>h1 == h2</code> <em>and</em> <code>t1 &gt; t2</code> <em>by alternate ordering</em>).</p>
</blockquote>

<p>Just like what was done for <code>Lex</code> and <code>RevLex</code>,
implement the <code>Alternate</code> ordering.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#f92672">}</span>

<span style="color:#66d9ef">object</span> <span style="color:#a6e22e">Alternate</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> alternateHNil<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>
    <span style="color:#f92672">}</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> alternateHCons<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      alternateTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#66d9ef">new</span> <span style="color:#a6e22e">Alternate</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> alternateTail<span style="color:#f92672">.</span>order

      <span style="color:#66d9ef">val</span> order <span style="color:#66d9ef">=</span> <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>, <span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderHead<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderTail<span style="color:#f92672">.</span>greaterThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<p>There are lots of ways to define a valid ordering on heterogeneous lists!
Defining type-classes like <code>Lex</code>, <code>RevLex</code> and <code>Alternate</code> for every ordering
we want to implement is clunky and messy. We can do much better than that &hellip;
with a <em>GADT</em> 😉</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">sealed</span> <span style="color:#66d9ef">trait</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span>
<span style="color:#a6e22e">object</span> <span style="color:#a6e22e">HListOrder</span> <span style="color:#f92672">{</span>
  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">object</span> <span style="color:#a6e22e">HNilOrder</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span>

  <span style="color:#66d9ef">final</span> <span style="color:#66d9ef">case</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">HConsOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      hlistOrderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span> <span style="color:#66d9ef">extends</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span>

  <span style="color:#75715e">// Implicit definitions
</span><span style="color:#75715e"></span>
  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">val</span> hnilOrder <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">HNilOrder</span>

  <span style="color:#66d9ef">implicit</span> <span style="color:#66d9ef">def</span> hconsOrder<span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span>
      orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span><span style="color:#f92672">],</span>
      hlistOrderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Tail</span><span style="color:#f92672">]</span>
    <span style="color:#f92672">)</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">Head</span>,<span style="color:#66d9ef">Tail</span><span style="color:#f92672">]]</span> <span style="color:#66d9ef">=</span>
    <span style="color:#a6e22e">HConsOrder</span><span style="color:#f92672">(</span>orderHead<span style="color:#f92672">,</span> hlistOrderTail<span style="color:#f92672">)</span>

  <span style="color:#66d9ef">def</span> apply<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> ev<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">ev.</span><span style="color:#66d9ef">type</span> <span style="color:#f92672">=</span> ev
<span style="color:#f92672">}</span></code></pre></div>
<p>Note that these implicit definitions are boilerplate. Their only purpose
is passing arguments to their corresponding constructor (i.e. <code>final case class</code>
or <code>case object</code>): <code>hnilOrder</code> to <code>HNilOrder</code> (O arguments) and <code>hconsOrder</code>
to <code>HConsOrder</code> (2 arguments).</p>

<ul>
<li><p><strong>Question 2:</strong> Write the function <code>def lex[A](implicit v : HListOrder[A]): Order[A]</code>
that compute the lexicographic ordering from a value of type <code>HListOrder[A]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> lex<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> v <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">.</span><span style="color:#a6e22e">HNilOrder</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> hc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder.HConsOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>,<span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> hc<span style="color:#f92672">.</span>orderHead
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> lex<span style="color:#f92672">(</span>hc<span style="color:#f92672">.</span>hlistOrderTail<span style="color:#f92672">)</span>

      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>, <span style="color:#66d9ef">tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderHead<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>

<li><p><strong>Question 3:</strong> Write the function <code>def revLex[A](implicit v : HListOrder[A]): Order[A]</code>
that compute the reverse-lexicographic ordering from a value of type <code>HListOrder[A]</code>.</p>

<p><details>
  <summary><em>Solution (click to expand)</em></summary></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#66d9ef">def</span> revLex<span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">](</span><span style="color:#66d9ef">implicit</span> v <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">])</span><span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">A</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span>
  v <span style="color:#66d9ef">match</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">HListOrder</span><span style="color:#f92672">.</span><span style="color:#a6e22e">HNilOrder</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HNil</span><span style="color:#f92672">]((</span><span style="color:#66d9ef">_</span><span style="color:#f92672">,</span><span style="color:#66d9ef">_</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">=&gt;</span> <span style="color:#66d9ef">false</span><span style="color:#f92672">)</span>

    <span style="color:#66d9ef">case</span> hc <span style="color:#66d9ef">:</span> <span style="color:#66d9ef">HListOrder.HConsOrder</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>,<span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=&gt;</span>
      <span style="color:#66d9ef">val</span> orderHead<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> hc<span style="color:#f92672">.</span>orderHead
      <span style="color:#66d9ef">val</span> orderTail<span style="color:#66d9ef">:</span> <span style="color:#66d9ef">Order</span><span style="color:#f92672">[</span><span style="color:#66d9ef">tail</span><span style="color:#f92672">]</span> <span style="color:#66d9ef">=</span> revLex<span style="color:#f92672">(</span>hc<span style="color:#f92672">.</span>hlistOrderTail<span style="color:#f92672">)</span>

      <span style="color:#a6e22e">Order</span><span style="color:#f92672">.</span>make<span style="color:#f92672">[</span><span style="color:#66d9ef">HCons</span><span style="color:#f92672">[</span><span style="color:#66d9ef">head</span>, <span style="color:#66d9ef">tail</span><span style="color:#f92672">]]</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">case</span> <span style="color:#f92672">(</span><span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>t1<span style="color:#f92672">),</span> <span style="color:#a6e22e">HCons</span><span style="color:#f92672">(</span>h2<span style="color:#f92672">,</span>t2<span style="color:#f92672">))</span> <span style="color:#66d9ef">=&gt;</span>
          orderTail<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">||</span> <span style="color:#f92672">(</span>orderTail<span style="color:#f92672">.</span>areEqual<span style="color:#f92672">(</span>t1<span style="color:#f92672">,</span>t2<span style="color:#f92672">)</span> <span style="color:#f92672">&amp;&amp;</span> orderHead<span style="color:#f92672">.</span>lesserThan<span style="color:#f92672">(</span>h1<span style="color:#f92672">,</span>h2<span style="color:#f92672">))</span>
      <span style="color:#f92672">}</span>
  <span style="color:#f92672">}</span></code></pre></div>
<p></details></p></li>
</ul>

<p>This approach has several benefits. Whereas the initial approach had to find
one implicit by ordering, the <em>GADT</em> approach only have to find one! Considering
implicit resolution is a costly operation, reducing it means faster compilation times.
Reading the code of functions <code>lex</code> and <code>revLex</code> is easier than understanding how
implicit resolution works for traits <code>Lex</code> and <code>RevLex</code>. Furthermore, they are just
functions, you can use all you can code in building the instance <code>Order[A]</code>.</p>

<h2 id="conclusion">Conclusion</h2>

<p>Not so trivial, isn&rsquo;t it? 😉 Actually a fair amount
of the complexity you may have experienced comes to
the fact that reasoning about values and types is almost
never taught in programming courses.
What you consider simple now (web apis, streaming, databases, etc)
would probably terrifies your younger self when you
were introduced for the first time to &ldquo;Hello World!&rdquo;.
You probably did not learn all you know in programming
in three hours so do not expect reasoning about programs
to be magically easier.</p>

<p>This workshop aimed at inspiring you, opening your mind
to this all new set of possibilities. If you found the use case
interesting, then take the time to understand the techniques.</p>

<p>Have fun and take care ❤️</p>


<footer class=" footline" >
	
</footer>

        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="https://chrilves.github.io/js/clipboard.min.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/perfect-scrollbar.min.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/perfect-scrollbar.jquery.min.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/jquery.sticky.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/featherlight.min.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/highlight.pack.js?1572061108"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="https://chrilves.github.io/js/modernizr.custom-3.6.0.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/learn.js?1572061108"></script>
    <script src="https://chrilves.github.io/js/hugo-learn.js?1572061108"></script>

    <link href="https://chrilves.github.io/mermaid/mermaid.css?1572061108" rel="stylesheet" />
    <script src="https://chrilves.github.io/mermaid/mermaid.js?1572061108"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>
